<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>äººç”Ÿæ­§è·¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary-grad-start: #6a82fb; --primary-grad-end: #fc5c7d;
      --text-color: #333; --bg-light: #ffffff; --bg-grey: #f7f8fc;
      --border-color: #eef0f5; --progress-bar-bg: #e9ecef;
    }
    body {
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #434343, #000000);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; padding: 20px; box-sizing: border-box;
    }
    .game-container { position: relative; max-width: 450px; width: 100%; }
    .game-box {
      background: var(--bg-light); padding: 25px; border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 100%; text-align: center;
      display: none; box-sizing: border-box;
    }
    /* è½¬æŠ˜ç‚¹é€šçŸ¥ */
    #turningPointNotifier {
      position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(120deg, #ffc3a0, #ffafbd); color: #a54e2a;
      padding: 8px 20px; border-radius: 20px; font-weight: 700;
      cursor: pointer; z-index: 1001; box-shadow: 0 0 15px #ffc3a0;
      animation: pulse-glow 1.5s infinite alternate; display: none;
    }
    @keyframes pulse-glow { from { box-shadow: 0 0 5px #ffc3a0; } to { box-shadow: 0 0 25px #ffafbd, 0 0 10px #fff; } }
    
    h1 { margin: 0 0 20px; font-size: 28px; background: linear-gradient(120deg, var(--primary-grad-start), var(--primary-grad-end)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .status-panel { background: var(--bg-grey); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid var(--border-color); }
    .total-reward-display { font-size: 32px; font-weight: 700; margin-bottom: 10px; }
    .progress-bar-container { background: var(--progress-bar-bg); border-radius: 10px; height: 20px; margin: 10px 0; overflow: hidden; position: relative; }
    .progress-bar { background: linear-gradient(90deg, #90f7ec, #32ccbc); height: 100%; width: 0%; border-radius: 10px; transition: width 0.5s ease; }
    .progress-bar-text { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #333; font-weight: 600; }
    .sub-stats { display: flex; justify-content: space-around; font-size: 15px; color: #555; }
    .debt-status { color: #e53935; font-weight: 600; }
    
    button { padding: 12px 18px; margin: 8px 4px; font-size: 16px; border: none; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s; font-weight: 500; }
    .action-buttons button, .modal-content button { background: linear-gradient(120deg, #6a82fb, #fc5c7d); }
    .action-buttons button:hover:not(:disabled), .modal-content button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(106, 130, 251, 0.4); }
    button:disabled { background: #ccc !important; cursor: not-allowed !important; transform: none !important; box-shadow: none !important; }
    .upgrade-btn { background: linear-gradient(120deg, #84fab0, #8fd3f4); }
    .upgrade-btn:hover:not(:disabled) { box-shadow: 0 4px 10px rgba(135, 221, 240, 0.6); }
    
    #log { margin-top: 20px; padding: 10px; background: var(--bg-grey); border-radius: 10px; text-align: left; max-height: 150px; overflow-y: auto; font-size: 13px; border: 1px solid var(--border-color); }
    #log p { margin: 6px 0; padding: 0 5px; line-height: 1.5; }
    
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
    .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 100%; text-align: center; }
    .modal-content h2 { margin-top: 0; } .modal-content p { color: #666; line-height: 1.6; }
    .choice-btn { display: block; width: 100%; margin: 10px 0 !important; text-align: left; }
    .choice-btn small { display: block; font-weight: normal; font-size: 13px; opacity: 0.8; }
    #evaluationText { text-align: left; white-space: pre-wrap; margin-bottom: 20px; max-height: 50vh; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="game-container">
    <div id="turningPointNotifier" onclick="activateTurningPoint()">âœ¨ å‘½è¿æ­§è·¯</div>
    <div class="game-box" id="gameBox">
      <h1>äººç”Ÿæ­§è·¯</h1>
      <div class="status-panel">
        <div id="totalRewardDisplay">0 å…ƒ</div>
        <div class="progress-bar-container"><div class="progress-bar" id="freedomProgressBar"></div><div class="progress-bar-text" id="freedomProgressText"></div></div>
        <div class="sub-stats">
          <span>æœºä¼š: <span id="chances">0</span></span>
          <span id="debtStatus" style="display: none;">è´Ÿå€º: <span id="debtAmount">0</span></span>
          <span>Tickets: <span id="ticketCount">0</span></span>
        </div>
      </div>
      <div class="action-buttons">
        <button onclick="pressButton()" id="pressBtn">åŠªåŠ›ä¸€æ¬¡</button>
        <button onclick="buyTicket()" id="ticketBtn">é£é™©æŠ•èµ„</button>
        <button onclick="openCreditModal()" id="creditBtn">ç”³è¯·ä¿¡è´·</button>
        <button onclick="settle()" id="settleBtn">ç»“ç®—äººç”Ÿ</button>
      </div>
      <div class="upgrades-section">
        <h2>è‡ªæˆ‘å¢å€¼</h2>
        <button onclick="buyUpgrade('crit')" id="critUpgradeBtn" class="upgrade-btn"><span></span><span></span></button>
        <button onclick="buyUpgrade('reward')" id="rewardUpgradeBtn" class="upgrade-btn"><span></span><span></span></button>
      </div>
      <div id="log"></div>
    </div>
  </div>

  <div class="modal" id="ageModal"><div class="modal-content"><h2>äººç”Ÿå¼€å±€</h2><p>ä½ å¸Œæœ›åœ¨å¤šå°‘å²æ—¶é€€ä¼‘ï¼Ÿ</p><div><button onclick="startGame(20)">20å²</button><button onclick="startGame(30)">30å²</button><button onclick="startGame(40)">40å²</button><button onclick="startGame(50)">50å²</button><button onclick="startGame(60)">60å²</button><button onclick="startGame(70)">70å²</button><button onclick="startGame(80)">80å²</button></div></div></div>
  <div class="modal" id="creditModal" style="display: none;"><div class="modal-content"><h2>ä¿¡è´·ä¸­å¿ƒ</h2><p>è¿™æ˜¯ä½ äººç”Ÿå”¯ä¸€ä¸€æ¬¡ç”³è¯·ä¿¡è´·çš„æœºä¼šï¼Œè·å¾—çš„èµ„é‡‘å°†èƒŒè´Ÿ20%çš„åˆ©æ¯ï¼Œæœªæ¥30%çš„æ”¶å…¥å°†è‡ªåŠ¨ç”¨äºè¿˜æ¬¾ã€‚</p><div><button class="choice-btn" onclick="takeLoan(10000)">å°é¢è´·æ¬¾<small>è·å¾— 10,000 å…ƒï¼Œæ€»è®¡éœ€å¿è¿˜ 12,000 å…ƒã€‚</small></button><button class="choice-btn" onclick="takeLoan(50000)">å¤§é¢è´·æ¬¾<small>è·å¾— 50,000 å…ƒï¼Œæ€»è®¡éœ€å¿è¿˜ 60,000 å…ƒã€‚</small></button><button onclick="document.getElementById('creditModal').style.display = 'none'">å†æƒ³æƒ³</button></div></div></div>
  <div class="modal" id="turningPointModal" style="display: none;"><div class="modal-content"><h2>å…³é”®è½¬æŠ˜ç‚¹</h2><p>ä½ ç«™åœ¨äººç”Ÿçš„åå­—è·¯å£ï¼Œå¿…é¡»åšå‡ºé€‰æ‹©ï¼š</p><div id="turningPointChoices"></div></div></div>
  <div class="modal" id="settlementModal" style="display: none;"><div class="modal-content"><h2>äººç”Ÿæ€»ç»“æŠ¥å‘Š</h2><p id="evaluationText"></p><button onclick="location.reload()">å¼€å¯æ–°çš„äººç”Ÿ</button></div></div>

  <script>
    // --- æ¸¸æˆæ ¸å¿ƒå˜é‡ ---
    let chances, totalReward, ticketPrice, retirementAge, freedomGoal, isTurningPointTriggered, turningPointIgnoreCount;
    let ticketCount, upgrades, turningPointChoice, debt, loanTaken;
    const LOAN_REPAYMENT_RATE = 0.3;
    let costMultipliers = { ticket: 1.0, upgrade: 1.0 };
    let displayedTurningPoints = [];

    // --- å…³é”®è½¬æŠ˜ç‚¹äº‹ä»¶æ±  ---
    const allTurningPoints = [
        { id: 'era_wind', name: 'æ—¶ä»£ä¸œé£', desc: 'åœ¨æ¥ä¸‹æ¥çš„5æ¬¡åŠªåŠ›ä¸­ï¼Œä½ çš„æ‰€æœ‰æ”¶å…¥éƒ½å°†ç¿»å€ã€‚', effect: () => { upgrades.reward.tempMultiplier = 2; upgrades.reward.tempMultiplierTurns = 5; addLog('ğŸ’¨ ä½ æŠ“ä½äº†æ—¶ä»£çš„ä¸œé£ï¼'); } },
        { id: 'home_haven', name: 'å®¶çš„æ¸¯æ¹¾', desc: 'ä½ çš„å®¶åº­æ˜¯ä½ åšå®çš„åç›¾ï¼Œä»–ä»¬æ— æ¡ä»¶ä¸ºä½ æä¾›äº† 30,000 å…ƒã€‚', effect: () => { totalReward += 30000; addLog('ğŸ¡ å®¶äººç»™äº†ä½ ä¸€ç¬”é’±ï¼Œè®©ä½ å€æ„Ÿæ¸©æš–ã€‚'); } },
        { id: 'comeback', name: 'å·åœŸé‡æ¥', desc: 'ä½ æ€»ç»“äº†è¿‡å»çš„ç»éªŒï¼Œé£é™©æŠ•èµ„çš„æˆæœ¬æ°¸ä¹…æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚', effect: () => { ticketPrice = 1; addLog('ğŸ”„ ä½ å†³å®šå·åœŸé‡æ¥ï¼ŒæŠ•èµ„æˆæœ¬å¤§å¤§é™ä½ï¼'); } },
        { id: 'elite_edu', name: 'ç²¾è‹±æ•™è‚²', desc: 'ä½ èŠ±è´¹å·¨èµ„è¿›è¡Œæ·±é€ ï¼ŒåŸºç¡€å›æŠ¥ç­‰çº§ç›´æ¥æå‡5çº§ï¼', effect: () => { for(let i=0; i<5; i++){ upgrades.reward.baseMultiplier += upgrades.reward.multiplierIncrement; } upgrades.reward.level += 5; addLog('ğŸ“ ç²¾è‹±æ•™è‚²è®©ä½ è„±èƒæ¢éª¨ï¼'); } },
        { id: 'diligence', name: 'å‹¤èƒ½è¡¥æ‹™', desc: 'ä½ çš„å‹¤å¥‹æ„ŸåŠ¨äº†ä¸Šå¤©ï¼Œç«‹åˆ»è·å¾—3æ¬¡é¢å¤–çš„æœºä¼šã€‚', effect: () => { chances += 3; addLog('ğŸ’ª ä½ çš„å‹¤å¥‹è·å¾—äº†å›æŠ¥ï¼'); } },
        { id: 'two_birds', name: 'ä¸€çŸ³äºŒé¸Ÿ', desc: 'ä½ å‘ç°äº†ä¸€ä¸ªç»ä½³æœºä¼šï¼Œä¸‹ä¸€æ¬¡â€œè‡ªæˆ‘å¢å€¼â€çš„æˆæœ¬å°†é™ä½90%ã€‚', effect: () => { costMultipliers.upgradeOnce = 0.1; addLog('ğŸ¯ ä½ å‘ç°äº†ä¸€ä¸ªä¸€çŸ³äºŒé¸Ÿçš„æœºä¼šï¼'); } },
        { id: 'health_crisis', name: 'å¥åº·å±æœº', desc: 'ä¸€åœºæ„å¤–çš„ç–¾ç—…è®©ä½ æŸå¤±äº†å½“å‰50%çš„ç§¯è“„ã€‚', effect: () => { totalReward = Math.floor(totalReward * 0.5); addLog('ğŸ’” å¥åº·å±æœºè®©ä½ æŸå¤±æƒ¨é‡ã€‚'); } },
        { id: 'lottery', name: 'å¤©é™æ¨ªè´¢', desc: 'ä½ ä¸­äº†ä¸€å¼ å½©ç¥¨ï¼Œæš´å‡»ç‡æ°¸ä¹…æå‡2%ã€‚', effect: () => { upgrades.crit.baseChance += 0.02; addLog('ğŸ‰ æ­å–œï¼ä½ ä¸­äº†å¤§å¥–ï¼'); } },
        { id: 'noble_help', name: 'è´µäººç›¸åŠ©', desc: 'ä¸€ä½ç¥ç§˜çš„è´µäººå¸®ä½ è¿˜æ¸…äº†å½“å‰50%çš„å€ºåŠ¡ã€‚è‹¥æ— å€ºåŠ¡ï¼Œåˆ™ç›´æ¥èµ äºˆä½ 15,000å…ƒã€‚', effect: () => { if (debt > 0) { debt = Math.floor(debt * 0.5); } else { totalReward += 15000; } addLog('ğŸ¤ ä¸€ä½è´µäººå‘ä½ ä¼¸å‡ºäº†æ´æ‰‹ã€‚'); } },
        { id: 'stock_crash', name: 'æŠ•èµ„å¤±åˆ©', desc: 'é‡‘èå¸‚åœºå´©æºƒï¼Œä½ çš„Ticketä»·å€¼æ¸…é›¶ï¼Œå…¨éƒ¨ä½œåºŸã€‚', effect: () => { chances -= ticketCount; ticketCount = 0; addLog('ğŸ“‰ å¸‚åœºå´©æºƒï¼Œä½ çš„æ‰€æœ‰é£é™©æŠ•èµ„éƒ½åŒ–ä¸ºæ³¡å½±ã€‚'); } },
        { id: 'inspiration', name: 'çµå…‰ä¸€é—ª', desc: 'ä½ å¯¹äººç”Ÿæœ‰äº†æ–°çš„æ„Ÿæ‚Ÿï¼Œä¸‹ä¸€æ¬¡è´­ä¹°Ticketå°†é¢å¤–è·å¾—2æ¬¡æœºä¼šã€‚', effect: () => { upgrades.ticketBonus = 2; addLog('ğŸ’¡ ä½ çªç„¶çµå…‰ä¸€é—ªï¼'); } },
        { id: 'burnout', name: 'èŒä¸šå€¦æ€ ', desc: 'ä½ æ„Ÿåˆ°èº«å¿ƒä¿±ç–²ï¼Œæ¥ä¸‹æ¥çš„3æ¬¡åŠªåŠ›æ”¶å…¥éƒ½å°†å‡åŠã€‚', effect: () => { upgrades.reward.tempMultiplier = 0.5; upgrades.reward.tempMultiplierTurns = 3; addLog('ğŸ˜« ä½ æ„Ÿåˆ°äº†èŒä¸šå€¦æ€ ã€‚'); } },
    ];

    function startGame(age) {
        retirementAge = age;
        chances = (age - 20) / 10 + 1;
        freedomGoal = 100000 * Math.pow(1.8, (age - 20) / 10);
        
        totalReward = 0; ticketPrice = 1; ticketCount = 0; debt = 0; loanTaken = false;
        isTurningPointTriggered = false; turningPointChoice = null; turningPointIgnoreCount = 0;
        costMultipliers = { ticket: 1.0, upgrade: 1.0 };
        upgrades = {
            crit: { level: 1, cost: 10000, baseChance: 0.01, chanceIncrement: 0.005, costMultiplier: 3.5 },
            reward: { level: 1, cost: 8000, baseMultiplier: 1.0, multiplierIncrement: 0.1, costMultiplier: 3 }
        };

        document.getElementById('ageModal').style.display = 'none';
        document.getElementById('gameBox').style.display = 'block';
        addLog(`ä½ é€‰æ‹©äº† ${age} å²é€€ä¼‘ï¼Œäººç”Ÿå¼€å§‹äº†...`);
        updateUI();
    }

    function updateUI() {
        document.getElementById('chances').innerText = chances;
        document.getElementById('ticketCount').innerText = ticketCount;
        document.getElementById('ticketBtn').innerText = `é£é™©æŠ•èµ„ (${(ticketPrice * costMultipliers.ticket).toLocaleString()} å…ƒ)`;
        document.getElementById('totalRewardDisplay').innerText = `${totalReward.toLocaleString()} å…ƒ`;

        if (debt > 0) {
            document.getElementById('debtStatus').style.display = 'inline';
            document.getElementById('debtAmount').innerText = debt.toLocaleString();
        } else {
            document.getElementById('debtStatus').style.display = 'none';
        }

        const progress = Math.min((totalReward / freedomGoal) * 100, 100);
        document.getElementById('freedomProgressBar').style.width = `${progress}%`;
        document.getElementById('freedomProgressText').innerText = `è´¢å¯Œè‡ªç”±: ${progress.toFixed(1)}% (ç›®æ ‡: ${freedomGoal.toLocaleString()})`;

        document.getElementById('ticketBtn').disabled = totalReward < (ticketPrice * costMultipliers.ticket);
        document.getElementById('creditBtn').disabled = loanTaken;
        
        ['crit', 'reward'].forEach(type => {
            const upg = upgrades[type];
            const btn = document.getElementById(`${type}UpgradeBtn`);
            let currentCost = Math.floor(upg.cost * costMultipliers.upgrade);
            if(costMultipliers.upgradeOnce) currentCost = Math.floor(currentCost * costMultipliers.upgradeOnce);
            btn.children[0].innerText = `${type === 'crit' ? 'æå‡æš´å‡»ç‡' : 'æå‡åŸºç¡€å›æŠ¥'} (Lv. ${upg.level})`;
            btn.children[1].innerText = `èŠ±è´¹ ${currentCost.toLocaleString()}`;
            btn.disabled = totalReward < currentCost;
        });
    }

    function addLog(html) {
        const p = document.createElement('p');
        p.innerHTML = html;
        document.getElementById('log').prepend(p);
    }

    function pressButton() {
        if (chances <= 0) { alert("æœºä¼šå·²ç”¨å®Œï¼"); return; }

        if (document.getElementById('turningPointNotifier').style.display === 'block') {
            turningPointIgnoreCount++;
            if (turningPointIgnoreCount >= 3) {
                document.getElementById('turningPointNotifier').style.display = 'none';
                addLog('ä½ çŠ¹è±«äº†å¤ªä¹…ï¼Œä¸ä¸€ä¸ªé‡è¦çš„è½¬æŠ˜ç‚¹æ“¦è‚©è€Œè¿‡ã€‚');
            }
        }

        chances--;
        let reward = Math.floor(((Math.random() < 0.9) ? (Math.random() * 100 + 1) : (Math.random() * 9999 + 100)) * upgrades.reward.baseMultiplier);
        
        if (upgrades.reward.tempMultiplier && upgrades.reward.tempMultiplierTurns > 0) {
            reward = Math.floor(reward * upgrades.reward.tempMultiplier);
            upgrades.reward.tempMultiplierTurns--;
        }

        if (Math.random() < upgrades.crit.baseChance) { reward *= 10; addLog('âš¡ å‘½è¿çš„æš´å‡»ï¼'); }
        
        if (debt > 0) {
            let payment = Math.min(debt, Math.floor(reward * LOAN_REPAYMENT_RATE));
            debt -= payment;
            reward -= payment;
            addLog(`è‡ªåŠ¨è¿˜æ¬¾ ${payment.toLocaleString()} å…ƒã€‚`);
            if (debt === 0) { addLog('æ­å–œï¼ä½ å·²è¿˜æ¸…æ‰€æœ‰å€ºåŠ¡ï¼'); }
        }
        
        totalReward += reward;
        addLog(`åŠªåŠ›: è·å¾— ${reward.toLocaleString()} å…ƒ`);
        
        if (chances === 0 && ticketCount === 0 && !isTurningPointTriggered) {
            isTurningPointTriggered = true;
            document.getElementById('turningPointNotifier').style.display = 'block';
        }
        updateUI();
    }

    function activateTurningPoint() {
        const notifier = document.getElementById('turningPointNotifier');
        if (notifier.style.display !== 'block') return;
        
        const shuffled = allTurningPoints.sort(() => 0.5 - Math.random());
        displayedTurningPoints = shuffled.slice(0, 3);
        
        const choicesContainer = document.getElementById('turningPointChoices');
        choicesContainer.innerHTML = '';
        displayedTurningPoints.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerHTML = `${choice.name}<small>${choice.desc}</small>`;
            btn.onclick = () => makeTurningPointChoice(choice.id);
            choicesContainer.appendChild(btn);
        });

        document.getElementById('turningPointModal').style.display = 'flex';
        notifier.style.display = 'none';
    }

    function makeTurningPointChoice(choiceId) {
        turningPointChoice = choiceId;
        const choice = allTurningPoints.find(c => c.id === choiceId);
        if (choice) {
            choice.effect();
        }
        document.getElementById('turningPointModal').style.display = 'none';
        updateUI();
    }

    function openCreditModal() {
        document.getElementById('creditModal').style.display = 'flex';
    }

    function takeLoan(amount) {
        loanTaken = true;
        totalReward += amount;
        debt += Math.floor(amount * 1.2);
        addLog(`ğŸ’° ä½ ç”³è¯·äº† ${amount.toLocaleString()} å…ƒçš„è´·æ¬¾ï¼Œå¼€å§‹äº†è´Ÿå€ºå‰è¡Œçš„äººç”Ÿã€‚`);
        document.getElementById('creditModal').style.display = 'none';
        updateUI();
    }

    function buyTicket() {
        const cost = Math.floor(ticketPrice * costMultipliers.ticket);
        if (totalReward < cost) return;
        totalReward -= cost; ticketCount++; chances++;
        if(upgrades.ticketBonus) {
            chances += upgrades.ticketBonus;
            addLog(`è§¦å‘äº†â€œçµå…‰ä¸€é—ªâ€ï¼Œé¢å¤–è·å¾— ${upgrades.ticketBonus} æ¬¡æœºä¼šï¼`);
            delete upgrades.ticketBonus;
        }
        addLog(`ğŸ§¾ ç¬¬ ${ticketCount} æ¬¡é£é™©æŠ•èµ„ï¼ŒèŠ±è´¹ ${cost.toLocaleString()} å…ƒã€‚`);
        ticketPrice *= 2;
        updateUI();
    }
    
    function buyUpgrade(type) {
        const upg = upgrades[type];
        let cost = Math.floor(upg.cost * costMultipliers.upgrade);
        if (costMultipliers.upgradeOnce) {
            cost = Math.floor(cost * costMultipliers.upgradeOnce);
            delete costMultipliers.upgradeOnce;
        }
        if (totalReward < cost) return;
        totalReward -= cost; upg.level++;
        if (type === 'crit') upg.baseChance += upg.chanceIncrement; else upg.baseMultiplier += upg.multiplierIncrement;
        addLog(`ğŸ”§ è‡ªæˆ‘å¢å€¼ï¼ŒèŠ±è´¹ ${cost.toLocaleString()}ã€‚`);
        upg.cost = Math.floor(upg.cost * upg.costMultiplier);
        updateUI();
    }

    function settle() {
      document.querySelectorAll('.action-buttons button, .upgrade-btn').forEach(b => b.disabled = true);
      const evaluationText = generateEvaluation();
      document.getElementById("evaluationText").innerText = evaluationText;
      document.getElementById("settlementModal").style.display = "flex";
    }

    function generateEvaluation() {
        const goalScore = Math.min(totalReward / freedomGoal, 1) * 100;
        const ambitionScore = 100 - (retirementAge - 20) / 60 * 100;
        const personas = [
            { name: "ç ´äº§çš„èµŒå¾’", desc: "ä½ çš„äººç”Ÿæ˜¯ä¸€åœºè±ªèµŒï¼Œæ æ†åŠ æ»¡ï¼Œé£é™©æ‹‰æ»¡ã€‚ä½†å‘½è¿å¹¶æœªç«™åœ¨ä½ è¿™è¾¹ï¼Œæœ€ç»ˆï¼Œä½ ä¸ä»…æ²¡èƒ½å®ç°è´¢å¯Œè‡ªç”±ï¼Œåè€ŒèƒŒè´Ÿç€ä¸€èº«å€ºåŠ¡ç‹¼ç‹ˆç¦»åœºã€‚ä½ çš„æ•…äº‹è­¦ç¤ºåäººï¼šä¸è¦ä¸è¶‹åŠ¿ä¸ºæ•Œã€‚", cond: () => debt > 0 },
            { name: "ç²¾æ˜çš„èµ„æœ¬å®¶", desc: "ä½ æ·±è°™èµ„æœ¬çš„è¿ä½œä¹‹é“ï¼Œåœ¨å…³é”®æ—¶åˆ»æœæ–­ä¸¾å€ºï¼Œåˆ©ç”¨æ æ†æ’¬åŠ¨äº†è¿œè¶…è‡ªèº«çš„èµ„æºã€‚æœ€ç»ˆï¼Œä½ ä¸ä»…è¿˜æ¸…äº†æ‰€æœ‰å€ºåŠ¡ï¼Œè¿˜ç§¯ç´¯äº†æƒŠäººçš„è´¢å¯Œã€‚ä½ ä¸æ˜¯é’±çš„ä¸»äººï¼Œä½ æ˜¯é©¾é©­é’±çš„ç¥ã€‚", cond: () => loanTaken && debt === 0 && goalScore > 120 },
            { name: "å¤©é€‰çš„åˆ›ä¸šè€…", desc: "ä½ é€‰æ‹©äº†è‹±å¹´æ—©é€€ï¼Œå´å‡­å€ŸæƒŠäººçš„èƒ†è¯†å’Œæ— ä¸ä¼¦æ¯”çš„è¿æ°”ï¼Œåœ¨æçŸ­æ—¶é—´å†…å®Œæˆäº†è´¢å¯Œçš„åŸå§‹ç§¯ç´¯ï¼Œå¹¶è¿œè¶…ç›®æ ‡ã€‚ä½ çš„æ•…äº‹å°†è¢«å†™è¿›æ•™ç§‘ä¹¦ï¼Œæˆä¸ºæ— æ•°äººæ¨¡ä»¿å´æ— æ³•å¤åˆ¶çš„ä¼ å¥‡ã€‚", cond: () => ambitionScore > 60 && goalScore >= 100 && ticketCount > 5 },
            { name: "å­¤ç‹¬çš„æ±‚é“è€…", desc: "ä½ å¯¹ä¸–ä¿—çš„è´¢å¯Œç›®æ ‡ä¸å±‘ä¸€é¡¾ï¼Œå°†æ‰€æœ‰èµ„æºéƒ½æŠ•å…¥åˆ°è‡ªæˆ‘å¢å€¼ä¸­ã€‚è™½ç„¶æœ€ç»ˆçš„è´¢å¯Œå¯èƒ½å¹¶ä¸æƒŠäººï¼Œä½†ä½ å†…åœ¨çš„æˆé•¿æ— äººèƒ½åŠã€‚ä½ çš„äººç”Ÿè¯æ˜äº†ï¼Œè¿‡ç¨‹æ¯”ç»“æœæ›´é‡è¦ã€‚", cond: () => (upgrades.crit.level + upgrades.reward.level) > 10 && ticketCount < 5 && goalScore < 50 },
            { name: "å‹¤å‹‰çš„å·¥åŒ ", desc: "ä½ é€‰æ‹©äº†æ¼«é•¿è€Œç¨³å¥çš„é“è·¯ï¼Œä¸ç›¸ä¿¡ä¸€å¤œæš´å¯Œçš„ç¥è¯ï¼Œåªç›¸ä¿¡æŒç»­çš„åŠªåŠ›å’ŒæŠ•å…¥ã€‚ä½ çš„äººç”Ÿæ²¡æœ‰å¤§èµ·å¤§è½ï¼Œä½†é€šè¿‡ä¸æ‡ˆçš„å¥‹æ–—å’Œè‡ªæˆ‘æå‡ï¼Œæœ€ç»ˆä¹Ÿå®ç°äº†ä½“é¢çš„ç”Ÿæ´»ã€‚", cond: () => ambitionScore < 40 && (upgrades.crit.level + upgrades.reward.level) > 5 && goalScore > 70 },
            { name: "å¹¸è¿çš„åº¸äºº", desc: "ä½ çš„äººç”Ÿä¼¼ä¹è¢«å‘½è¿æ ¼å¤–çœ·é¡¾ï¼Œæˆ–è®¸æ˜¯ç»§æ‰¿äº†é—äº§ï¼Œæˆ–è®¸æ˜¯æŠ“ä½äº†æŸä¸ªè½¬ç¬å³é€çš„é£å£ã€‚ä½ å¹¶æœªä»˜å‡ºå¤ªå¤šåŠªåŠ›ï¼Œä¹Ÿæœªæ›¾è¿›è¡Œé«˜é£é™©çš„æŠ•èµ„ï¼Œå´ä¹Ÿè·å¾—äº†ä¸é”™çš„ç»“å±€ã€‚è¿™ä»½å¹¸è¿ï¼Œæ˜¯ä½ çš„å¤©èµ‹ï¼Œä¹Ÿæ˜¯ä½ çš„è¯…å’’ã€‚", cond: () => turningPointChoice === 'home_haven' && goalScore > 80 && ticketCount < 5 && (upgrades.crit.level + upgrades.reward.level) < 5 },
            { name: "è¢«æ—¶ä»£æŠ›å¼ƒçš„äºº", desc: "ä½ é€‰æ‹©äº†æœ€é•¿çš„å¥‹æ–—å¹´é™ï¼Œå´åœ¨æ—¶ä»£çš„æµªæ½®ä¸­è¿·å¤±äº†æ–¹å‘ã€‚æ— è®ºæ˜¯æŠ•èµ„ã€æˆé•¿è¿˜æ˜¯æŠŠæ¡æœºä¼šï¼Œä½ ä¼¼ä¹éƒ½æ…¢äº†ä¸€æ­¥ã€‚æœ€ç»ˆï¼Œæ¼«é•¿çš„äººç”Ÿåªç•™ä¸‹äº†ä¸€å£°å¹æ¯å’Œå¾®è–„çš„ç§¯è“„ã€‚", cond: () => ambitionScore < 20 && goalScore < 20 },
            { name: "ä¸€ä¸ªæ ‡å‡†çš„æ™®é€šäºº", desc: "ä½ çš„äººç”Ÿå°±åƒè¿™ä¸ªä¸–ç•Œä¸Š99%çš„äººä¸€æ ·ã€‚æœ‰è¿‡æ¢¦æƒ³ï¼Œæœ‰è¿‡æŒ£æ‰ï¼Œä¹Ÿæ›¾ç«™åœ¨é€‰æ‹©çš„åå­—è·¯å£ã€‚ä¸å¥½ä¸åï¼Œä¸æ‚²ä¸å–œï¼Œæœ€ç»ˆè¿‡ä¸Šäº†å®‰ç¨³è€Œå¹³å‡¡çš„ä¸€ç”Ÿã€‚è¿™ï¼Œæˆ–è®¸å°±æ˜¯ç”Ÿæ´»çš„çœŸç›¸ã€‚", cond: () => true }
        ];
        const matchedPersona = personas.find(p => p.cond());
        return `ã€äººç”ŸåŸå‹ã€‘: ${matchedPersona.name}\n\n${matchedPersona.desc}\n\n------\nã€äººç”Ÿæ•°æ®ã€‘\né€€ä¼‘å¹´é¾„: ${retirementAge}å²\næœ€ç»ˆè´¢å¯Œ: ${totalReward.toLocaleString()}å…ƒ\nè´¢å¯Œè‡ªç”±å®Œæˆåº¦: ${goalScore.toFixed(1)}%\né£é™©æŠ•èµ„æ¬¡æ•°: ${ticketCount}æ¬¡\nè‡ªæˆ‘å¢å€¼ç­‰çº§: ${upgrades.crit.level + upgrades.reward.level - 2}çº§\næœ€ç»ˆè´Ÿå€º: ${debt.toLocaleString()}å…ƒ`;
    }

    window.onload = () => { document.getElementById('ageModal').style.display = 'flex'; };
  </script>
</body>
</html>
