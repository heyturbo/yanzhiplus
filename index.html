<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神兽天赋洗练机</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: url('https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png');
            background-repeat: repeat; /* 图片平铺 */
            background-size: auto; /* 保持原图大小 */
            background-attachment: fixed; /* 背景固定 */
            margin: 0;
            padding: 0;
        }
        /* styles.css */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        #loadingText {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        #progressBarContainer {
            width: 80%;
            background: #ddd;
            border-radius: 25px;
        }
        
        #progressBar {
            width: 0%;
            height: 30px;
            background: #4caf50;
            border-radius: 25px;
        }

        /* 顶部栏样式 */
        .top-bar {
            width: 90%;
            margin: 5px 5px;
            padding: 5px;
            background-color: #fff;
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-radius: 10px;
            flex-direction: row;
            flex-wrap: nowrap;
        }
        
        .top-bar div {
            display: flex;
            font-size: 14px;
            color: #5d4201;
            align-items: center;
            flex-direction: column;
        }
        
        .top-bar img {
            width: 40px;
            height: 40px;
        }
        
        /* 底部栏样式 */
        .bottom-bar {
            width: 90%;
            margin: 5px 5px;
            padding: 5px;
            background-color: rgb(255 255 255 / 90%);
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            border-radius: 10px;
            flex-direction: row;
            flex-wrap: nowrap;
        }
        
        .bottom-bar div {
            display: flex;
            flex-direction: row;
        }
        
        .bottom-bar img {
            width: 45px;
            height: 45px;
        }
        .core-area {
            width: 90%;
            margin: 5px 5px;
            padding: 5px;
            background-color: rgb(255 255 255 / 90%);
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 10px;
        }
        .button-row {
            display: flex;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px 10px;
            margin: 0px 0px;
            padding: 0px;
            flex-direction: row;
            flex-wrap: wrap;
        }
        
        .button-row button {
            flex: auto;
            margin: 0px;
            padding: 0px; /* 去掉内边距以适应按钮大小 */
            background-color: transparent; /* 背景色设为透明以显示背景图片 */
            color: transparent; /* 隐藏按钮文本 */
            border: none;
            cursor: pointer;
            background-size: contain; /* 背景图像保持比例缩放 */
            background-position: center; /* 背景图像居中 */
            background-repeat: no-repeat; /* 防止背景图像平铺 */
            width: 70px; /* 根据需要调整宽度 */
            height: 40px; /* 根据需要调整高度 */
        }
        
        /* 为每个按钮设置不同的背景图片 */
        #guideButton {
            background-image: url('https://pic.imgdb.cn/item/66616fec5e6d1bfa05b013ec.png');
        }
        
        #drawerButton {
            background-image: url('https://pic.imgdb.cn/item/66616feb5e6d1bfa05b01312.png');
        }
        
        #attributeButton {
            background-image: url('https://pic.imgdb.cn/item/66616feb5e6d1bfa05b01297.png');
        }
        
        #shopButton {
            background-image: url('https://pic.imgdb.cn/item/66616fea5e6d1bfa05b0121c.png');
        }
        
        #treasureButton {
            background-image: url('https://pic.imgdb.cn/item/66616fea5e6d1bfa05b0117c.png');
        }
        
        #jinnangButton {
            background-image: url('https://pic.imgdb.cn/item/66616fe95e6d1bfa05b0103d.png');
        }
        
        #fightingButton {
            background-image: url('https://pic.imgdb.cn/item/6661a26a5e6d1bfa05edacf1.png');
        }
        
        #lotteryButton {
            background-image: url('https://pic.imgdb.cn/item/666466225e6d1bfa05b95973.png');
        }
        
        .core-area .skills {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            padding: 0px 0px;
            margin: 5px 0px;
            gap: 5px 5px;
            width: 95%;
        }
        .core-area .skills div {
            padding: 10px;
            margin: 5px 0px;
            background-color: #ffffffcf;
            text-align: center;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0px 0px 1px 1px rgb(0 0 0 / 30%);
            box-sizing: border-box;
            cursor: pointer;
        }
        .core-area .skills .s-skill {
            border: 2px solid gold;
            background-color: #fefefc;
        }
        .core-area .skills .ss-skill {
            border: 2px solid gold;
            background-color: #ffc900;
        }
        .bottom-bar .info {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: center;
            padding: 0px 10px;
            margin: 0px 10px;
        }
        .bottom-bar .info div {
            margin: 5px 0;
        }
        .description-box {
            margin: 5px 0px;
            padding: 5px;
            width: 90%;
            background-color: rgb(255 255 255 / 90%);
            border-radius: 10px;
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            text-align: justify;
        }
        .treasure-description-box {
            margin: 5px 5px;
            padding: 20px;
            background-color: rgb(255 255 255 / 90%);
            border-radius: 10px;
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            text-align: justify;
        }
        .pet-selector {
            width: 90%;
            height: 90%;
            margin: 5px 5px;
            padding: 5px;
            background-color: rgb(255 255 255 / 95%);
            box-shadow: 0 1px 2px rgb(0 0 0 / 40%);
            border-radius: 10px;
            text-align: center;
        }
        .pet-selector select {
            width: 100%;
            padding: 0px;
            font-size: 16px;
            border-radius: 5px;
            background-color: #ffffff75;
            border: 1px solid #ccc;
        }
        .pet-image {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .pet-image img {
            width: 180px;
            height: 180px;
            border-radius: 10px;
            padding: 0px 5px;
            margin: 5px 0px;
        }
        .info-card {
            display: none;
            width: 90%;
            margin: 10px 0;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .info-card.active {
            display: block;
        }
        .info-card {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .info-card div {
            height: 20px;
            background-color: #e4bb5c;
            text-align: right;
            padding-right: 5px;
            color: white;
            border-radius: 5px;
        }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-bar div {
            height: 20px;
            background-color: #e4bb5c;
            text-align: right;
            padding-right: 5px;
            color: white;
            border-radius: 5px;
        }
        .quality-drawer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .quality-drawer.open {
            transform: translateY(0);
        }
        .drawer-toggle {
            padding: 5px;
            text-align: center;
            background-color: #0a8c00;
            color: white;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
        }
        .quality-info {
            display: none;
            padding: 5px;
        }
        .quality-info.open {
            display: block;
        }
        .quality-info .progress-bar {
            width: 100%;
            background-color: #e3e3e3;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .quality-info .progress-bar div {
            height: 10px;
            background-color: #0056b3;
            text-align: right;
            padding-right: 5px;
            color: white;
            border-radius: 5px;
        }
        /* 商店抽屉的样式优化 */
        .shop-drawer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .shop-drawer.open {
            transform: translateY(0);
        }
        .shop-info {
            display: none;
            padding: 10px;
        }
        .shop-info.open {
            display: block;
        }
        .shop-items {
            display: grid;
            padding: 0px;
            margin: 0;
            font-size: 12px;
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
            align-items: stretch;
        }
        .shop-item {
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            padding: 5px;
            border-radius: 5px;
        }
        .shop-item.selected {
            border-color: #0a8c00;
            background-color: #fff;
        }
        .shop-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
        }
        .shop-bar button {
            padding: 5px 10px;
            background-color: #0a8c00;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .quality-info button:active {
            background-color: #074b02;
        }
        .quality-info button {
            padding: 2px 10px;
            margin: 5px;
            /* height: 66%; */
            background-color: #088c01;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .shop-bar button:active {
            background-color: #064701;
        }
        .shop-timer {
            display: flex;
            align-items: center;
            font-size: 12px;
        }
        .shop-timer button {
            padding: 5px 10px;
            background-color: #088c01;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .shop-timer button:active {
            background-color: #064701;
        }
        .attribute-info button {
            padding: 0px 5px;
            margin: 0px 2px;
            background-color: #0a8c00;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .attribute-info button:active {
            background-color: #064701;
        }
        
        /* 属性面板样式 */
        .attribute-drawer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .attribute-drawer.open {
            transform: translateY(0);
        }
        .attribute-info {
            display: none;
            padding: 10px;
        }
        .attribute-info.open {
            display: block;
        }
        .attribute-info .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0px;
        }
        .attribute-info .progress-bar div {
            height: 20px;
            background-color: #e4bb5c;
            text-align: right;
            padding-right: 5px;
            color: white;
            border-radius: 5px;
        }
        .attributes-container {
            display: flex;
             /* 使两个子容器分布在容器的两边 */
            gap: 0px; /* 调整两列之间的间距 */
            align-items: stretch;
            font-size: 14px;
            flex-direction: row;
            justify-content: space-between;
        }
        .progress-bars {
            display: flex;
            gap: 0px; /* 调整每个条目之间的间距 */
            flex-direction: column-reverse;
            align-items: flex-start;
            justify-content: space-evenly;
        }
        .secondary-attributes {
            display: flex;
            flex-direction: column;
            gap: 5px; /* 调整每个条目之间的间距 */
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: space-evenly;
        }
        .image-frame {
            display: flex;
            /* 设置图片框的尺寸，可以根据需要调整 */
            width: 140px;
            padding: 60px 0px;
            height: 140px;
             /* 添加边框 */
            margin: 0px; /* 在容器内垂直居中 */
            top: 50%;
            left: 50%;
            align-items: center;
            flex-wrap: nowrap;
            flex-direction: column;
        }
        .attributes-container .increase-btn {
            background-color: #0a8c00; /* 绿色 */
            border: none;
            color: #fff;
            padding: 1px 5px;
            text-align: justify;
            text-decoration: none;
            display: flow;
            font-size: 12px;
            gap: 0px;
            margin: 0px 0px 0px 0px;
            cursor: pointer;
            border-radius: 5px;
        }    
        
        .attributes-container .increase-btn:hover {
            background-color: #45a049; /* 深绿色 */
        }

        .quality-container {
            display: flex;
             /* 使两个子容器分布在容器的两边 */
            gap: 2px; /* 调整两列之间的间距 */
            flex-direction: column;
        }
        
        .quality-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            flex-direction: row;
            padding: 0px 0px 10px 0px;
            gap: 5px 0px; /* 调整每个条目之间的间距 */
            font-size: 14px;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .image-frame img {
            max-width: 100%;
            max-height: 100%;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px 0px; /* 调整按钮之间的间距 */
            align-items: stretch;
            justify-items: stretch;
            padding: 15px 0px;
        }
        .button-grid button {
            padding: 8px 0px;
            width: 90%;
            font-size: 12px; /* 调整按钮字体大小 */
            /* 你可以在这里添加更多的样式来定制按钮的外观 */
        }
        .treasure-drawer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .treasure-drawer.open {
            transform: translateY(0);
        }
        .treasure-info {
            display: none;
            padding: 5px;
        }
        .treasure-info.open {
            display: block;
        }
        .treasure-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .reward-box {
            display: flex;
            background-color: #f1f0f0;
            border-radius: 10px;
            text-align: center;
            flex-direction: row;
            justify-content: center;
            margin: 5px;
            padding: 5px;
        }
        .treasure-action {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .treasure-action button {
            padding: 5px 10px;
            background-color: #088c01;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .treasure-action button:active {
            background-color: #064701;
        }
        /* 锦囊抽屉样式 */
        .jinnang-drawer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .jinnang-drawer.open {
            transform: translateY(0);
        }
        .jinnang-info {
            display: flex;
            padding: 15px;
            justify-items: center;
        }
        .jinnang-info.open {
            display: block;
        }
        .jinnang-reward {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px 5px;
            justify-content: center;
            margin-top: 5px;
        }
        .jinnang-reward img {
            width: 40px;
            height: 40px;
        }
        .red-text {
            color: #088c01;
        }
        .gold-text {
            color: #ff1100;
        }
        .message-box {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ccc;
            z-index: 1000;
            text-align: center; /* 中心对齐 */
            border-radius: 5px; /* 圆角 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 添加阴影 */
        }
        
        .message-box button {
            margin-top: 10px; /* 按钮与文本之间的间距 */
            padding: 5px 10px; /* 按钮内边距 */
            background-color: #0a8c00; /* 按钮背景颜色 */
            color: white; /* 按钮文本颜色 */
            border: none; /* 去除边框 */
            border-radius: 3px; /* 按钮圆角 */
            cursor: pointer; /* 鼠标指针样式 */
        }
        
        .message-box button:hover {
            background-color: #0056b3; /* 按钮悬停颜色 */
        }
        
/* lottery.css */
.lottery-drawer {
    position: fixed;
    margin: 0px 0px 0px 0px;
    padding: 20px 0px 0px 0px;
    bottom: 0px;
    width: 95%;
    background-color: rgb(255 255 255 / 90%);
    
     /* 图片平铺 */
     /* 保持原图大小 */
     /* 背景固定 */
    box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    border-radius: 10px 10px 0 0;
    transform: translateY(100%);
    transition: transform 0.3s;
    /* z-index: 0; */
    max-height: 90%;
    overflow-y: auto;
}

.lottery-drawer.open {
    transform: translateY(0);
}

.lottery-section {
    padding: 5px 0px 10px 0px;
    display: flex;
    flex-direction: row;
    align-items: center;
    flex-wrap: wrap;
    align-content: space-around;
    justify-content: space-evenly;
}

.lottery-top {
    margin-bottom: 0px;
    width: 100%;
}
.lottery-middle {
    margin-bottom: 0px;
    width: 100%;
    align-items: center;
}
.lottery-bottom {
    margin-bottom: 0px;
    width: 100%;
}
.lottery-footer {
    margin-bottom: 10px;
    width: 100%;
    display: flex;
}
.lottery-box, .lottery-number-box {
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    padding: 0px;
    margin: 5px 0;
    text-align: justify;
    background-color: #f9f9f9;
    font-weight: bold;
}
.lottery-number-box {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin: 15px 0;
    text-align: center;
    background-color: #f9f9f9;
}

.lottery-number-box {
    display: flex;
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
    gap: 5px;
    padding: 0px;
    flex-direction: column;
}

#lotteryNumberButtons button {
    margin: 5px;
    gap: 2px;
    padding: 5px;
    background-color: #ff1100;
    border-radius: 50%;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
}

#lotteryNumberButtons button:hover {
    background-color: #6a0700;
}

.lottery-controls {
    display: flex;
    justify-content: center;
    gap: 0px 10px;
    padding: 5px;
    flex-direction: row;
}

.lottery-footer button {
    width: 21%;
    display: flex;
    margin-top: 5px;
    background-color: #0a8c00;
    padding: 5px;
    color: rgb(255 255 255 / 90%);
    font-size: 16px;
    justify-content: center;
    border-radius: 10px;
}

.lottery-footer button:hover {
    background-color: #086600;
}
/* lottery.css */
.lottery-controls button {
    padding: 2px 10px;
    margin: 2px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
}

.lottery-controls #lotteryBetButton {
    background-color: #0056b3;
    color: white;
}

.lottery-controls #lotteryBetButton:hover {
    background-color: #003670;
    transform: scale(1.05);
}

.lottery-controls #lotteryIncreaseBet {
    background-color: #0a8c00;
    color: white;
}

.lottery-controls #lotteryIncreaseBet:hover {
    background-color: #064701;
    transform: scale(1.05);
}
.lottery-controls #lotteryIncreaseTenBet {
    background-color: #0a8c00;
    color: white;
}

.lottery-controls #lotteryIncreaseTenBet:hover {
    background-color: #064701;
    transform: scale(1.05);
}
.lottery-controls #lotteryRuleButton {
    background-color: #0056b3;
    color: white;
}

.lottery-controls #lotteryRuleButton:hover {
    background-color: #003670;
    transform: scale(1.05);
}
.lottery-controls #lotteryDecreaseBet {
    background-color: #dc3545;
    color: white;
}

.lottery-controls #lotteryDecreaseBet:hover {
    background-color: #841520;
    transform: scale(1.05);
}
/* lottery.css */
.highlight {
    animation: highlight 1s ease-in-out;
}

@keyframes highlight {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.5);
    }
}
/* lottery.css */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 10px;
    border: 1px solid #888;
    width: 90%;
    max-width: 600px;
    border-radius: 10px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
.battle-system-drawer {
    display: none;
    position: absolute;
    right: 0px;
    top: 0;
    height: 100%;
    width: 100%;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    box-shadow: -3px 0 5px rgba(0,0,0,0.2);
    z-index: 1000;
    overflow-y: auto;
    padding: 10px 0px 0px 0px;
}

.battle-system-drawer-toggle {
    font-size: 24px;
    cursor: pointer;
    padding: 0px 0px 10px 0px;
    text-align: left;
}

.battle-system-content {
    display: flex;
    gap: 10px;
    flex-direction: column;
    padding: 10px;
    width: 100%;
}

.battle-system-info-wrapper {
    display: flex;
    gap: 10px;
    width: 100%;
    flex-direction: row;
    justify-content: space-between;
}

.battle-system-pet-info, .battle-system-enemy-info {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 0;
    font-size: 14px;
    flex: 1;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
}

.battle-system-log {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 0px;
    height: 25%;
    overflow-y: auto;
    font-size: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    width: 94%;
}

.battle-system-actions {
    display: flex;
    gap: 10px;
    width: 100%;
    flex-direction: row;
    flex-wrap: nowrap;
}

.battle-system-actions button {
    padding: 5px;
    cursor: pointer;
    border: 1px solid #ffffff;
    width: 100%;
    background-color: #0a8c00;
    color: #ffffff;
    font-size: 14px;
    text-align: center;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.battle-system-actions button:hover {
    background-color: #064701;
}
#visualEffectsContainer {
    position: relative;
    width: 95%;
    height: 0px;
}
@keyframes critical-hit {
    0% {
        border: 5px solid red;
    }
    100% {
        border: 1px solid rgb(255 255 255 / 0%);
    }
}

.battle-system-log.critical-hit {
    animation: critical-hit 0.3s forwards;
}

.visual-effect {
    position: absolute;
    width: 50px;
    height: 50px;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    opacity: 0;
    transform: scale(0);
    transition: transform 0.5s ease, opacity 0.5s ease;
}

#playerEffect {
    left: 20%;
    top: 50%;
    background-color: rgba(0, 255, 0, 0.5);
}

#enemyEffect {
    right: 20%;
    top: 50%;
    background-color: rgba(255, 0, 0, 0.5);
}

.show-effect {
    opacity: 1;
    transform: scale(1);
}
.status-display {
    font-size: 14px;
    margin-top: 0px;
    color: red;
    font-weight: bold;
}
#battle-spirit-modal {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 10px;
    width: 80%;
    border: 2px solid #ccc;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

#battle-spirit-modal .modal-content {
    display: flex;
    flex-direction: column;
    align-items: center;
}

#battle-spirit-modal button {
    background: #a70b00;
    border-color: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 14px;
    ga'padding: gap';
    border-radius: 5px;
    margin: 5px;
}

   </style>
</head>
<body>
    <div id="loadingOverlay">
        <div id="loadingText">加载中... 0%</div>
        <div id="progressBarContainer">
            <div id="progressBar"></div>
        </div>
    </div>
    <div class="core-area">
        <div class="buttons">
            <div class="button-row">
                <button id="guideButton" onclick="showGuide()">玩法</button>
                <button id="drawerButton" onclick="toggleDrawer()">资质</button>
                <button id="attributeButton" onclick="toggleAttributeDrawer()">属性</button>
                <button id="shopButton" onclick="toggleShop()">商店</button> 
                <button id="treasureButton" onclick="toggleTreasureDrawer()">宝箱</button>
                <button id="jinnangButton" onclick="toggleJinnangDrawer()">锦囊</button>
                <button id="fightingButton" onclick="toggleFightingDrawer()">战斗</button>
                <button id="lotteryButton" onclick="toggleLotteryDrawer()">彩票</button>
            </div>
        </div>
        <div class="skills" id="skills-area"></div>
    </div>
    <div class="top-bar">
        <div>
            <img src="https://pic.imgdb.cn/item/66541c01d9c307b7e9208aea.png" alt="高级悟性丹">
            <div>悟性丹</div>
            <div><span id="high-grade-pill">100</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/66541c01d9c307b7e9208add.png" alt="万化灵丹">
            <div>万化灵丹</div>
            <div><span id="transmutation-pill">20</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/6654a944d9c307b7e9ca6423.png" alt="神兽还童丹">
            <div>还童丹</div>
            <div><span id="reborn-pill">20</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/6655a92ad9c307b7e9c04265.png" alt="还童金丹">
            <div>还童金丹</div>
            <div><span id="golden-reborn-pill">5</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/665ef0855e6d1bfa055800f4.png" alt="冰魄还童丹">
            <div>冰魄丹</div>
            <div><span id="bingpo-reborn-pill">5</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/6654a944d9c307b7e9ca63f5.png" alt="资质重生丹">
            <div>资质金丹</div>
            <div><span id="quality-pill">20</span></div>
        </div>
        <div>
            <img src="https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png" alt="灵异金丹">
            <div>灵异丹</div>
            <div><span id="miraculous-pill">1</span></div>
        </div>
    </div>
    <div class="pet-selector">
        <select id="pet-select" onchange="changePet()">
            <option value="yanzhi">胭脂</option>
            <option value="zhulin">竹林隐士</option>
            <option value="jinmin">金珉奎</option>
            <option value="zhanshen">战神阿毛</option>
            <option value="tengshe">腾蛇</option>
            <option value="qingmou">青眸白虎</option>
            <option value="jingjue">净角神将</option>
            <option value="shanggu">上古神藤</option>
            <option value="guhe">古河锦鲤</option>
            <option value="banlan">斑斓公主</option>
            <option value="juling">巨灵战姬</option>
            <option value="aoshi">敖十七</option>
            <option value="daming">妲茗儿</option>
        </select>
    </div>
    <div class="quality-drawer" id="quality-drawer">
        <div class="drawer-toggle" onclick="toggleDrawer()">宠物资质</div>
        <div class="quality-info" id="quality-info">
            <div class="quality-container">
                <div class="quality-details">
                    <div>名称: <span id="quality-name">胭脂</span></div>
                    <div>段位: <span id="quality-tier">普通</span></div>
                    <div>成长率: <span id="quality-growth-rate">100%</span></div>
                    <div>变异: <span id="quality-mutated">未变异</span></div>
                    <div>进化等级: <span id="evolution-level">0</span></div>
                </div>
            </div>
            <div class="progress-bar">
                耐力: <span id="endurance-current">4500</span> / <span id="endurance-max">8700</span>
                <div id="endurance-bar" style="width: 50%"></div>
            </div>
            <div class="progress-bar">
                强壮: <span id="strength-current">2250</span> / <span id="strength-max">3750</span>
                <div id="strength-bar" style="width: 50%"></div>
            </div>
            <div class="progress-bar">
                信仰: <span id="faith-current">2250</span> / <span id="faith-max">3750</span>
                <div id="faith-bar" style="width: 50%"></div>
            </div>
            <div class="progress-bar">
                敏捷: <span id="agility-current">2500</span> / <span id="agility-max">4300</span>
                <div id="agility-bar" style="width: 50%"></div>
            </div>
            <div class="progress-bar">
                智力: <span id="intelligence-current">5250</span> / <span id="intelligence-max">10350</span>
                <div id="intelligence-bar" style="width: 50%"></div>
            </div>
                <div class="button-grid">
                    <button onclick="rebornPet()">普通还童</button>
                    <button onclick="trainQuality()">一键还童</button>
                    <button onclick="useGoldenRebornPill()">还童金丹</button>
                    <button onclick="useBingpoRebornPill()">冰魄还童</button>
                    <button onclick="enhanceQuality()">更新资质</button>
                    <button onclick="mutatePet()">变异宠物</button>
                    <button onclick="evolvePet()">进化宠物</button>
                    <button onclick="showBiography()">解锁传记</button>
                </div>
            <div id="message-box" class="message-box">
                <span id="message-text"></span>
                <button onclick="closeMessage()">关闭</button>
            </div>
        </div>
    </div>
    <div class="attribute-drawer" id="attribute-drawer">
        <div class="drawer-toggle" onclick="toggleAttributeDrawer()">属性</div>
        <div class="attribute-info" id="attribute-info">
            <div class="attributes-container">
                <div class="progress-bars">
                    <div class="progress-bar">
                        耐力: <span id="attribute-endurance"></span><button class="increase-btn" onclick="increaseBonusAttribute('endurance')">＋</button>
                    </div>
                    <div class="progress-bar">
                        智力: <span id="attribute-intelligence"></span><button class="increase-btn" onclick="increaseBonusAttribute('intelligence')">＋</button>
                    </div>
                    <div class="progress-bar">
                        强壮: <span id="attribute-strength"></span><button class="increase-btn" onclick="increaseBonusAttribute('strength')">＋</button>
                    </div>
                    <div class="progress-bar">
                        敏捷: <span id="attribute-agility"></span><button class="increase-btn" onclick="increaseBonusAttribute('agility')">＋</button>
                    </div>
                    <div class="progress-bar">
                        信仰: <span id="attribute-faith"></span><button class="increase-btn" onclick="increaseBonusAttribute('faith')">＋</button>
                    </div>
                    <div id="remaining-points-display">剩余点数: 0</div>
                    <div>宠物评分: <span id="skill-score">0</span></div>
                </div>
                <div class="image-frame">
                    <img src="https://pic.imgdb.cn/item/665d02afd9c307b7e903151b.png" alt="神兽之地">
                    <div>修炼之地</div>
                </div>
                <div class="secondary-attributes">
                    <div class="progress-bar">
                        宠物等级: <span id="pet-level">1</span>
                    </div>
                    <div class="progress-bar">
                        品质: <span id="attribute-tier"></span>
                    </div>
                    <div class="progress-bar">
                        成长率: <span id="attribute-growth-rate"></span>
                    </div>
                    <div class="progress-bar">
                        悟性: <span id="attribute-wisdom"></span>
                    </div>
                    <div>HP: <span id="secondary-health"></span> <span id="secondary-health-bonus"></span></div>
                    <div>MP: <span id="secondary-mana"></span> <span id="secondary-mana-bonus"></span></div>
                    <div>物攻: <span id="secondary-physical-attack"></span> <span id="secondary-physical-attack-bonus"></span></div>
                    <div>物防: <span id="secondary-physical-defense"></span> <span id="secondary-physical-defense-bonus"></span></div>
                    <div>法攻: <span id="secondary-magic-attack"></span> <span id="secondary-magic-attack-bonus"></span></div>
                    <div>法防: <span id="secondary-magic-defense"></span> <span id="secondary-magic-defense-bonus"></span></div>
                    <div>速度: <span id="secondary-speed"></span> <span id="secondary-speed-bonus"></span></div>
                </div>
            </div>
            <div class="button-grid">
                <button onclick="trainSkills()">洗练技能</button>
                <button onclick="trainAttributes()">金子培养</button>
                <button onclick="absorbExperience()">普通修炼</button>
                <button onclick="absorbAdvancedExperience()">高级修炼</button>
                <button onclick="upgradeWisdom()">提升悟性</button>
                <button onclick="upgradeWisdomTo()">一键提悟</button>
                <button onclick="useSupremeWisdomPill()">神级领悟</button>
                <button onclick="ascend()">飞升突破</button>
                <button onclick="awakenPet()">觉醒宠物</button>
                <button onclick="hallucinatePet()">幻化提升</button>
            </div>
        </div>
    </div>
    <div class="shop-drawer" id="shop-drawer">
        <div class="drawer-toggle" onclick="toggleShop()">商店</div>
        <div class="shop-info" id="shop-info">
            <div class="shop-items" id="shop-items">
                <!-- 商店商品展示区 -->
            </div>
            <div class="shop-bar">
                <button onclick="buyItem()">购买道具</button>
                <button onclick="sellPet()">出售宠物</button>
                <div class="shop-timer">
                    <span id="shop-timer">05:00</span>
                    <button onclick="refreshShop()">付费刷新</button>
                </div>
            </div>
        </div>
    </div>   
    <div class="treasure-drawer" id="treasure-drawer">
        <div class="drawer-toggle" onclick="toggleTreasureDrawer()">宝箱</div>
        <div class="treasure-info" id="treasure-info">
            <div class="treasure-bar">
            <div>
                <img src="https://pic.imgdb.cn/item/6656e598d9c307b7e906ca29.png" onclick="selectTreasure('经验宝箱')">
                <div>经验宝箱</div>
            </div>
            <div>
                <img src="https://pic.imgdb.cn/item/6656e598d9c307b7e906ca29.png" onclick="selectTreasure('奇馈宝箱')">
                <div>奇馈宝箱</div>
            </div>
            <div>
                <img src="https://pic.imgdb.cn/item/6656e598d9c307b7e906ca29.png" onclick="selectTreasure('灵魂宝箱')">
                <div>灵魂宝箱</div>
            </div>
            <div>
                <img src="https://pic.imgdb.cn/item/6656e598d9c307b7e906ca29.png" onclick="selectTreasure('至尊宝箱')">
                <div>至尊宝箱</div>
            </div>
            </div>
            <div id="treasure-description" class="treasure-description-box"></div>
            <div id="treasure-reward" class="reward-box"></div>
            <div class="treasure-action">
                <button onclick="openTreasure()">打开宝箱</button>
                <button onclick="collectTreasure()">取出奖品</button>
            </div>
        </div>
    </div>
    <div class="jinnang-drawer" id="jinnang-drawer">
        <div class="drawer-toggle" onclick="toggleJinnangDrawer()">背包</div>
        <div class="jinnang-info" id="jinnang-info">
            <div class="jinnang-reward" id="jinnang-reward"></div>
        </div>
    </div>
    <div class="lottery-drawer" id="lotteryDrawer">
        <div class="lottery-section lottery-top">
            <div class="lottery-box" id="lotteryPrizePool">奖池: 无上限奖池</div>
            <div class="lottery-box" id="lotteryBetCount">投注数: 0</div>
            <div class="lottery-box" id="lotteryBetAmount">投注金: 0</div>
        </div>
        <div class="lottery-section lottery-middle">
            <div class="lottery-box" id="lotteryDrawResults">开奖区: </div>
            <div class="lottery-box" id="lastSelectedNumbers">上次选号: </div>
            <div class="lottery-number-box" id="lotteryAvailableNumbers">备选区: 
                <div id="lotteryNumberButtons"></div>
            </div>
            <div class="lottery-controls">
                <button id="lotteryBetButton">投注</button>
                <button id="lotteryIncreaseBet">+1</button>
                <button id="lotteryIncreaseTenBet">+10</button>
                <button id="lotteryDecreaseBet">-1</button>
                <button id="lotteryRuleButton">规则</button>
                <!-- 规则信息框 -->
                <div id="lotteryRuleModal" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <div id="ruleContent"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="lottery-section lottery-bottom">
            <div class="lottery-number-box" id="lotterySelectedNumbers">已选: </div>
            <div class="lottery-box" id="lotteryResultAmount">奖金区: 0</div>
        </div>
        <div class="lottery-section lottery-footer">
            <div class="lottery-box" id="lotteryCountdown">倒计时: 10s</div>
            <button id="lotteryClaimPrize">领取奖金</button>
        </div>
    </div>
    <div id="fightingDrawer" class="battle-system-drawer">
        <div class="battle-system-content">
        <div class="battle-system-drawer-toggle" onclick="toggleFightingDrawer()">&times;</div>
            <div class="battle-system-info-wrapper">
                <div class="battle-system-pet-info">
                    <h2>当前宠物</h2><div id="player-status" class="status-display"></div>
                    <p>生命值: <span id="your-pet-health"></span></p>
                    <p>法力值: <span id="your-pet-mana"></span></p>
                    <p>物理攻击: <span id="your-pet-physical-attack"></span></p>
                    <p>物理防御: <span id="your-pet-physical-defense"></span></p>
                    <p>法术攻击: <span id="your-pet-magic-attack"></span></p>
                    <p>法术防御: <span id="your-pet-magic-defense"></span></p>
                    <p>速度: <span id="your-pet-speed"></span></p>
                    <div id="exp-bar-container">
                    <p>经验值:<span id="exp-bar">0 / 208</span></p>
                    </div>
                </div>
                <div class="battle-system-enemy-info">
                    <h2>无尽の怪(物理)</h2><div id="enemy-status" class="status-display"></div>
                    <p>生命值: <span id="enemy-pet-health"></span></p>
                    <p>法力值: <span id="enemy-pet-mana"></span></p>
                    <p>物理攻击: <span id="enemy-pet-physical-attack"></span></p>
                    <p>物理防御: <span id="enemy-pet-physical-defense"></span></p>
                    <p>法术攻击: <span id="enemy-pet-magic-attack"></span></p>
                    <p>法术防御: <span id="enemy-pet-magic-defense"></span></p>
                    <p>速度: <span id="enemy-pet-speed"></span></p>
                </div>
            </div>
            <div id="visualEffectsContainer">
                <div id="playerEffect" class="visual-effect"></div>
                <div id="enemyEffect" class="visual-effect"></div>
            </div>
            <!-- 战斗精灵弹出界面 -->
            <div id="battle-spirit-modal" style="display: none;">
                <div>
                    <h2>战斗精灵（已觉醒）</h2>
                    <p>等级: <span id="spirit-level">1</span></p>
                    <p>增幅: <span id="spirit-multiplier">1.00</span></p>
                    <p>生命值增加: <span id="spirit-health">0</span></p>
                    <p>法力值增加: <span id="spirit-mana">0</span></p>
                    <p>物理攻击增加: <span id="spirit-physical-attack">0</span></p>
                    <p>物理防御增加: <span id="spirit-physical-defense">0</span></p>
                    <p>法术攻击增加: <span id="spirit-magic-attack">0</span></p>
                    <p>法术防御增加: <span id="spirit-magic-defense">0</span></p>
                    <p>速度增加: <span id="spirit-speed">0</span></p>
                    <button id="level-up-spirit">精灵升级</button>
                    <button id="enhance-spirit">增幅洗练</button>
                    <button id="close-spirit-modal">关闭面板</button>
                </div>
            </div>
            <div class="battle-system-log">
                <h2>战斗记录</h2>
                <div id="log"></div>
            </div>
            <div class="battle-system-actions">
                <button onclick="performAttack('physical')">物理攻击</button>
                <button onclick="performAttack('magical')">法术攻击</button>
                <button onclick="performHeal()">治疗之术</button>
                <button id="battle-spirit-button">精灵面板</button>
            </div>
            
        </div>
    </div>
    <div class="bottom-bar">
        <div class="pet-image">
            <img id="pet-image" src="https://pic.imgdb.cn/item/66542639d9c307b7e92c235d.gif" alt="胭脂">
        </div>
        <div class="info">
            <div>宠物名称: <span id="pet-name">胭脂</span></div>
            <div>当前悟性: <span id="current-wisdom">0</span></div>
            <div>洗练次数: <span id="train-count">0</span></div>
            <div>剩余金子: <span id="gold-amount">50000</span></div> <!-- 新增剩余金子显示 -->
        </div>
    </div>    
    <div class="description-box" id="description-box"></div>
    </div>
    <script>
        const pets = {
            yanzhi: {
                name: '胭脂',
                image: 'https://pic.imgdb.cn/item/66542639d9c307b7e92c235d.gif',
                skills: [
                    { name: '法术精通', rarity: 'A', description: '被动技能，法术攻击上升' },
                    { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                    { name: '万法归宗', rarity: 'B', description: '被动技能，法术暴击上升' },
                    { name: '仙风道骨', rarity: 'A', description: '被动技能，耐力、敏捷、强壮大幅提升。' },
                    { name: '长寿', rarity: 'B', description: '被动技能，寿命上限上升' },
                    { name: '法力吸取·法术', rarity: 'B', description: '对目标造成法术伤害并吸取一定得法力值' },
                    { name: '女神外壳', rarity: 'A', description: '被动技能，物理和法术防御上升。' },
                    { name: '全面进化', rarity: 'S', description: '被动技能，耐力、敏捷、强壮上升' },
                    { name: '妩媚身姿', rarity: 'A', description: '被动技能，身型婀娜。提高自身物理和法术闪避。' },
                    { name: '智慧守护', rarity: 'S', description: '被动技能，通过追随智慧与战斗的守护者，使此生物学会用法力值抵消一部分受到的伤害。可抵消的比例根据技能等级而定。' },
                    { name: '月之祝福', rarity: 'A', description: '被动技能，耐力、敏捷、智力上升' },
                    { name: '硕果累累', rarity: 'SS', description: '胭脂抖了抖身，漫天果实坠落，对横排敌人造成法术伤害，并以35%的概率，施加3回合迟缓状态。根据自身血量上限增加威力。' },
                    { name: '琼珠玉液', rarity: 'SS', description: '胭脂小手一挥，消耗自身60%寿命，百分百驱散我方全体成员的部分负面状态（破甲，减攻，迟缓，眩晕，中毒，灼烧，流血，混乱，冻伤，沉睡，沉默，虚弱，冷嘲热讽）并恢复血量，胭脂血量上限越高回复量越多。' },
                    { name: '灼若旭日', rarity: 'SS', description: '胭脂单手投掷石榴花给单体目标造成法术伤害，按伤害量20%减少目标HP上限，单次最多可减少目标2%HP上限，并根据伤害少量恢复我方全体成员的血量。' },
                    { name: '春风徐徐', rarity: 'SS', description: '被动技能，胭脂每回合有概率生成霸体护盾，护盾可免疫部分负面状态（破甲，减攻，迟缓，眩晕，中毒，灼烧，流血，混乱，冻伤，沉睡，沉默，虚弱，冷嘲热讽），成功生成时，将消耗一定的寿命。' },
                    { name: '榴花如丹', rarity: 'SS', description: '被动技能，榴花如丹红似火，源源不断为胭脂永久提升耐力。' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 4500, min: 4500, max: 8700 },
                    strength: { current: 2250, min: 2250, max: 3750 },
                    faith: { current: 2250, min: 2250, max: 3750 },
                    agility: { current: 2500, min: 2500, max: 4300 },
                    intelligence: { current: 5250, min: 5250, max: 10350 },
                    mutated: false
                },
            },
            zhanshen: {
                name: '战神阿毛',
                image: 'https://pic.imgdb.cn/item/665c7002d9c307b7e9897757.gif',
                skills: [
                    { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复。' },
                    { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加。增加的寿命值与生物种类，技能等级有关。' },
                    { name: '破军神力', rarity: 'B', description: '被动技能，宠物获得大量的物理攻击力和法术攻击力。' },
                    { name: '黄金战甲', rarity: 'B', description: '被动技能，身着坚不可摧的的黄金战甲。物理防御、法术防御及生命大幅度上升。' },
                    { name: '元素力量（宽容）（17悟）', rarity: 'A', description: '被动技能，减免受到群体攻击的伤害。' },
                    { name: '神威之怒（18悟）', rarity: 'A', description: '被动技能，此技能可使宠物获得大量的物理攻击力。' },
                    { name: '法力吸取（物理）', rarity: 'A', description: '单体物理攻击并吸取法力值。' },
                    { name: '离子护盾（19悟）', rarity: 'S', description: '被动技能，被离子护盾包围，受到敌人攻击后敌人会有几率触电而被百分比破甲，破甲效果随技能等级和宠物修为增加而增强。' },
                    { name: '刮痧刃（17式）', rarity: 'S', description: '战神阿毛引以为傲的刀法，对敌方连续发动十次物理攻击，给予敌方沉痛打击。' },
                    { name: '追日', rarity: 'S', description: '被动技能，速度大幅度提升。' },
                    { name: '刮痧刃（奥义）（天奇徽章：1000）', rarity: 'SS', description: '刮痧刃最高境界，手中无刃心中也无刃，但可召唤山石从天而降！使敌人无法躲藏（必中）！对敌方造成大量物理伤害，同时有几率晕眩敌人，技能伤害和晕眩几率随技能等级提升而提升。' },
                    { name: '誓死守护（20悟）', rarity: 'SS', description: '被动技能，阿毛在场时，可替主人承受部分伤害，技能等级越高，承受伤害越高。' }
                ],
                qualities: {
                    endurance: { current: 4500, min: 4500, max: 6500 },
                    strength: { current: 6750, min: 6750, max: 9250 },
                    faith: { current: 1800, min: 1800, max: 3200 },
                    agility: { current: 4950, min: 4950, max: 7050 },
                    intelligence: { current: 1350, min: 1350, max: 2650 },
                    mutated: false
                }
            },
            jinmin: {
                name: '金珉奎',
                image: 'https://pic.imgdb.cn/item/6669a02bd9c307b7e935f2a2.jpg',
                skills: [
                    { name: '唯爱结城', rarity: 'SS', description: '如果此生只能爱一人，她的姓，必须是结城。' },
                    { name: '跨国相遇', rarity: 'A', description: '在一个异国他乡的采访中，命运让他们相遇，从此开始了一段浪漫的爱情故事。' },
                    { name: '意外之事', rarity: 'B', description: '一次意外的车祸让他们被困在一个偏远的小镇，爱情在危险中悄然萌芽。' },
                    { name: '隐瞒身份', rarity: 'B', description: '他隐藏了自己的明星身份，只为在她面前做个普通人，享受片刻的平凡。' },
                    { name: '温柔一面', rarity: 'S', description: '她在后台看到了他温柔的一面，这让她对他有了新的认识。' },
                    { name: '共同依赖', rarity: 'S', description: '在偏远小镇的日子里，他们面对未知的危险，渐渐彼此依赖。' },
                    { name: '发现真心', rarity: 'A', description: '在谎言揭穿后，她终于看清了他的真心，两人决定坦然面对所有挑战。' },
                    { name: '日记重现', rarity: 'A', description: '一本旧日记让她找回了失去的记忆，重新记起了他们之间的点点滴滴。' },
                    { name: '心灵触动', rarity: 'SS', description: '看着他的真心付出，她的心灵被深深触动，爱情在心中萌芽。' },
                    { name: '保护她', rarity: 'S', description: '他在关键时刻挺身而出，保护她免受伤害，展现了真正的男子汉气概。' },
                    { name: '继父威胁', rarity: 'B', description: '继父的威胁不断升级，他挺身而出，保护她不受伤害。' },
                    { name: '记忆恢复', rarity: 'SS', description: '在危机中，她的记忆终于完全恢复，找回了曾经的甜蜜时光。' },
                    { name: '法律制裁', rarity: 'B', description: '他揭穿了继父的阴谋，让继父受到应有的法律制裁。' },
                    { name: '重返工作', rarity: 'A', description: '她重返《Fantasy!》杂志，继续她的事业，与他一起迎接未来的挑战。' },
                    { name: '幸福结局', rarity: 'SS', description: '经历了无数波折，他们最终找到了真正的幸福，成为彼此生命中最重要的存在。' },
                    { name: '守护夏奈', rarity: 'SS', description: '如果此生只能守护一人，她的名，必须是夏奈。' }
                ],
                qualities: {
                    endurance: { current: 4500, min: 4500, max: 6500 },
                    strength: { current: 6750, min: 6750, max: 13400 },
                    faith: { current: 1800, min: 1800, max: 3200 },
                    agility: { current: 4950, min: 4950, max: 7050 },
                    intelligence: { current: 3750, min: 3750, max: 10400 },
                    mutated: false
                }
            },
            tengshe: {
                name: '腾蛇',
                image: 'https://pic.imgdb.cn/item/665c7002d9c307b7e98976fe.gif',
                skills: [
                    { name: '长寿', rarity: 'B', description: '被动技能，寿命上升' },
                    { name: '战斗专注', rarity: 'B', description: '被动技能，法术暴击上升' },
                    { name: '法术精通', rarity: 'B', description: '被动技能，法功上升' },
                    { name: '生命祝福', rarity: 'B', description: '被动技能，生命值上升' },
                    { name: '美腿术', rarity: 'A', description: '被动技能，速度上升' },
                    { name: '女神外壳', rarity: 'A', description: '被动技能，物理和法术防御上升' },
                    { name: '智慧守护（17悟）', rarity: 'A', description: '被动技能，法力值抵消一部分受到的伤害' },
                    { name: '全面进化（18悟）', rarity: 'A', description: '被动技能，敏捷、耐力强壮增加' },
                    { name: '腾蛇突袭（19悟）', rarity: 'S', description: '腾蛇对敌人进行突袭，对敌方单体目标造成大量法术伤害，同时恢复本身血量，技能效果随技能等级提升而提升。' },
                    { name: '火焰反噬（20悟）', rarity: 'S', description: '腾蛇可以借助火之灵的力量将火焰精华加诸于己方竖排2个单位身上，对试图进行物理攻击的敌方目标造成灼烧状态.借助火之灵的力量需以自身寿命为献祭.灼烧造成的伤害与宠物的速度有关。' },
                    { name: '高级冥想', rarity: 'SS', description: '被动技能，通过冥想，回合结束时（所有人行动完毕后）恢复自身大量魔法，恢复魔法百分比随技能等级提升而提升,每场战斗结束后寿命额外减少10点。' },
                    { name: '红莲业火', rarity: 'SS', description: '腾蛇施放红莲业火对敌方报复，对敌方全体目标造成巨大法术伤害，并且造成灼烧效果,灼烧效果造成的伤害与宠物的速度有关。' },
                    { name: '幽冥剧毒', rarity: 'SS', description: '腾蛇施放幽冥剧毒，对敌方单体目标造成法术伤害，同时剧毒腐蚀敌人百分比法术护甲，腐蚀程度随技能等级、宠物修为增加而增强。' }
                ],
                qualities: {
                    endurance: { current: 2700, min: 2700, max: 4300 },
                    strength: { current: 900, min: 900, max: 2100 },
                    faith: { current: 2700, min: 2700, max: 4300 },
                    agility: { current: 6750, min: 6750, max: 9250 },
                    intelligence: { current: 6750, min: 6750, max: 9250 },
                    mutated: false
                }
            },
            zhulin: {
                name: '竹林隐士',
                image: 'https://pic.imgdb.cn/item/665433e8d9c307b7e93ac7ab.gif',
                skills: [
                { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加。增加的寿命值与生物种类，技能等级有关' },
                { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                { name: '意念凝聚', rarity: 'B', description: '被动技能，竹林隐士集中意念，攻击可大幅度忽略敌人的物理闪避和物理防御' },
                { name: '防护结界', rarity: 'B', description: '被动技能，法术防御上升' },
                { name: '仙风道骨', rarity: 'A', description: '被动技能，耐力、敏捷、强壮大幅提升' },
                { name: '智慧守护', rarity: 'A', description: '被动技能，通过追随智慧与战斗的守护者，使此生物学会用法力值抵消一部分受到的伤害。可抵消的比例根据技能等级而定' },
                { name: '离子护盾', rarity: 'A', description: '被动技能，被离子护盾包围，击中竹林神灵的敌人会有几率触电而被百分比破甲，破甲效果随技能等级和宠物修为增加而增强' },
                { name: '神威之怒', rarity: 'S', description: '被动技能，此技能可使宠物获得大量的物理攻击力' },
                { name: '雷魔爆', rarity: 'S', description: '群体物理攻击，对敌全体造成物理伤害并有几率附加破甲效果' },
                { name: '高能电弧', rarity: 'S', description: '竹林隐士献祭30%最大寿命，全力激发一道高能电弧传导至指定友方目标，为自身及目标充能，充能效果会大幅增加速度，增加的速度同竹林隐士的法术攻击力及技能等级有关' },
                { name: '雷霆万钧', rarity: 'SS', description: '竹林隐士献祭15%最大寿命，以雷霆万钧之速对敌方单体目标造成毁灭性的一击！（必中），双方的速度差距越大，技能所造成的伤害越高' },
                { name: '静电屏蔽', rarity: 'SS', description: '被动技能，竹林隐士出场时有几率使主人和自身免疫一切控制技能，几率随技能等级提升而增加' },
                { name: '怒意能场', rarity: 'SS', description: '被动技能，竹林隐士每成功闪避一次敌方的攻击，就会将自己的怒意转化为自己的物理攻击力，怒意状态最大可叠加三次，被击中则蓄能状态在本回合末结束' },
                { name: '离子风暴', rarity: 'SS', description: '竹林隐士将布满雷电的斗笠扔向敌人，对敌方全体造成极大物理伤害，同时大幅提升自己的物理暴击几率' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 2700, min: 2700, max: 4300 },
                    strength: { current: 9000, min: 9000, max: 12000 },
                    faith: { current: 3600, min: 3600, max: 5400 },
                    agility: { current: 3600, min: 3600, max: 5400 },
                    intelligence: { current: 1800, min: 1800, max: 3200 },
                    mutated: false
                }
            },
            qingmou: {
                name: '青眸白虎',
                image: 'https://pic.imgdb.cn/item/665433e7d9c307b7e93ac709.gif',
                skills: [
                { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加。增加的寿命值与生物种类，技能等级有关' },
                { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                { name: '法力吸取（物理）', rarity: 'B', description: '单体物理攻击并吸取法力值' },
                { name: '元素力量（两仪）', rarity: 'B', description: '被动技能，白虎身着坚不可摧的的两仪战甲，物理防御、法术防御大幅度上升' },
                { name: '智慧守护', rarity: 'A', description: '被动技能，被动技能,通过追随智慧与战斗的守护者,使此生物学会用法力值抵消一部分受到的伤害.可抵消的比例根据技能等级而定' },
                { name: '元素力量（赐福）', rarity: 'A', description: '被动技能，智力及强壮上升' },
                { name: '天神祝福', rarity: 'A', description: '被动技能，法术攻击力大幅提升' },
                { name: '元素力量（四相）', rarity: 'S', description: '白虎驭四相之力对敌方十字目标随机附加灼烧、冻伤、虚弱、迟缓效果。元素力量（四相）无法被躲避！' },
                { name: '虚无', rarity: 'S', description: '被动技能，速度大幅度提升' },
                { name: '元素力量（宽容）', rarity: 'S', description: '被动技能，减免受到群体攻击的伤害' },
                { name: '元素力量（结界）', rarity: 'SS', description: '被动技能，当白虎进入战场时可触发法力结界效果，使其主人首回合免疫一部分法术蓝伤' },
                { name: '烈光剑阵', rarity: 'SS', description: '白虎用法力凝聚成无数灼热的光剑，对敌方横排5个目标造成巨大伤害，100%附加灼烧伤害。敌方速度越快，灼烧伤害越猛烈' },
                { name: '元素力量（不屈）', rarity: 'SS', description: '白虎在最勇猛的战士体内封印不屈的战魂印记，激发其斗志，使其在战斗中时刻保持清醒的神智！仅消耗20%寿命为已方增加一个微量流血状态，使其不会受到持续睡眠的影响。技能等级越高，流血量越低，效果持续回合越多' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 5850, min: 5850, max: 8150 },
                    strength: { current: 1800, min: 1800, max: 3200 },
                    faith: { current: 5400, min: 5400, max: 7600 },
                    agility: { current: 6300, min: 6300, max: 8700 },
                    intelligence: { current: 1800, min: 1800, max: 3200 },
                    mutated: false
                }
            },
            jingjue: {
                name: '净角神将',
                image: 'https://pic.imgdb.cn/item/665433e8d9c307b7e93ac76d.gif',
                skills: [
                { name: '天生蛮力', rarity: 'B', description: '被动技能，物理攻击上升' },
                { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                { name: '战斗狂热', rarity: 'A', description: '被动技能，物理爆击、速度上升' },
                { name: '全面进化', rarity: 'S', description: '被动技能，耐力、敏捷、强壮上升' },
                { name: '仙风道骨', rarity: 'A', description: '被动技能，耐力、敏捷、强壮大幅提升' },
                { name: '长寿', rarity: 'B', description: '被动技能，寿命上限上升' },
                { name: '防护结界', rarity: 'B', description: '被动技能，法术防御上升' },
                { name: '黄金战甲', rarity: 'B', description: '被动技能，身着坚不可摧的的黄金战甲。物理防御、法术防御及生命大幅度上升' },
                { name: '法力吸取（物理）', rarity: 'B', description: '单体物理攻击并吸取法力值' },
                { name: '横扫千军', rarity: 'SS', description: '净角神将利用手中长刀横扫敌人，对敌方全体造成物理伤害' },
                { name: '所向披靡', rarity: 'SS', description: '被动技能，净角神将可以吸取灵域力量为自己所用，永久增加自身物理攻击力' },
                { name: '灵域行者', rarity: 'SS', description: '被动技能，净角神将进入灵域可以快速穿梭于时空之中，增加自身速度' },
                { name: '饮鸩止渴', rarity: 'S', description: '以毒作引突破身体极限，净角神将牺牲自身寿命的60%增加自身一定物理攻击，持续整场战斗' },
                { name: '灵域处刑', rarity: 'SS', description: '净角神将可以观察到敌人灵魂深处的弱点，对敌方单体造成物理伤害，造成伤害后若敌人生命值低于净角神将物理攻击的50%(随技能等级提高比例)，将被直接斩杀。此技能必中' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 2750, min: 2750, max: 4850 },
                    strength: { current: 5000, min: 5000, max: 9800 },
                    faith: { current: 2250, min: 2250, max: 3750 },
                    agility: { current: 4500, min: 4500, max: 8700 },
                    intelligence: { current: 2250, min: 2250, max: 3750 },
                    mutated: false
                }
            },
            shanggu: {
                name: '上古神藤',
                image: 'https://pic.imgdb.cn/item/665433e8d9c307b7e93ac758.gif',
                skills: [
                { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长，被动技能，寿命上限增加，增加的寿命值与生物种类，技能等级有关' },
                { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                { name: '风仪玉立', rarity: 'B', description: '被动技能，上古神藤速度大幅提升' },
                { name: '高级援护', rarity: 'B', description: '援护己方单一目标' },
                { name: '盘根错节', rarity: 'A', description: '将自身力量注入大地，大地之子将以树枝穿刺的方法对十字范围内的敌人造成物理伤害，并有几率附加藤蔓缠绕的效果降低目标速度' },
                { name: '物华天宝', rarity: 'A', description: '被动技能，上古神藤经年累月的吸收日月精华成为天地间一奇物，强壮、耐力、敏捷大幅度提升' },
                { name: '智慧守护', rarity: 'A', description: '被动技能，被动技能,通过追随智慧与战斗的守护者,使此生物学会用法力值抵消一部分受到的伤害.可抵消的比例根据技能等级而定' },
                { name: '破军神力', rarity: 'A', description: '被动技能，被动技能，在破军星的庇佑下，人类可获得强大的战力，会此技能可使宠物获得大量的物理攻击力和法术攻击力' },
                { name: '蚍蜉撼树', rarity: 'S', description: '被动技能，敌人的力量在上古神藤前如同蚍蜉撼树。借助大地守护者的力量，在受到群体攻击时，减免部分伤害，减免的额度与技能等级有关' },
                { name: '仁者无敌', rarity: 'SS', description: '仁慈的强者通过宽恕敌人亦可通往无敌之路。消耗40%寿命治疗敌方六单位并给自身添加2回合霸体效果' },
                { name: '木魔爆', rarity: 'SS', description: '召唤木之灵对敌方全体目标造成巨大伤害，并附加藤蔓缠绕效果三回合。木之灵产生的伤害需以召唤者的物理攻击为基础，召唤木之灵需以自身寿命作为祭献，藤蔓缠绕效果会大大降低对手的物理暴击率' },
                { name: '一叶障目', rarity: 'SS', description: '上古神藤神力凝聚的一片树叶，对单个敌人造成伤害，并有几率使敌人失明，此技能无法闪避' },
                { name: '洞天福地', rarity: 'SS', description: '上古神藤通过神力凝聚的洞天福地空间，消耗40%寿命指定己方单体目标释放，洞天福地中可避免部分法术蓝伤和部分控制技能，持续2回合，出手速度随技能等级增加' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 5850, min: 5850, max: 8150 },
                    strength: { current: 4500, min: 4500, max: 6500 },
                    faith: { current: 3600, min: 3600, max: 5400 },
                    agility: { current: 4500, min: 4500, max: 6500 },
                    intelligence: { current: 2700, min: 2700, max: 4300 },
                    mutated: false
                }
            },
            guhe: {
                name: '古河锦鲤',
                image: 'https://pic.imgdb.cn/item/66542638d9c307b7e92c22fd.gif',
                skills: [
                    { name: '惊涛骇浪', rarity: 'B', description: '对十字范围造成物理伤害并有几率造成速度和物理攻击力下降' },
                    { name: '冥想', rarity: 'B', description: '被动技能， 每回合法力值恢复' },
                    { name: '如鱼得水', rarity: 'B', description: '被动技能，水中的锦鲤能力有所加强，物理攻击和法术攻击上升' },
                    { name: '天赐矫健', rarity: 'A', description: '被动技能，物理和法术闪避上升' },
                    { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加。增加的寿命值与生物种类，技能等级有关。' },
                    { name: '法力吸取·法术', rarity: 'B', description: '对目标造成法术伤害并吸取一定的法力值' },
                    { name: '全面进化', rarity: 'A', description: '被动技能，从神魔大战中存活下来的宠物们，极大的提高了自己的强壮、耐力和敏捷。' },
                    { name: '水魔爆', rarity: 'S', description: '对敌全体造成物理伤害' },
                    { name: '相濡以沫', rarity: 'S', description: '被动技能，传于危难之时，锦鲤会触发一次复活，消耗20%寿命！' },
                    { name: '智慧守护', rarity: 'A', description: '被动技能，法术攻击上升' },
                    { name: '借花献佛', rarity: 'SS', description: '被动技能，上善若水，水善利万物而不争。当锦鲤受到伤害时，会将自身的受到的伤害值转化为对我方队友的治疗，治疗范围为以双鲤中心的十字范围队友。转化伤害的比例随技能等级提升。' },
                    { name: '锦鲤庇佑', rarity: 'SS', description: '被动技能，传说锦鲤受莫大吉运庇佑，战斗中第一次受到致死伤害时不会死亡，血量降为1血，此效果仅触发一次。触发几率随技能等级提升。	' },
                    { name: '梦幻泡影', rarity: 'SS', description: '被动技能，锦鲤消耗30%寿命制造强大的梦境使十字目标进入三回合深层睡眠状态，深层睡眠中的目标受伤降低且只有受到足额伤害才会提前醒来。深度睡眠中的受伤减免和从深层睡眠中醒来所需伤害的额度随技能等级提升。' },
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 3600, min: 3600, max: 6500 },
                    strength: { current: 4500, min: 4500, max: 6500 },
                    faith: { current: 3600, min: 3600, max: 5400 },
                    agility: { current: 5400, min: 5400, max: 7600 },
                    intelligence: { current: 3600, min: 3600, max: 5400 },
                    mutated: false
                }
            },
            banlan: {
                name: '斑斓公主',
                image: 'https://pic.imgdb.cn/item/665425a9d9c307b7e92b8c0b.gif',
                skills: [
                    { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长，被动技能，寿命上限增加，增加的寿命值与生物种类，技能等级有关' },
                    { name: '冥想', rarity: 'B', description: ' 被动技能，每回合法力值恢复' },
                    { name: '三倍速冲击', rarity: 'B', description: '以三倍速度对目标发动攻击，以目标为中心的十字范围内所有其他目标都会被冲击的余波刮伤。被攻击到的目标有可能会陷入手足无措的状态中。' },
                    { name: '防护结界', rarity: 'B', description: '被动技能，此生物具有极高的法术防御力，可大大降低被法术造成的伤害。' },
                    { name: '神威之怒', rarity: 'A', description: '被动技能，此技能可使宠物获得大量的物理攻击力。' },
                    { name: '仙风道骨', rarity: 'A', description: '被动技能，耐力、敏捷、强壮大幅提升。' },
                    { name: '智慧守护', rarity: 'A', description: '被动技能，通过追随智慧与战斗的守护者,使此生物学会用法力值抵消一部分受到的伤害.可抵消的比例根据技能等级而定。' },
                    { name: '元素守护（复仇）', rarity: 'S', description: '被动技能，拥有此技能的生物,任何针对敌方的攻击都可能触发"元素复仇效果".元素复仇效果可使攻击者释放一种元素类法术技能。' },
                    { name: '土魔爆', rarity: 'S', description: '召唤土之灵对敌方全体目标造成巨大伤害，土之灵产生的伤害需以召唤者的物理攻击为基础。召唤土之灵需以自身寿命作为祭献。' },
                    { name: '虎视眈眈', rarity: 'SS', description: '被动技能，斑斓公主虎视眈眈盯着敌人，积蓄力量，如斑斓公主本回合没有使用主动技能，则回合结束时物攻和物理暴击率上升，此状态最大叠加两次，增加值和技能等级有关。' },
                    { name: '如虎添翼', rarity: 'SS', description: '被动技能，斑斓公主和主人出场时不会受到沉默、眩晕、混乱、睡眠的影响。免疫几率和技能等级有关。' },
                    { name: '生龙活虎', rarity: 'SS', description: '被动技能，每三回合有几率清除身上的部分异常状态，清除几率和技能等级有关。' },
                    { name: '虎阵龙威', rarity: 'SS', description: '对敌方全体造成巨量物理伤害并清除对手一定怒气值，清除量与技能等级和法攻有关。' },
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 2700, min: 2700, max: 4300 },
                    strength: { current: 7650, min: 7650, max: 10350 },
                    faith: { current: 2700, min: 2700, max: 4300 },
                    agility: { current: 5400, min: 5400, max: 7600 },
                    intelligence: { current: 2700, min: 2700, max: 4300 },
                    mutated: false
                }
            },
            juling: {
                name: '巨灵战姬',
                image: 'https://pic.imgdb.cn/item/665433e8d9c307b7e93ac7e1.gif',
                skills: [
                { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加。增加的寿命值与生物种类，技能等级有关' },
                { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                { name: '黄金战甲', rarity: 'B', description: '被动技能，身着坚不可摧的的黄金战甲。物理防御、法术防御及生命大幅度上升' },
                { name: '牛气冲天', rarity: 'B', description: '单体攻击有几率令目标晕眩' },
                { name: '魔灵诀心', rarity: 'A', description: '被动技能，物理攻击力和法术攻击力大幅提升' },
                { name: '高级强壮', rarity: 'A', description: '被动技能，耐力及生命值上限上升' },
                { name: '智慧守护', rarity: 'A', description: '被动技能，通过追随智慧与战斗的守护者，使此生物学会用法力值抵消一部分受到的伤害。可抵消的比例根据技能等级而定' },
                { name: '风魔爆', rarity: 'S', description: '对敌方全体造成法术伤害' },
                { name: '岳镇渊渟', rarity: 'S', description: '被动技能，巨灵战姬有无可比拟的防御力。减免战斗中前三回合所受物理伤害，减免比例随技能等级提高而提高' },
                { name: '元素力量（宽容）', rarity: 'S', description: '被动技能，减免受到群体攻击的伤害' },
                { name: '舍生取义', rarity: 'SS', description: '巨灵战姬献祭自身生命，斩杀敌方同等血量（具体数值会因目标类型不同，有所高低），对手无法躲避！可献祭的生命比例随技能等级提高而提高' },
                { name: '霸体援护', rarity: 'SS', description: '巨灵战姬擅长在战场上保护队友。仅消耗20%寿命，对我方十字单位目标释放特级援护，巨灵战姬在援护回合内为霸体状态，不受任何debuff影响，援护回合结束后霸体状态消失' },
                { name: '激浊扬清', rarity: 'SS', description: '巨灵战姬擅长清除队友的负伤状态。仅消耗10%寿命，为我方十字目标解除破甲、恐慌、加深状态，并添加一个持续恢复效果，解除几率随技能等级提高而提高' },
                { name: '热血图腾', rarity: 'SS', description: '被动技能，巨灵战姬在场时我方斗志昂扬，极大增加我方全体生命上限值，效果随技能等级提高而提高' }
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 9000, min: 9000, max: 12000 },
                    strength: { current: 2700, min: 2700, max: 4300 },
                    faith: { current: 5400, min: 5400, max: 7600 },
                    agility: { current: 2250, min: 2250, max: 3750 },
                    intelligence: { current: 1800, min: 1800, max: 3200 },
                    mutated: false
                }
            },
            aoshi: {
                name: '敖十七',
                image: 'https://pic.imgdb.cn/item/6655c106d9c307b7e9dad024.gif',
                skills: [
                    { name: '天生蛮力', rarity: 'B', description: '被动技能，物理攻击上升' },
                    { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                    { name: '战斗狂热', rarity: 'A', description: '被动技能，物理爆击、速度上升' },
                    { name: '仙风道骨', rarity: 'A', description: '被动技能，耐力、敏捷、强壮大幅提升' },
                    { name: '长寿', rarity: 'B', description: '被动技能，寿命上限上升' },
                    { name: '法力吸取（物理）', rarity: 'B', description: '单体物理攻击并吸取法力值' },
                    { name: '龙息乱', rarity: 'SS', description: '目标十字范围造成法术伤害并附加随机状态' },
                    { name: '全面进化（17悟）', rarity: 'S', description: '被动技能，耐力、敏捷、强壮上升' },
                    { name: '黄金战甲（18悟）', rarity: 'S', description: '被动技能，身着坚不可摧的的黄金战甲。物理防御、法术防御及生命大幅度上升' },
                    { name: '智慧守护（19悟）', rarity: 'S', description: '被动技能，通过追随智慧与战斗的守护者，使此生物学会用法力值抵消一部分受到的伤害。可抵消的比例根据技能等级而定。' },
                    { name: '龙族后裔（充沛）（20悟）', rarity: 'SS', description: '被动技能，云从龙，风从虎。龙族后裔特有操作风云的本领。大幅提高自己的速度。' },
                    { name: '万寿无疆', rarity: 'SS', description: '被动技能，寿命无穷无尽，接近永生。每回合回复寿命' },
                    { name: '闻风丧胆', rarity: 'SS', description: '必中技能，对敌方单体施加惶恐状态，处在惶恐状态的敌人将减少物理攻击和法术攻击。施法者物理攻击越高减少数值越大。技能速度2000' },
                    { name: '有恃无恐', rarity: 'SS', description: '以自身物理攻击为引对敌方全体造成大量物理伤害' },
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 2750, min: 2750, max: 4850 },
                    intelligence: { current: 2250, min: 2250, max: 3750 },
                    strength: { current: 4250, min: 4250, max: 8150 },
                    agility: { current: 5250, min: 5250, max: 10350 },
                    faith: { current: 2250, min: 2250, max: 3750 },
                    mutated: false
                }
            },
            daming: {
                name: '妲茗儿',
                image: 'https://pic.imgdb.cn/item/66542639d9c307b7e92c23a4.gif',
                skills: [
                    { name: '长寿', rarity: 'B', description: '被动技能，有此天赋的生物寿命得到额外增长。被动技能，寿命上限增加，增加的寿命值与生物种类，技能等级有关' },
                    { name: '冥想', rarity: 'B', description: '被动技能，每回合法力值恢复' },
                    { name: '元素力量（宽容）', rarity: 'SS', description: '被动技能，借助元素的力量，在受到群体攻击时，减免部分伤害。减免的额度与技能等级有关。' },
                    { name: '法力灼烧', rarity: 'A', description: '对敌方单一目标喷吐火焰，将目标法力蒸发，并同时造成伤害。产生的伤害需以使用者的法术攻击为基础。' },
                    { name: '智慧守护', rarity: 'A', description: '被动技能，通过追随智慧与战斗的守护者，使此生物学会用法力值抵消一部分受到的伤害。可抵消的比例根据技能等级而定。' },
                    { name: '仙风道骨', rarity: 'SS', description: '被动技能，耐力、敏捷、强壮大幅提升。' },
                    { name: '女神外壳', rarity: 'A', description: '被动技能，物理和法术防御上升。' },
                    { name: '斑斑之鸠', rarity: 'A', description: '被动技能，持有此技能者将自动拥有北京大学外交学院硕士研究生学历（学信网可查/非函授/全日制）。' },
                    { name: '美腿术', rarity: 'A', description: '被动技能，一双美腿是她引以为豪的本钱，学会此技能可为她增加速度。' },
                    { name: '妩媚身姿', rarity: 'A', description: '被动技能，身型婀娜。提高自身物理和法术闪避。' },
                    { name: '疗伤解毒', rarity: 'SS', description: '被动技能，妲茗儿和在天宫捣药的前辈学到了疗伤解毒技能，使自己免疫一切中毒、流血和灼烧效果。但是需以寿命做献祭，每回合消耗40点寿命。' },
                    { name: '上善若水', rarity: 'SS', description: '被动技能，会疗伤的妲茗儿爱主人胜过爱自己，妲茗儿的主人受到伤害后妲茗儿会主动治疗主人（不治疗中毒和流血、等负面效果造成的伤害）。妲茗儿法术攻击越高治疗效果越好。' },
                    { name: '步步生莲', rarity: 'SS', description: '妲茗儿曼妙的舞姿迷惑敌人后对敌方所有目标进行攻击，我方血量最低1个单位受到鼓舞恢复一定血量。' },
                    { name: '气急攻心', rarity: 'SS', description: '被动技能，妲茗儿天生是个急性子，每回合结束后消耗当前生命1%，恢复最大生命1%的血量，恢复生命需要以寿命作为献祭，每回合扣除100寿命（技能16级以后不消耗寿命）。' },
                    { name: '狡兔三窟', rarity: 'SS', description: '被动技能，妲茗儿每次战斗可以免疫2次致死伤害，触发狡兔三窟后会回复最大血量的5%，最大法力的5%，每次触发狡兔三窟以20%寿命做献祭。' },
                ],
                qualities: {
                    tier: '普通',
                    growthRate: 100,
                    endurance: { current: 5400, min: 5400, max: 7050 },
                    strength: { current: 3000, min: 3000, max: 3750 },
                    faith: { current: 3000, min: 3000, max: 3750 },
                    agility: { current: 6200, min: 6200, max: 8150 },
                    intelligence: { current: 6200, min: 6200, max: 8150 },
                    mutated: false
                }
            }
        };

const biographies = {
    yanzhi: [
        "1️⃣————我叫胭脂，是被仙境之主选中的使者，肩负着寻找仙境之子的重任。仙境即将迎来16周年庆典，作为仙境的一部分，我从小便沐浴在仙气之中，学习各种仙术。为了完成这项任务，我必须离开熟悉的仙境，踏入人间。第一次踏上这片陌生的土地，我感受到人间的繁华与喧嚣，与仙境的宁静截然不同。按照仙境之主的指引，我需要找到那个具有仙境血脉的孩子，他将成为下一任仙境之主。我穿越山川河流，走过一个个村庄，时刻保持警惕，感受着空气中微弱的仙气。每一个黄昏，我都会找一个安静的地方，盘膝而坐，感受着来自远方的呼唤，希望能尽早找到他。",
        "2️⃣————在一个宁静的小村庄，我感受到了一股强烈的仙气。这是我在凡间感受到最接近仙境的气息，我知道，我离目标已经很近了。村庄里的人们对我充满了好奇和善意，他们从未见过如此装束的人。我隐瞒了自己的身份，只说自己是个旅人。一天傍晚，我遇到了一位老人，他似乎知道我的来历和目的。他告诉我，村里有一个孩子，自小便与众不同，天生灵气逼人。这个孩子叫斑鸠，正是我苦苦寻找的仙境之子。我心中一阵狂喜，但也明白任务才刚刚开始。我要保护斑鸠，并教导他仙术，让他在16周年庆典上顺利接管仙人之位。",
        "3️⃣————时间一天天过去，我与斑鸠在村庄里度过了许多美好的时光。我教他如何运用仙术，告诉他关于仙境的一切。斑鸠聪慧异常，很快掌握了基础的仙术。然而，我们的行动并不总是一帆风顺。人间的阴险与险恶远超我的预料，我们曾遭遇过邪恶势力的袭击，也曾被怀疑和排斥。但每一次困难都让我和斑鸠更加坚定。终于，在仙境16周年庆典的前夕，斑鸠已经成长为一个强大的仙术师。我们踏上了返回仙境的道路，迎接那一刻的到来。在庆典之夜，斑鸠顺利接管了仙人之位，而我也完成了自己的使命。看着他站在仙境之主的位置上，我感到无比的骄傲和欣慰。我的任务结束了，但我的故事仍在继续，我会继续守护这片仙境，等待新的挑战和冒险。"
    ],
    zhulin: [
        "1️⃣————我叫蓝猫，是竹林中的隐士，以雷电之术闻名于世。很多人都说我性格豪爽，其实我只是不喜欢拐弯抹角，遇到事情总是直来直去。那一天，我正在竹林中修炼，忽然听到远处传来一阵喧闹声。循声望去，我看到一群山贼正在欺负一对父女。那女孩年纪轻轻，眼中却充满了无畏和愤怒，这让我心生敬意。豪爽之人岂能坐视不理？我飞身上前，手中雷电翻滚，只见雷光一闪，那群山贼已被击退。父女俩对我千恩万谢，我却只是挥了挥手，告诉他们：“走吧，这世道还是得靠自己保护自己。”",
        "2️⃣————有一天，我收到一封信，是我多年未见的好友传来的。信中说，他所在的村子遭受了一伙邪恶修士的侵袭，急需援助。我二话不说，带上我的雷电之术，奔赴好友的村庄。到了那里，我发现情况比想象的更糟糕，那些邪恶修士使用黑魔法，村民们苦不堪言。我与好友并肩作战，毫不畏惧地冲进敌阵。我的雷电之术在战斗中大放异彩，一道道闪电劈向敌人，邪恶修士们一个个被击退。最终，我们成功击败了这些邪恶势力，村庄恢复了平静。好友握着我的手，感激地说：“蓝猫，你真是我一生的兄弟。”我拍了拍他的肩膀，豪爽地笑道：“兄弟有难，岂能不帮？这就是忠义！”",
        "3️⃣————经历了无数次的战斗和冒险，我决定返回那片让我心安的竹林。竹林中宁静祥和，我喜欢在这里与自然为伴，修炼我的雷电之术。一天傍晚，我在竹林深处发现一个受伤的少年，他看起来很虚弱，但眼神中透着坚毅。我把他带回我的隐居之所，细心为他疗伤。少年醒来后告诉我，他叫小雷，正是因为仰慕我的雷电之术，才来竹林中寻找我。我见他心诚，决定收他为徒，传授他雷电之术。小雷的进步很快，他的豪爽性格也让我想起了年轻时的自己。我们师徒二人一起修炼，一起战斗，共同守护这片竹林。我的故事还在继续，而我的忠义和豪爽，也将在小雷身上传承下去。"
    ],
    zhanshen: [
        "1️⃣——我总是想得太多。你们看到的是我一刀劈开山河，一脚踏碎虚空，但你们看不到的是我的思索。什么是力量的本质？那是对生命的敬畏和对死亡的理解。我燃烧着，不只是因为战斗，而是因为心中的火焰。我站在这座古老的神殿前，思索着宇宙的起源和人类的终极命运。每次挥剑，我都在问自己：生命的意义是什么？或许在红莲业火的光芒中，我找到了答案，那就是在战斗中找到自我，在毁灭中追寻重生。每一个敌人，每一个挑战，都是我对世界发出的质问，而我的刀刃，就是答案。",
        "2️⃣——大家都说我是战神阿毛，凶猛无比，无人能敌。但你们知道我另一个身份吗？我是一个推拿师。我不只是在战斗中用武功征服对手，我还在平凡的日常中用推拿征服人心。我喜欢推拿，不是因为它能缓解疲劳，而是因为它让我感受到人类的脆弱和美丽。我看到那些筋骨僵硬的平民，我知道，他们和我一样，都在与生活搏斗。我用我的手法，让他们暂时忘却痛苦，找到片刻的宁静。这让我明白，力量不仅仅是摧毁和征服，还有抚慰和治愈。我，战神阿毛，不只是一个冷酷的战士，还是一个温柔的推拿师，用我的双手，为这个世界带来一丝丝温暖。",
        "3️⃣——有些人说我是命运的宠儿，有些人说我是厄运的化身。但你们知道吗，命运对我来说，不过是一个笑话。我是阿毛，一个在战斗中觉醒的战神，但我不相信命运。我相信的是选择。每一次挥剑，每一次战斗，都是我对命运的反抗。我走过无数的战场，见过无数的生死离别，但我从不屈服于命运的安排。我用红莲业火焚烧一切不公，用幽冥剧毒惩罚一切邪恶。我选择了这条路，就不会后悔。我站在这座古老的神殿前，看着那扇神秘的大门，心中有无限的思索。我知道，命运的轮回或许无法打破，但我可以选择如何面对它。我，战神阿毛，不是命运的傀儡，而是命运的挑战者。在无尽的轮回中，我将继续前行，用我的选择，谱写属于自己的传奇。"
    ],
    jinmin: [
        "1️⃣——结城夏奈是在一次工作中与金珉奎相遇的，那时她是《Fantasy!》杂志的主编，而他是炙手可热的K-pop明星。初次见面，两人并未擦出火花，但命运却将他们再次连接在一起。几个月后，夏奈在韩国的一次时尚发布会上再次遇见了金珉奎。这次，他不再是那个高高在上的明星，而是一个在后台默默帮助工作人员的普通人。两人因为共同的朋友被安排坐在一起，逐渐有了更多的交流。夏奈被金珉奎的谦逊和幽默所吸引，而金珉奎则被夏奈的智慧和独立所打动。发布会结束后，他们开始频繁联系，并在首尔的街头度过了许多美好时光。一次，夏奈在采访中遇到了难题，金珉奎不顾一切赶来帮她化解了困境。这让夏奈深深感受到他对她的在意和支持。两人在繁忙的工作之余，彼此成了最可靠的依靠，渐渐走进了对方的心里。",
        "2️⃣——夏奈和金珉奎的关系逐渐升温，但一场突如其来的意外打破了他们的平静生活。在一次拍摄现场，夏奈不慎被道具砸中头部，失去了部分记忆。她忘记了与金珉奎的点点滴滴，只记得一些模糊的片段。金珉奎心痛不已，但决定不放弃，他每天陪在夏奈身边，试图唤起她的记忆。夏奈对这个温柔体贴的男人感到熟悉，却又无法完全想起他们之间的过去。金珉奎带她去他们曾经约会的地方，重温那些美好时光。某天，夏奈在整理旧物时，发现了一本她亲手制作的相册，里面记录了她和金珉奎的点点滴滴。那些照片和文字让她的记忆慢慢复苏，渐渐想起了他们之间的点点滴滴。看着金珉奎的笑脸，她的心里涌起一股暖流。虽然记忆尚未完全恢复，但她已经感受到他们之间深厚的感情。两人决定重新开始，无论未来有多少挑战，他们都将一起面对。",
        "3️⃣——爱情在不断升温，但他们也面临着现实的考验。夏奈的工作需要她频繁往返于日本和韩国，而金珉奎的演艺事业则让他常年奔波在外。两人的见面机会越来越少，但他们并没有因此放弃这段感情。每次分别时，他们都会约定下次见面的时间和地点，尽可能地保持联系。某次，夏奈在东京采访时，继父突然出现，试图再次控制她的生活。金珉奎得知消息后，立刻飞往东京，帮助夏奈应对继父的威胁。他们一起面对了继父的阴谋，最终成功让他受到法律的制裁。这场危机让两人更加坚定了彼此的信任和依赖。夏奈决定辞去高强度的工作，转而从事更灵活的自由职业，以便能有更多时间陪伴金珉奎。金珉奎也调整了自己的工作计划，尽量减少不必要的出差。他们一起在韩国买了一套温馨的小公寓，开始了新的生活。虽然两人依然忙碌，但他们的心却紧紧连在一起。每次见面都像是一场久别重逢的约会，他们用心经营着这段跨越距离的爱情。"
    ],
    tengshe: [
        "1️⃣——在古老的神话中，腾蛇是一种传说中的神兽，拥有星宿之力，被誉为守护神兽之一。它的外形如同巨蛇，身披火焰与毒雾，红莲业火与幽冥剧毒是它的两大绝技。腾蛇原本栖息在幽深的山谷中，远离尘世，但一场突如其来的变故改变了它的命运。某日，腾蛇感应到王朝边疆的动荡与战火，百姓生活在水深火热之中，苦不堪言。腾蛇决定不再隐居，决定用自己的力量推翻腐朽的王朝，解救苍生。腾蛇飞身而起，穿越山川湖泊，来到了王朝的都城。它的出现如同一场风暴，红莲业火焚烧着敌人的军营，幽冥剧毒让敌人闻风丧胆。腾蛇在战场上无往不利，所到之处，敌军溃不成军，百姓们看到了希望。",
        "2️⃣——腾蛇不仅是一位战士，更是一位救世主。它推翻了腐朽的王朝之后，并没有追求权力和财富，而是开始帮助百姓重建家园。腾蛇利用自己的神力，灌溉田地，清除瘟疫，使得百姓们能够安居乐业。它的红莲业火不再只是用来焚烧敌人，而是用来温暖寒冷的冬夜；幽冥剧毒也不再只是用来杀敌，而是用来制药救人。一天，一场前所未有的瘟疫袭击了整个王国，百姓们再一次陷入了恐慌之中。腾蛇不辞辛劳，昼夜不休地研制解药。它用自己的毒液作为药引，最终成功地研制出了解药，挽救了无数人的生命。百姓们感激涕零，将腾蛇视为神明般崇拜，并在都城为它建造了庙宇，以示敬仰。",
        "3️⃣——尽管腾蛇拯救了无数人，但它始终保持着低调，从不炫耀自己的功绩。在确定百姓们的生活恢复安定之后，腾蛇决定归隐山林。它飞回了自己曾经栖息的山谷，继续过着隐居的生活。然而，它的传奇故事在百姓中口口相传，成为了不朽的神话。每年春天，百姓们都会来到腾蛇的庙宇，举行盛大的祭祀仪式，纪念这位伟大的神兽。他们相信，腾蛇的精神永远守护着他们，使得王国永远繁荣昌盛。腾蛇的故事激励着一代又一代的人，告诉他们只要心怀正义，勇敢无畏，就能够战胜一切困难，创造奇迹。腾蛇虽然归隐，但它的名字将永远铭刻在历史的长河中，成为人们心中不灭的传奇。"
    ],
    qingmou: [
        "1️⃣————我是虎子，江湖人称青眸白虎。自幼便与电火为伴，练就了烈光之术。我的技艺无人能及，行动如风，变幻莫测。这一天，我隐居在山中的修行被一阵喧嚣打断。我跃上树梢，看到山脚下一个村庄正遭受袭击。那些山贼猖獗无比，村民们无力反抗。我冷哼一声，雷电之力在掌中凝聚，一声怒吼，电火如龙般冲向山贼，瞬间将他们烧得落荒而逃。村民们看向我的目光充满敬畏，而我只是轻轻一跃，消失在茫茫竹林中。",
        "2️⃣————江湖传言青眸白虎无影无踪，行踪飘忽。这次，我接受了一项极为隐秘的任务——潜入敌国，摧毁他们正在开发的秘密武器。夜色如墨，我化身黑影，悄然潜入敌国要塞。要塞守卫森严，但我如鬼魅般穿梭其间，烈光之术使我的身形更加迅捷。终于，我找到了那座秘密工厂，内部机关重重。我手中雷电之力暴涨，将所有阻拦我的敌人化为灰烬。火光映照下，我看到那武器已被摧毁，而我也在夜色掩护下，迅速离开，留下一片狼藉的战场。",
        "3️⃣————我一直以为自己是孤独的战士，直到那天遇到了一个叫小虎的少年。他在一次战斗中目睹了我的烈光之术，便执意要拜我为师。我见他天资聪颖，便决定传授他我的技艺。我们在深山中隐居，白日里他勤学苦练，夜晚则跟随我行走江湖。一次，我们遇到了一伙邪教徒，他们妄图统治江湖。我和小虎并肩作战，烈光之术在黑夜中闪耀，我们的合作天衣无缝。最终，邪教徒被我们彻底击败。看着小虎从一个稚嫩的少年成长为独当一面的侠客，我感到无比自豪。烈光之术在他手中愈发强大，而我，也终于找到了一生的传承。"
    ],
    jingjue: [
        "1️⃣————我的故事始于战火纷飞的年代，那时的我，胸怀大志，立誓要结束乱世，重建和平。我从小就展现出非凡的武艺，力拔山兮气盖世。很快，我便在众多将士中崭露头角，成为了众人敬仰的英雄。随着战争的不断推进，我的声名远播，所向披靡，敌人闻风丧胆。然而，越是接近胜利，我心中那份不安却越发强烈。江山虽近，但我却总感觉命运在我身后静静注视，等待着最后的审判。",
        "2️⃣————战争如火如荼，最终迎来了决定性的一战。我率领军队与敌军决战于乌江，敌我双方都已筋疲力尽，胜负只在一线之间。就在此时，传来了爱姬虞姬被困的消息。我心如刀割，但战场上无暇顾及，唯有将胜负寄托于一场豪赌。激战正酣，敌军援兵赶到，我军节节败退。我挥舞着巨大的战刀，试图挽回败局，但终究力不从心。爱姬虞姬见状，毅然决然地以剑自刎，她的鲜血洒满战场，仿佛在诉说我们未尽的情缘。那一刻，我的心彻底碎了，英雄的梦也随之破灭。",
        "3️⃣————大势已去，军队溃散，乌江的流水似在为我哀鸣。身边仅剩数十骑忠勇之士，我却明白已无力回天。面对无尽的敌军，我毅然决定结束这场悲剧。拔出佩剑，我站在乌江边，望着那滚滚江水，回忆起往昔的荣光与爱姬的笑颜。战士们劝我渡江逃生，但我岂能苟且偷生，留下千古骂名？“力拔山兮气盖世，时不利兮骓不逝。骓不逝兮可奈何？虞兮虞兮奈若何！”一声长叹，我纵身跃入江中，结束了自己悲壮的一生。江水吞噬了我的身体，却无法淹没我的传说。净角神将，虽败犹荣，化作江上一抹不灭的英雄魂魄。"
    ],
    shanggu: [
        "1️⃣————曾经，亿万年前大地神树的一根枝蔓，满载着神力降临人间，我便是那上古的神藤。那时的大地，还是一片原始的净土，生机盎然。作为大地神树的一部分，我见证了万物的诞生与成长，感受着生命的脉动和自然的和谐。我们的神树根系深深扎入大地，与大地融为一体，吸收着宇宙的精华。每当晨曦初现，我会感受到第一缕阳光的温暖；每当夜幕降临，我会聆听星辰的低语。我的存在，承载着大地的祝福与希望。然而，随着时间的流逝，我也开始目睹生灵的苦难和悲欢离合，这让我心生悲悯，决心用我的神力庇护众生。",
        "2️⃣————时光荏苒，宇宙间沧海桑田，大地不断变迁。曾经的净土变得繁华，而繁华之后又归于寂静。无数次的轮回，我依然屹立不倒，静静守护着这片大地。某一天，人类文明兴起，他们建造了高楼大厦，开垦了田野，但也带来了战争和破坏。我亲眼目睹了无数生灵的离散与凋零，内心无比痛苦。我用神力修复着大地的创伤，用藤蔓庇护着无助的生命。我曾将一个受伤的孩子紧紧拥入怀中，用我的藤蔓疗愈他的伤痛。孩子露出了纯真的笑容，那一刻，我感受到自己存在的意义。然而，这种短暂的宁静很快被新的战争打破，悲剧一次次上演，我的悲悯之心也愈发深沉。",
        "3️⃣————亿万年的岁月过去，我的藤蔓早已成为大地的一部分，与这片土地密不可分。我见证了文明的兴衰，感受着自然的无常，但我的心依然充满了对生命的热爱和对和平的渴望。即使在最黑暗的时刻，我也未曾放弃希望。每当春天来临，我的枝蔓会绽放出美丽的花朵，为大地带来生机。无数次的轮回中，我学会了与时间共舞，学会了在悲痛中寻找美好。我知道，自己的使命永远不会结束，因为只要这片大地还在，只要还有生灵需要庇护，我就会一直守护下去。即使宇宙再度轮回，我的悲悯之心也将永远不变，成为大地上最温柔、最坚定的守护者。"
    ],
    guhe: [
        "1️⃣————我是古河锦鲤，三途川的引导者，负责带领不安的亡魂找到安息之地。每天，我在这幽深的河流中游弋，用催眠的力量平息亡魂的痛苦。见证了无数次的生死离别，我的心渐渐麻木，仿佛一切都变得无关紧要。亡魂们的哭泣与哀号，在我的耳中如同风过耳畔，来去无痕。我只机械地履行着我的职责，仿佛一具没有情感的傀儡。曾几何时，我也是如此充满激情，但如今的我，只剩下冰冷的职责。",
        "2️⃣————某天，我遇到了一个特别的亡魂，她是一个年轻的女子，生前为了救她的孩子而不幸身亡。她的魂魄充满了不舍和牵挂。我的催眠术竟然对她无效，她的真情打破了我的防线。女子恳求我，让她再见孩子一面，我被她的真情所感动，破例帮助她完成了这个心愿。她与孩子的重逢充满了泪水与温情，这一幕深深触动了我的心。渐渐地，我感觉到心中那份久违的温暖与柔情。",
        "3️⃣————自从那次帮助亡魂重逢后，我开始重新审视自己的职责。虽然我依旧是三途川的引导者，但每一次的引导，我都会用心去聆听亡魂们的故事。人间的真情再次唤醒了我的感受，让我不再只是冷漠的引导者。我明白，正是这些真挚的情感，才使得生死轮回不再那么冰冷。我决定，用我的力量不仅仅是引导，更要安抚这些亡魂，让他们在离开人间前，感受到最后一丝温暖与关怀。我的使命不再只是引导，而是带来希望与安慰。"
    ],
    banlan: [
        "1️⃣————斑斓公主，人们亲切地称她为虎妞，是苏州村民抚养长大的神虎化身。她天生具有破军神力，但因不懂得控制，经常好心办坏事。一次洪水突袭村庄，虎妞想用力量筑坝，但用力过猛，反而加剧了灾难。村民们虽没有责怪她，但她心中满是愧疚。这次经历让她明白，光有力量是不够的，还需要智慧和技巧。于是，她开始学习如何更好地控制自己的神力，立志为村民们做真正有益的事情。",
        "2️⃣————在村中一位智者的指导下，虎妞开始了她的学习之旅。智者教导她如何精确控制力量，如何在关键时刻保持冷静。一天，村庄受到一群强盗的袭击，村民们惶恐不安。虎妞不再像以前那样只靠蛮力冲锋，而是冷静地分析敌情，利用学到的技巧巧妙制服了强盗。村民们见她如此英勇又智慧，纷纷为她喝彩。这次胜利让虎妞意识到，真正的英雄不仅需要强大的力量，还需要冷静的头脑和对力量的掌控。",
        "3️⃣————村外山中出现了一只巨大的恶兽，威胁着村民们的安全。虎妞决心前往应战。经过长时间的修炼和实践，她已经能够自如地控制破军神力。面对恶兽，她设下巧妙的陷阱，将恶兽引入陷阱之中，然后用精准的力量将其制服。村民们为她欢呼，称赞她不仅有强大的力量，还有保护他们的智慧和勇气。从那天起，虎妞不再是那个好心办坏事的斑斓公主，而是村民们心目中真正的守护者，真正的英雄。她用自己的行动，赢得了所有人的信任和尊敬。"
    ],
    juling: [
        "1️⃣————巨灵战姬，自幼便展现出非凡的战斗天赋。但她内心深处总有一种孤独感，仿佛缺失了什么。一天，她在古老的森林中迷失，偶然遇到了一位沉睡的巨灵神。巨灵神从沉睡中苏醒，目光中充满了温柔与力量。巨灵战姬感受到一股前所未有的亲切感，仿佛找到了命中注定的伙伴。巨灵神低声说道：“你就是我等待的战士，我们的命运已然交织。”就这样，巨灵战姬与巨灵神缔结了生命之契，从此她不再孤单，拥有了无尽的勇气与力量。",
        "2️⃣————缔结契约后，巨灵战姬与巨灵神开始了他们的冒险旅程。某日，邪恶势力袭击了一个小村庄，巨灵战姬毫不犹豫地站了出来，迎战强敌。巨灵神在她身后漂浮，为她提供无尽的力量和护盾。面对妖邪的攻击，她毫不退缩，勇敢地保护着村民们。巨灵神的力量与她完美结合，形成一道坚不可摧的屏障。最终，邪恶势力被击败，村民们得救了。巨灵战姬深知，这是她与巨灵神的默契与信任，让她能够无畏地面对一切挑战。",
        "3️⃣————随着时间的推移，巨灵战姬和巨灵神的默契愈发深厚。一次，她们面对一个强大的古老恶灵，恶灵的力量足以摧毁一切。巨灵战姬深知此战凶险，但她坚定地站在最前线。巨灵神在她身后闪耀着光芒，给予她无尽的勇气。两人联手，经过一场惊心动魄的激战，终于将恶灵封印。战斗结束后，巨灵战姬看着巨灵神，感受到契约的力量愈加深厚。她明白，无论未来多么险恶，她们的契约将永远不朽，巨灵神将一直陪伴在她身边，守护她，也守护着她所爱的一切。"
    ],
    aoshi: [
        "1️⃣————敖十七是龙王的第十七个孩子，虽年纪尚小，但心中充满了对外界的好奇。一天，他决定离开龙宫，开始他的第一次冒险。敖十七飞越山川湖海，来到了一片美丽的森林。在那里，他遇到了一群被困的精灵，受到恶龙的威胁。敖十七毫不犹豫地出手相助，他用龙息驱散了恶龙，救出了精灵。精灵们感激不尽，为他献上了魔法之花。这次冒险让敖十七明白了勇气与善良的意义，也让他在精灵们的心中留下了深刻的印象。",
        "2️⃣————在一次旅行中，敖十七来到了一个古老的城镇。镇上的人们正在为解决一道古老的谜题而烦恼，这道谜题已经困扰了他们几代人。敖十七听闻后，决定一试。他静心观察，运用自己在龙宫学到的智慧，最终成功解开了谜题。镇民们无比惊喜，为他举行了盛大的庆典。敖十七不仅得到了丰厚的奖励，更赢得了人们的敬佩。这次经历让他明白，智慧同样是一种强大的力量。",
        "3️⃣————在一片浩瀚的沙漠，敖十七听闻有一座被诅咒的城市。许多勇者前去探险，却无一生还。敖十七决定前去一探究竟。经过长途跋涉，他终于找到这座城市，并发现了隐藏在其中的黑暗力量。敖十七用龙鳞反射出耀眼的光芒，驱散了黑暗，解除了诅咒。被拯救的城市恢复了生机，居民们为他树立了纪念碑，称他为“勇者之龙”。敖十七的名声传遍了四方，他的勇气与智慧也在每一段旅程中不断增长。通过这些经历，他渐渐成长为一位真正的龙族英雄。"
    ],
    daming: [
        "1️⃣————妲茗儿因在天宫捣药出错，被嫦娥仙子罚下凡间修行。她精通医术，尤其擅长解毒疗伤。一天，她在林中采药时遇到了受伤的侠客皇甫云。妲茗儿悉心照料，利用自己的医术为他解毒疗伤。皇甫云感激不已，两人因此结下深厚友谊。妲茗儿仰慕侠之大者，决定跟随皇甫云，贴心辅佐他行侠仗义。两人行走江湖，妲茗儿不仅治愈了许多受伤的百姓，还在关键时刻帮助皇甫云化险为夷。她逐渐成为皇甫云不可或缺的伙伴。",
        "2️⃣————皇甫云接到朝廷委托，要摧毁一个盘踞在深山中的凶兽群。妲茗儿与他一同前往。途中，他们遭遇了凶兽头领设下的埋伏，皇甫云身中剧毒，命悬一线。妲茗儿毫不犹豫地用自己体内的仙灵之气为他解毒，但这种解毒方法会让她自身的修为大减，甚至有生命危险。她毅然决然地为皇甫云疗伤，最终皇甫云苏醒过来，而妲茗儿却因耗尽仙灵之气陷入昏迷。皇甫云看着昏迷不醒的妲茗儿，心中感激涌动，发誓要保护她一生一世。",
        "3️⃣————妲茗儿的善行最终传到了嫦娥仙子的耳中，嫦娥被她的诚心所感动，决定原谅她，召她回天宫。然而，妲茗儿却已心有所属。她对嫦娥仙子表达了自己对皇甫云的敬仰与爱慕，决心留在凡间，继续与皇甫云并肩行侠仗义。嫦娥仙子理解她的选择，祝福她在人间找到真正的幸福。妲茗儿与皇甫云继续他们的江湖之旅，救助弱小，惩恶扬善，成为了江湖中人人敬仰的一对侠侣。妲茗儿用自己的行动证明了，即使身处凡间，也能实现心中的梦想与使命。"
    ]
};

// 模拟加载进度
function simulateLoading() {
    let progress = 0;
    const interval = setInterval(() => {
        progress += 15;
        if (progress <= 100) {
            document.getElementById('loadingText').innerText = `加载中... ${progress}%`;
            document.getElementById('progressBar').style.width = `${progress}%`;
        } else {
            clearInterval(interval);
            document.getElementById('loadingOverlay').style.display = 'none';
        }
    }, 100);
}

// 页面加载完成后隐藏进度条和遮罩层
window.addEventListener('load', () => {
    simulateLoading();
});
        
if (window.GestureEvent || (navigator.maxTouchPoints > 0)) {
    let lastTouchEnd = 0;

    document.body.addEventListener('touchend', function (e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 200) { // 调整这里的时间间隔
            e.preventDefault(); // 阻止双击放大
        }
        lastTouchEnd = now;
    }, { passive: false });

    document.body.addEventListener('dblclick', function (e) {
        e.preventDefault(); // 阻止双击事件
    }, { passive: false });
}

function isInteractiveElement(e) {
    let { nodeName } = e;

    if (nodeName === 'A' && e.hasAttribute('href') ||
        ['BUTTON', 'INPUT', 'SELECT', 'TEXTAREA'].includes(nodeName) && !e.disabled ||
        nodeName === 'LABEL' && (e.htmlFor || e.querySelector('input,select,textarea') !== null) ||
        ['IMG', 'OBJECT'].includes(nodeName) && e.useMap ||
        ['AUDIO', 'VIDEO'].includes(nodeName) && e.controls ||
        ['SUMMARY', 'IFRAME', 'EMBED'].includes(nodeName)) {
        return true;
    }

    return e.hasAttribute('tabindex') && e.tabIndex > -1;
}

function preloadImages(imageUrls) {
    const imageCache = [];
    imageUrls.forEach(url => {
        const img = new Image();
        img.src = url;
        imageCache.push(img);
    });
}

// 调用函数预加载图片
const imageUrls = [
    "https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png",
    "https://pic.imgdb.cn/item/66541c01d9c307b7e9208aea.png",
    "https://pic.imgdb.cn/item/66542639d9c307b7e92c235d.gif",
    "https://pic.imgdb.cn/item/6669a02bd9c307b7e935f2a2.jpg",
    "https://pic.imgdb.cn/item/66616fe95e6d1bfa05b0103d.png",
    "https://pic.imgdb.cn/item/66616fea5e6d1bfa05b0117c.png",
    "https://pic.imgdb.cn/item/66616fea5e6d1bfa05b0121c.png",
    "https://pic.imgdb.cn/item/66616feb5e6d1bfa05b01297.png",
    "https://pic.imgdb.cn/item/66616feb5e6d1bfa05b01297.png",
    "https://pic.imgdb.cn/item/66616feb5e6d1bfa05b01312.png",
    "https://pic.imgdb.cn/item/66616fec5e6d1bfa05b013ec.png",
    "https://pic.imgdb.cn/item/666466225e6d1bfa05b95973.png",
    "https://pic.imgdb.cn/item/66541c01d9c307b7e9208add.png",
    "https://pic.imgdb.cn/item/6654a944d9c307b7e9ca6423.png",
    "https://pic.imgdb.cn/item/6655a92ad9c307b7e9c04265.png",
    "https://pic.imgdb.cn/item/665ef0855e6d1bfa055800f4.png",
    "https://pic.imgdb.cn/item/6654a944d9c307b7e9ca63f5.png",
    "https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png",
    "https://pic.imgdb.cn/item/6656e598d9c307b7e906ca29.png",
    "https://pic.imgdb.cn/item/6656e734d9c307b7e9088e9b.png",
    "https://pic.imgdb.cn/item/6656e734d9c307b7e9088e7b.png",
    "https://pic.imgdb.cn/item/6656e734d9c307b7e9088e6d.png",
    "https://pic.imgdb.cn/item/665ef0845e6d1bfa055800c7.png",
    "https://pic.imgdb.cn/item/6656e81dd9c307b7e9098478.png",
    "https://pic.imgdb.cn/item/6656e821d9c307b7e90988b2.png",
    "https://pic.imgdb.cn/item/6656e81dd9c307b7e909844a.png",
    "https://pic.imgdb.cn/item/6656e81dd9c307b7e90984b7.png",
    "https://pic.imgdb.cn/item/6656e81dd9c307b7e909843e.png",
    "https://pic.imgdb.cn/item/665ef0855e6d1bfa055800f4.png",
    "https://pic.imgdb.cn/item/6656a1b6d9c307b7e9baa881.png",
    "https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png",
    "https://pic.imgdb.cn/item/6656a1b6d9c307b7e9baa85b.png",
    "https://pic.imgdb.cn/item/665af22fd9c307b7e910c815.png",
    "https://pic.imgdb.cn/item/665566e5d9c307b7e971236e.png",
    "https://pic.imgdb.cn/item/6661a2715e6d1bfa05edb3a2.png",
    "https://pic.imgdb.cn/item/6661a26a5e6d1bfa05edacf1.png",
    "https://pic.imgdb.cn/item/665de3fd5e6d1bfa05564912.png",
    "https://pic.imgdb.cn/item/665c7652d9c307b7e991a20d.png"
];
preloadImages(imageUrls);

// 战斗精灵属性
let spiritLevel = 1;
let spiritMultiplier = 1.00;
const maxSpiritLevel = 110;
const minSpiritMultiplier = 0.01;
const maxSpiritMultiplier = 4.15;

// 获取精灵提供的基础属性增益
function getBaseSpiritAttributes() {
    return {
        health: 38,
        mana: 19,
        physicalAttack: 11,
        physicalDefense: 18,
        magicAttack: 11,
        magicDefense: 18,
        speed: 2
    };
}

// 计算精灵当前等级和倍数提供的属性增益
function getCurrentSpiritAttributes() {
    const baseAttributes = getBaseSpiritAttributes();
    return {
        health: Math.floor(baseAttributes.health * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        mana: Math.floor(baseAttributes.mana * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        physicalAttack: Math.floor(baseAttributes.physicalAttack * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        physicalDefense: Math.floor(baseAttributes.physicalDefense * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        magicAttack: Math.floor(baseAttributes.magicAttack * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        magicDefense: Math.floor(baseAttributes.magicDefense * Math.pow(1.1, spiritLevel) * spiritMultiplier),
        speed: Math.floor(baseAttributes.speed * Math.pow(1.1, spiritLevel) * spiritMultiplier)
    };
}

// 更新精灵属性显示
function updateSpiritDisplay() {
    const spiritAttributes = getCurrentSpiritAttributes();
    document.getElementById('spirit-level').innerText = spiritLevel;
    document.getElementById('spirit-multiplier').innerText = spiritMultiplier.toFixed(2);
    document.getElementById('spirit-health').innerText = spiritAttributes.health;
    document.getElementById('spirit-mana').innerText = spiritAttributes.mana;
    document.getElementById('spirit-physical-attack').innerText = spiritAttributes.physicalAttack;
    document.getElementById('spirit-physical-defense').innerText = spiritAttributes.physicalDefense;
    document.getElementById('spirit-magic-attack').innerText = spiritAttributes.magicAttack;
    document.getElementById('spirit-magic-defense').innerText = spiritAttributes.magicDefense;
    document.getElementById('spirit-speed').innerText = spiritAttributes.speed;
}

// 显示战斗精灵按钮
function checkAwakening() {
    if (awakened) {
        document.getElementById('battle-spirit-button').style.display = 'block';
    } else {
        document.getElementById('battle-spirit-button').style.display = 'block';
    }
}

// 打开战斗精灵界面
document.getElementById('battle-spirit-button').addEventListener('click', () => {
    if (!awakened) {
        alert('宠物会得到战斗精灵的赐福，提升各项能力值。但宠物只有在觉醒后才能真正掌握战斗精灵的使用和培养！');
    } else {
        document.getElementById('battle-spirit-modal').style.display = 'block';
        updateSpiritDisplay(); // 打开时更新显示
    }
});

// 关闭战斗精灵界面
document.getElementById('close-spirit-modal').addEventListener('click', () => {
    document.getElementById('battle-spirit-modal').style.display = 'none';
});

// 精灵洗练
document.getElementById('level-up-spirit').addEventListener('click', () => {
    if (spiritLevel >= maxSpiritLevel) {
        alert('战斗精灵已达到最大等级！');
        return;
    }

    if (useItem('spiritRefreshStone')) {
        const successChance = Math.random();
        if (successChance < 0.8) { // 80% 成功率
            spiritLevel += 1;
            updateSpiritDisplay(); // 更新显示
            refreshBattleAttributes(); // 刷新战斗属性
        } else {
            alert('战斗精灵洗练失败！');
        }
    } else {
        alert('您的精灵精炼石不足！');
    }
});

// 精灵觉醒
document.getElementById('enhance-spirit').addEventListener('click', () => {
    if (useItem('spiritAwakenStone')) {
        const newMultiplier = (Math.random() * (maxSpiritMultiplier - minSpiritMultiplier) + minSpiritMultiplier).toFixed(2);
        spiritMultiplier = parseFloat(newMultiplier);
        updateSpiritDisplay(); // 更新显示
        refreshBattleAttributes(); // 刷新战斗属性
    } else {
        alert('您的精灵觉醒石不足！');
    }
});


// 使用道具
function useItem(itemName) {
    const itemIndex = jinnangItems.findIndex(item => item.name === itemName);
    if (itemIndex !== -1 && jinnangItems[itemIndex].quantity > 0) {
        jinnangItems[itemIndex].quantity -= 1;
        if (jinnangItems[itemIndex].quantity < 0) {
            jinnangItems[itemIndex].quantity = 0;
        }
        updateJinnangItems();
        return true;
    }
    return false;
}

// 初始化检查觉醒状态
window.onload = function() {
    initializeEnemyPet(); // 初始化敌人宠物
    updatePetInfo(); // 更新宠物和敌人宠物的属性
    document.getElementById("fightingDrawer").style.display = "none"; // 默认隐藏战斗抽屉
    checkAwakening(); // 检查宠物觉醒状态
    updateExpBar(); // 更新经验条
}
        
let attributesFetched = false;
let battleState;
let enemyPet;
let playerTurn;
let battleInterval;
let battleAttributes; // 用于存储战斗属性的独立容器
let maxHealth, maxMana; // 独立的最大值变量
let enemyMaxHealth, enemyMaxMana; // 敌人的最大值变量
let battleRounds = 0; // 记录玩家胜利的轮次
let currentExp = 0; // 当前经验值
let maxExp = 208; // 经验值上限
let enemyHealCount = 0; // 记录怪物治疗次数
let enemyInitialState; // 存储每轮开始时的敌人初始状态

function showEffect(effectId) {
    const effect = document.getElementById(effectId);
    effect.classList.add('show-effect');
    setTimeout(() => {
        effect.classList.remove('show-effect');
    }, 500);
}

function initializeEnemyPet() {
    enemyPet = {
        health: 678,
        mana: 336,
        physicalAttack: 65,
        physicalDefense: 118,
        magicAttack: 35,
        magicDefense: 118,
        speed: 121,
        silenced: false,
        stunned: false
    };

    if (battleState) {
        battleState.enemy = { ...enemyPet };
    }

    enemyMaxHealth = enemyPet.health;
    enemyMaxMana = enemyPet.mana;

    storeEnemyInitialState(); // 存储初始状态
}

function toggleFightingDrawer() {
    if (!attributesFetched) {
        alert("请先从属性面板获取属性。");
        return;
    }

    const drawer = document.getElementById('fightingDrawer');
    const isOpen = drawer.classList.toggle('open');

    if (isOpen) {
        drawer.style.display = "flex";
        refreshBattleAttributes(); // 刷新战斗属性
        startBattle();
    } else {
        drawer.style.display = "none";
        stopBattle();
    }
}

function updatePetInfo() {
    if (!currentPet) {
        console.error("currentPet is not initialized");
        return;
    }

    const currentAttributes = calculateCurrentAttributes();
    const totalAttributes = {
        endurance: currentAttributes.endurance,
        intelligence: currentAttributes.intelligence,
        strength: currentAttributes.strength,
        agility: currentAttributes.agility,
        faith: currentAttributes.faith
    };

    const secondaryAttributes = calculateSecondaryAttributes(totalAttributes, currentWisdom);
    const spiritAttributes = getCurrentSpiritAttributes();

    if (!battleState) {
        battleState = {
            player: {
                health: secondaryAttributes.health + spiritAttributes.health,
                mana: secondaryAttributes.mana + spiritAttributes.mana,
                physicalAttack: secondaryAttributes.physicalAttack + spiritAttributes.physicalAttack,
                physicalDefense: secondaryAttributes.physicalDefense + spiritAttributes.physicalDefense,
                magicAttack: secondaryAttributes.magicAttack + spiritAttributes.magicAttack,
                magicDefense: secondaryAttributes.magicDefense + spiritAttributes.magicDefense,
                speed: secondaryAttributes.speed + spiritAttributes.speed,
                intelligence: totalAttributes.intelligence
            },
            enemy: { ...enemyPet }
        };
    } else {
        battleState.player.health = secondaryAttributes.health + spiritAttributes.health;
        battleState.player.mana = secondaryAttributes.mana + spiritAttributes.mana;
        battleState.player.physicalAttack = secondaryAttributes.physicalAttack + spiritAttributes.physicalAttack;
        battleState.player.physicalDefense = secondaryAttributes.physicalDefense + spiritAttributes.physicalDefense;
        battleState.player.magicAttack = secondaryAttributes.magicAttack + spiritAttributes.magicAttack;
        battleState.player.magicDefense = secondaryAttributes.magicDefense + spiritAttributes.magicDefense;
        battleState.player.speed = secondaryAttributes.speed + spiritAttributes.speed;
        battleState.player.intelligence = totalAttributes.intelligence;
    }

    battleAttributes = {
        health: secondaryAttributes.health + spiritAttributes.health,
        mana: secondaryAttributes.mana + spiritAttributes.mana,
        physicalAttack: secondaryAttributes.physicalAttack + spiritAttributes.physicalAttack,
        physicalDefense: secondaryAttributes.physicalDefense + spiritAttributes.physicalDefense,
        magicAttack: secondaryAttributes.magicAttack + spiritAttributes.magicAttack,
        magicDefense: secondaryAttributes.magicDefense + spiritAttributes.magicDefense,
        speed: secondaryAttributes.speed + spiritAttributes.speed
    }; // 设置战斗属性

    maxHealth = battleAttributes.health; // 设置独立的最大值变量
    maxMana = battleAttributes.mana; // 设置独立的最大值变量
    enemyMaxHealth = enemyPet.health;
    enemyMaxMana = enemyPet.mana;

    updateUI();
    attributesFetched = true;
}

function refreshBattleAttributes() {
    if (!currentPet) {
        console.error("currentPet is not initialized");
        return;
    }

    const currentAttributes = calculateCurrentAttributes();
    const totalAttributes = {
        endurance: currentAttributes.endurance,
        intelligence: currentAttributes.intelligence,
        strength: currentAttributes.strength,
        agility: currentAttributes.agility,
        faith: currentAttributes.faith
    };

    const secondaryAttributes = calculateSecondaryAttributes(totalAttributes, currentWisdom);
    const spiritAttributes = getCurrentSpiritAttributes();

    battleAttributes = {
        health: secondaryAttributes.health + spiritAttributes.health,
        mana: secondaryAttributes.mana + spiritAttributes.mana,
        physicalAttack: secondaryAttributes.physicalAttack + spiritAttributes.physicalAttack,
        physicalDefense: secondaryAttributes.physicalDefense + spiritAttributes.physicalDefense,
        magicAttack: secondaryAttributes.magicAttack + spiritAttributes.magicAttack,
        magicDefense: secondaryAttributes.magicDefense + spiritAttributes.magicDefense,
        speed: secondaryAttributes.speed + spiritAttributes.speed
    }; // 刷新战斗属性

    updateUI();
}

function updateUI() {
    document.getElementById("your-pet-health").innerText = battleAttributes.health;
    document.getElementById("your-pet-mana").innerText = battleAttributes.mana;
    document.getElementById("your-pet-physical-attack").innerText = battleAttributes.physicalAttack;
    document.getElementById("your-pet-physical-defense").innerText = battleAttributes.physicalDefense;
    document.getElementById("your-pet-magic-attack").innerText = battleAttributes.magicAttack;
    document.getElementById("your-pet-magic-defense").innerText = battleAttributes.magicDefense;
    document.getElementById("your-pet-speed").innerText = battleAttributes.speed;

    document.getElementById("enemy-pet-health").innerText = battleState.enemy.health;
    document.getElementById("enemy-pet-mana").innerText = battleState.enemy.mana;
    document.getElementById("enemy-pet-physical-attack").innerText = battleState.enemy.physicalAttack;
    document.getElementById("enemy-pet-physical-defense").innerText = battleState.enemy.physicalDefense;
    document.getElementById("enemy-pet-magic-attack").innerText = battleState.enemy.magicAttack;
    document.getElementById("enemy-pet-magic-defense").innerText = battleState.enemy.magicDefense;
    document.getElementById("enemy-pet-speed").innerText = battleState.enemy.speed;

    // 更新状态显示
    document.getElementById("player-status").innerText = getPlayerStatus();
    document.getElementById("enemy-status").innerText = getEnemyStatus();
}

function getPlayerStatus() {
    let status = [];
    if (battleState.player.silenced) status.push("沉默");
    if (battleState.player.reflecting) status.push("反弹");
    if (battleState.player.divineProtection) status.push("仙气护体");
    return status.join(", ");
}

function getEnemyStatus() {
    let status = [];
    if (battleState.enemy.silenced) status.push("沉默");
    if (battleState.enemy.poisoned) status.push("中毒");
    if (battleState.enemy.stunned) status.push("眩晕");
    if (battleState.enemy.sleeping) status.push("沉睡");
    if (battleState.enemy.intimidated) status.push("恐吓");
    return status.join(", ");
}

function logBattleEvent(event) {
    const logDiv = document.getElementById("log");
    if (logDiv) {
        const newEvent = document.createElement("p");
        newEvent.innerText = event;
        logDiv.appendChild(newEvent);

        // 检查日志条目数，如果超过 4 条，则删除最早的条目
        const logs = logDiv.getElementsByTagName("p");
        while (logs.length > 4) {
            logDiv.removeChild(logs[0]);
        }

        // 尝试强制滚动到最底部
        logDiv.scrollTop = logDiv.scrollHeight;
        setTimeout(() => {
            logDiv.scrollTop = logDiv.scrollHeight;
        }, 0);
        setTimeout(() => {
            logDiv.scrollTop = logDiv.scrollHeight;
        }, 50);
        setTimeout(() => {
            logDiv.scrollTop = logDiv.scrollHeight;
        }, 100);
    } else {
        console.error("logDiv not found");
    }
}


function performAttack(type) {
    if (!attributesFetched) {
        alert("请先从属性面板获取属性。");
        return;
    }

    if (!battleState || !battleState.enemy) {
        console.error("战斗状态未初始化");
        return;
    }

    if (battleAttributes.health <= 0) {
        logBattleEvent("您已经输掉此次战斗，请再接再厉，点击进入下一轮战斗！");
        showNextBattlePrompt(false);
        return;
    }

    let damage;
    let isCritical = false;
    let critMultiplier = 1;
    const critChance = battleAttributes.speed / 10000; // 计算暴击概率

    if (Math.random() < critChance) {
        isCritical = true;
        critMultiplier = (Math.random() * (1.1 - 0.9) + 0.9) * 2;
        logBattleEvent("你发动了暴击，造成了双倍伤害！");
        const logDiv = document.getElementById('log');
        logDiv.classList.add('critical-hit');
        setTimeout(() => {
            logDiv.classList.remove('critical-hit');
        }, 300);
    }

    if (type === 'physical' || battleState.enemy.silenced) { // 沉默时只能使用物理攻击
        const defenseFactor = (Math.random() * (1.2 - 0.8) + 0.8);
        const effectiveDefense = Math.floor(battleState.enemy.physicalDefense * defenseFactor / 2);
        damage = Math.max(0, Math.floor((battleAttributes.physicalAttack || 0) * critMultiplier - effectiveDefense));
        battleState.enemy.health = Math.max(0, battleState.enemy.health - damage);
        logBattleEvent(`你进行了物理攻击，造成了 ${damage} 点伤害。`);
    } else if (type === 'magical') {
        if (battleAttributes.mana < 50) {
            logBattleEvent("您的法力值不足！");
            performAttack('physical');
            return;
        }

        const defenseFactor = (Math.random() * (1.2 - 0.8) + 0.8);
        const effectiveDefense = Math.floor(battleState.enemy.magicDefense * defenseFactor / 2);
        damage = Math.max(0, Math.floor((battleAttributes.magicAttack || 0) * critMultiplier - effectiveDefense));
        battleState.enemy.health = Math.max(0, battleState.enemy.health - damage);

        const manaCost = Math.floor(Math.random() * (100 - 50 + 1)) + 50; // 随机扣除50到100之间的法力值
        battleAttributes.mana = Math.max(0, battleAttributes.mana - manaCost);
        logBattleEvent(`你进行了法术攻击，造成了 ${damage} 点伤害，消耗了 ${manaCost} 点法力值。`);
        applyMagicEffects();

        // 检查中毒效果
        if (battleState.enemy.poisoned) {
            const poisonDamage = Math.floor(battleAttributes.magicAttack * battleRounds * (Math.random() * (0.06 - 0.03) + 0.03));
            battleState.enemy.health = Math.max(0, battleState.enemy.health - poisonDamage);
            logBattleEvent(`敌人中毒，失去了 ${poisonDamage} 点生命值。`);
        }
    }

    if (battleState.enemy.sleeping && type !== 'heal') { // 敌人沉睡状态
        battleState.enemy.sleeping = false;
        logBattleEvent("敌人从沉睡中醒来。");
    }

    if (battleState.enemy.health <= 0) {
        logBattleEvent("您赢得了此次战斗，金子+100！点击进入下一轮战斗！");
        goldAmount += 100;
        document.getElementById("gold-amount").innerText = goldAmount;
        updateEnemyAttributes();
        showNextBattlePrompt(true);
        return;
    }

    playerTurn = false; // 轮到敌人回合
    setTimeout(enemyAttack, 200); // 延迟0.2秒后敌人回合

    updateUI();
}


function applyMagicEffects() {
    const effects = ['silence', 'armorBreak', 'stun', 'weaken', 'poison', 'reflect', 'divineProtection', 'sleep', 'intimidate'];
    const effect = effects[Math.floor(Math.random() * effects.length)];
    const effectChance = Math.random(); // 生成一个0到1之间的随机数

    if (effectChance < 0.3) { // 30%的概率触发效果
        switch (effect) {
            case 'silence':
                battleState.enemy.silenced = true; // 敌人沉默
                logBattleEvent("敌人被沉默，无法使用特殊技能。");
                setTimeout(() => { battleState.enemy.silenced = false; }, 5000); // 沉默5秒
                break;
            case 'armorBreak':
                const armorBreakValue = Math.floor(battleAttributes.physicalAttack * (Math.random() * (0.24 - 0.12) + 0.12));
                battleState.enemy.physicalDefense -= armorBreakValue; // 破甲
                logBattleEvent(`敌人的护甲被破坏，物理防御减少了 ${armorBreakValue} 点。`);
                setTimeout(() => {
                    battleState.enemy.physicalDefense += armorBreakValue;
                    logBattleEvent("敌人的破甲状态消失。");
                }, 10000); // 破甲持续10秒
                break;
            case 'weaken':
                const weakenValue = Math.floor(battleAttributes.magicAttack * (Math.random() * (0.24 - 0.12) + 0.12));
                battleState.enemy.physicalAttack -= weakenValue; // 虚弱
                logBattleEvent(`敌人被虚弱，物理攻击减少了 ${weakenValue} 点。`);
                setTimeout(() => {
                    battleState.enemy.physicalAttack += weakenValue;
                    logBattleEvent("敌人的虚弱状态消失。");
                }, 10000); // 虚弱持续10秒
                break;
            case 'poison':
                battleState.enemy.poisoned = true; // 敌人中毒
                logBattleEvent("敌人被中毒，每次行动会扣除生命值。");
                setTimeout(() => { battleState.enemy.poisoned = false; }, 3000); // 中毒持续3秒
                break;
            case 'reflect':
                battleState.player.reflecting = true; // 玩家反弹状态
                logBattleEvent("你获得了反弹状态，反弹敌人攻击的20%伤害。");
                setTimeout(() => { battleState.player.reflecting = false; }, 5000); // 反弹持续5秒
                break;
            case 'divineProtection':
                if (Math.random() < 0.15) { // 15%的概率触发仙气护体
                    battleState.player.divineProtection = true; // 仙气护体
                    logBattleEvent("你获得了仙气护体状态，受到伤害时会恢复生命值。");
                    setTimeout(() => { battleState.player.divineProtection = false; }, 5000); // 仙气护体持续5秒
                }
                break;
            case 'sleep':
                battleState.enemy.sleeping = true; // 敌人沉睡
                logBattleEvent("敌人进入沉睡状态，不会行动但会恢复生命值。");
                break; // 沉睡状态会在玩家攻击时解除
            case 'intimidate':
                battleState.enemy.intimidated = true; // 敌人恐吓状态
                logBattleEvent("敌人被恐吓，无法暴击。");
                setTimeout(() => { battleState.enemy.intimidated = false; }, 5000); // 恐吓持续5秒
                break;
            case 'stun':
                battleState.enemy.stunned = true; // 敌人眩晕
                logBattleEvent("敌人被眩晕，无法行动。");
                setTimeout(() => { battleState.enemy.stunned = false; }, 3000); // 眩晕3秒
                break;
        }
    }
}

function performHeal() {
    if (!attributesFetched) {
        alert("请先从属性面板获取属性。");
        return;
    }

    const manaCost = 88 * battleRounds;
    if (battleAttributes.mana < manaCost) {
        logBattleEvent("您的法力值不足，无法治疗！");
        return;
    }

    const healAmount = Math.floor(3 * battleAttributes.magicAttack * (Math.random() * (1.2 - 0.8) + 0.8));
    battleAttributes.health = Math.min(maxHealth, battleAttributes.health + healAmount);
    battleAttributes.mana = Math.max(0, battleAttributes.mana - manaCost);

    logBattleEvent(`你治疗了自己，恢复了 ${healAmount} 点生命值，消耗了 ${manaCost} 点法力值。`);

    // 检查仙气护体效果
    if (Math.random() < 0.15) {
        battleState.player.divineProtection = true; // 仙气护体
        logBattleEvent("你获得了仙气护体状态，受到伤害时会恢复生命值。");
        setTimeout(() => { battleState.player.divineProtection = false; }, 5000); // 仙气护体持续5秒
    }

    playerTurn = false; // 轮到敌人回合
    enemyAttack();
    showEffect('enemyEffect');
    updateUI();
}

function startBattle() {
    if (!attributesFetched) {
        alert("请先从属性面板获取属性。");
        return;
    }

    logBattleEvent("战斗开始！");

    playerTurn = battleAttributes.speed >= battleState.enemy.speed; // 根据速度值决定优先攻击顺序
    updateUI();

    if (!playerTurn) {
        enemyAttack(); // 敌人先攻
    }
}

function stopBattle() {
    clearInterval(battleInterval);
    logBattleEvent("战斗停止。");
}

function showNextBattlePrompt(playerWon) {
    if (playerWon) {
        const minRewardMultiplier = 0.35;
        const maxRewardMultiplier = 1.75;
        const rewardMultiplier = Math.random() * (maxRewardMultiplier - minRewardMultiplier) + minRewardMultiplier;
        let reward = Math.floor(288 * battleRounds * rewardMultiplier);
        reward = Math.max(reward, 288); // 确保最低奖励为 288
        
        goldAmount += reward;
        alert(`您赢得了此次战斗，金子+${reward}！点击进入下一轮战斗！您已经胜利了 ${battleRounds} 轮次`);
        
        battleRounds++;
        document.getElementById("gold-amount").innerText = goldAmount;
        updateEnemyAttributes(); // 仅在玩家获胜时更新敌人属性
        gainExp(); // 获取经验
    } else {
        const penalty = 500 * battleRounds;
        goldAmount = Math.max(0, goldAmount - penalty); // 确保金子数量不为负
        alert(`您已经输掉此次战斗，扣除金子-${penalty}！请再接再厉，点击进入下一轮战斗！`);
        document.getElementById("gold-amount").innerText = goldAmount;
    }
    resetBattleState(playerWon); // 将玩家是否获胜传递给 resetBattleState
}

function gainExp() {
    const gainedExp = Math.floor(maxExp * 0.12 + (12 * battleRounds) * 0.3);
    currentExp += gainedExp;
    if (currentExp >= maxExp) {
        currentExp = 0;
        maxExp = Math.floor(maxExp * 6.4);
        alert("恭喜您升级了！");
        increasePetLevel(1); // 提升宠物一级
    }
    updateExpBar();
}

function updateExpBar() {
    document.getElementById("exp-bar").innerText = `${currentExp} / ${maxExp}`;
}

function resetBattleState(playerWon) {
    enemyHealCount = 0; // 重置怪物治疗次数
    updatePetInfo(); // 更新宠物和敌人宠物的属性
    if (!playerWon) {
        // 如果玩家没有获胜，则恢复怪物属性到本轮初始状态
        restoreEnemyState();
    }
    updateUI(); // 更新UI显示
    clearBattleLog(); // 清除战斗日志
    logBattleEvent(`新一轮战斗开始！当前是第 ${battleRounds} 轮！`); // 记录新一轮战斗开始的事件
    // 存储怪物的初始状态
    storeEnemyInitialState();
}

function storeEnemyInitialState() {
    enemyInitialState = { ...enemyPet };
}

function restoreEnemyState() {
    enemyPet = { ...enemyInitialState };
    battleState.enemy = { ...enemyPet };
}

function clearBattleLog() {
    const logDiv = document.getElementById("log");
    if (logDiv) {
        logDiv.innerHTML = ""; // 清除日志内容
    } else {
        console.error("logDiv not found");
    }
}

function enemyAttack() {
    if (!battleState || !battleAttributes || !battleState.enemy) {
        console.error("战斗状态未初始化");
        return;
    }

    if (battleState.enemy.stunned) {
        logBattleEvent("敌人眩晕，无法行动。");
        playerTurn = true;
        return;
    }

    let damage;
    let isCritical = false;
    let critMultiplier = 1;
    const critChance = battleState.enemy.speed / 10000; // 计算暴击概率

    if (Math.random() < critChance) {
        isCritical = true;
        critMultiplier = (Math.random() * (1.1 - 0.9) + 0.9) * 2;
        logBattleEvent("敌人发动了暴击，造成了双倍伤害！");
        const logDiv = document.getElementById('log');
        logDiv.classList.add('critical-hit');
        setTimeout(() => {
            logDiv.classList.remove('critical-hit');
        }, 300);
    }

    const attackType = Math.random() < 0.5 ? 'physical' : 'magical';

    if (attackType === 'physical') {
        const defenseFactor = (Math.random() * (1.2 - 0.8) + 0.8);
        const effectiveDefense = battleAttributes.physicalDefense * defenseFactor / 2;
        damage = Math.max(0, Math.floor((battleState.enemy.physicalAttack || 0) * critMultiplier - effectiveDefense));
        battleAttributes.health = Math.max(0, battleAttributes.health - damage);
        logBattleEvent(`敌人进行了物理攻击，造成了 ${damage} 点伤害。`);
    } else if (attackType === 'magical' && !battleState.enemy.silenced) {
        if (battleState.enemy.mana < 50) {
            logBattleEvent("敌人的法力值不足！");
            enemyAttack('physical');
            return;
        }

        const defenseFactor = (Math.random() * (1.2 - 0.8) + 0.8);
        const effectiveDefense = battleAttributes.magicDefense * defenseFactor / 2;
        damage = Math.max(0, Math.floor((battleState.enemy.magicAttack || 0) * critMultiplier - effectiveDefense));
        battleAttributes.health = Math.max(0, battleAttributes.health - damage);

        const manaCost = Math.floor(Math.random() * (100 - 50 + 1)) + 50; // 随机扣除50到100之间的法力值
        battleState.enemy.mana = Math.max(0, battleState.enemy.mana - manaCost);
        logBattleEvent(`敌人进行了法术攻击，造成了 ${damage} 点伤害，消耗了 ${manaCost} 点法力值。`);
    } else {
        logBattleEvent("敌人被沉默，无法进行法术攻击。");
    }

    if (battleAttributes.health <= 0) {
        logBattleEvent("您已经输掉此次战斗，请再接再厉，点击重新战斗！");
        showNextBattlePrompt(false);
    } else {
        updateUI();
        playerTurn = true; // 轮到玩家回合
    }
}


function enemyHeal() {
    if (enemyHealCount >= 3) {
        logBattleEvent("敌人尝试使用治疗术，但被我方打断了！");
        return;
    }

    const manaCost = 100;
    const healAmount = Math.floor(3 * battleState.enemy.magicAttack * (Math.random() * (1.2 - 0.8) + 0.8));
    battleState.enemy.health = Math.min(enemyMaxHealth, battleState.enemy.health + healAmount);
    battleState.enemy.mana = Math.max(0, battleState.enemy.mana - manaCost);
    enemyHealCount += 1; // 增加治疗次数

    logBattleEvent(`敌人治疗了自己，恢复了 ${healAmount} 点生命值，消耗了 ${manaCost} 点法力值。`);
    playerTurn = true; // 轮到玩家回合
    showEffect('enemyEffect');
    updateUI();
}

function updateEnemyAttributes() {
    const player = battleAttributes;
    enemyPet.health = Math.floor(enemyPet.health * 1.02);
    enemyPet.mana = Math.floor(enemyPet.mana * 1.01);
    enemyPet.physicalAttack = Math.floor(enemyPet.physicalAttack * 1.05);
    enemyPet.physicalDefense = Math.floor(enemyPet.physicalDefense * 1.035);
    enemyPet.magicAttack = Math.floor(enemyPet.magicAttack * 1.035);
    enemyPet.magicDefense = Math.floor(enemyPet.magicDefense * 1.035);
    enemyPet.speed = Math.floor(enemyPet.speed * 1.005);

    if (enemyPet.health > player.maxHealth * 1.5) enemyPet.health = Math.floor(player.maxHealth * 1.5);
    if (enemyPet.mana > player.maxMana * 1.5) enemyPet.mana = Math.floor(player.maxMana * 1.5);
    if (enemyPet.physicalAttack > player.physicalAttack * 1.5) enemyPet.physicalAttack = Math.floor(player.physicalAttack * 1.5);
    if (enemyPet.physicalDefense > player.physicalDefense * 1.5) enemyPet.physicalDefense = Math.floor(player.physicalDefense * 1.5);
    if (enemyPet.magicAttack > player.magicAttack * 1.5) enemyPet.magicAttack = Math.floor(player.magicAttack * 1.5);
    if (enemyPet.magicDefense > player.magicDefense * 1.5) enemyPet.magicDefense = Math.floor(player.magicDefense * 1.5);
    if (enemyPet.speed > player.speed * 1.5) enemyPet.speed = Math.floor(player.speed * 1.5);

    battleState.enemy = { ...enemyPet };
}

// lottery.js
let lotteryPrizePool = "无上限奖池";
let lotteryBetCount = 0;
let lotteryBetAmount = 0;
let lotterySelectedNumbers = [];
let lastSelectedNumbers = [];
let lotteryCountdown = 10;
let lotteryDrawInterval;
let canBet = true;
let pendingPrize = 0;

function toggleLotteryDrawer() {
    const drawer = document.getElementById('lotteryDrawer');
    drawer.classList.toggle('open');
    if (drawer.classList.contains('open')) {
        startLotteryCountdown();
    } else {
        stopLotteryCountdown();
    }
}
document.getElementById('lotteryRuleButton').addEventListener('click', () => {
    const ruleContent = document.getElementById('ruleContent');
    ruleContent.innerHTML = `
        <h2>彩券规则</h2>
        <p>金子不够花，想要以小博大？</p>
        <ul>
            <li>玩家需选择6个数字，其中前5个数字为红球，第6个数字为蓝球。</li>
            <li>每注200金子，最低投注1注。</li>
            <li>上次选号区会以红色显示当次中奖的数字。</li>
            <li>倒计时10秒实时开奖，离开彩券界面会暂停计时。</li>
            <li>当玩家选择的数字和开奖数字匹配时，即可获得相应奖金。</li>
            <li>详细中奖规则：</li>
            <ul>
                <li>5个红球全中且排列顺序一致：5000000金子</li>
                <li>5个红球全中：150000金子</li>
                <li>4个红球且排列顺序一致：1000000金子</li>
                <li>4个红球全中：50000金子</li>
                <li>3个红球全中且排列顺序一致：100000金子</li>
                <li>3个红球全中：5000金子</li>
                <li>2个红球全中且排列顺序一致：10000金子</li>
                <li>2个红球全中：500金子</li>
                <li>只中1个红球：200金子</li>
            </ul>
            <li>蓝球规则：</li>
            <ul>
                <li>如果蓝球一致且红球中奖，当前奖金翻10倍。</li>
                <li>如果蓝球一致但红球未中奖，奖金为固定1000金子。</li>
            </ul>
            <li>本系统只用于游戏货币道具的随机获取，赌博是违法犯罪的行为，请勿铤而走险！</li>
        </ul>
    `;
    document.getElementById('lotteryRuleModal').style.display = 'block';
});

document.querySelector('.modal .close').addEventListener('click', () => {
    document.getElementById('lotteryRuleModal').style.display = 'none';
});

window.addEventListener('click', (event) => {
    if (event.target == document.getElementById('lotteryRuleModal')) {
        document.getElementById('lotteryRuleModal').style.display = 'none';
    }
});

function startLotteryCountdown() {
    lotteryDrawInterval = setInterval(() => {
        lotteryCountdown--;
        document.getElementById('lotteryCountdown').textContent = `倒计时: ${lotteryCountdown}s`;
        if (lotteryCountdown === 0) {
            performLotteryDraw();
            lotteryCountdown = 10;
            canBet = true;
        }
    }, 1000);
}

function stopLotteryCountdown() {
    clearInterval(lotteryDrawInterval);
    lotteryCountdown = 10;
    document.getElementById('lotteryCountdown').textContent = `倒计时: ${lotteryCountdown}s`;
}

function performLotteryDraw() {
    const { numbers: winningNumbers, blueBall: winningBlueBall } = generateLotteryWinningNumbers();
    document.getElementById('lotteryDrawResults').innerHTML = `开奖区: ${winningNumbers.join(', ')} <span style="color: blue;">${winningBlueBall}</span>`;
    const prize = calculateLotteryPrize(winningNumbers, winningBlueBall);
    if (prize > 0) {
        pendingPrize += prize;
        updateDescriptionBox(`恭喜你彩票中得${prize}金子，请速速领取！`);
    }
    highlightMatchingNumbers(winningNumbers, winningBlueBall);
    clearSelections();
}


function generateLotteryWinningNumbers() {
    const numbers = [];
    while (numbers.length < 5) {
        const num = String(Math.floor(Math.random() * 30) + 1).padStart(2, '0');
        if (!numbers.includes(num)) {
            numbers.push(num);
        }
    }
    const blueBall = String(Math.floor(Math.random() * 30) + 1).padStart(2, '0');
    return { numbers, blueBall };
}


function calculateLotteryPrize(winningNumbers, winningBlueBall) {
    const prizeTable = {
        '5:exact': 5000000,
        '5:any': 500000,
        '4:exact': 1000000,
        '4:any': 150000,
        '3:exact': 100000,
        '3:any': 5000,
        '2:exact': 10000,
        '2:any': 500,
        '1:any': 200
    };


    const matchDetails = getMatchDetails(winningNumbers, lotterySelectedNumbers.slice(0, 5));
    const key = `${matchDetails.count}:${matchDetails.type}`;
    let prize = prizeTable[key] ? prizeTable[key] * lotteryBetCount : 0;
    
    const playerBlueBall = lotterySelectedNumbers[5];
    if (playerBlueBall === winningBlueBall) {
        if (prize > 0) {
            prize *= 10;
        } else {
            prize += 1000;
        }
        // 奖金区数字放大和闪烁效果
        const resultAmountElement = document.getElementById('lotteryResultAmount');
        resultAmountElement.classList.add('highlight');
        setTimeout(() => {
            resultAmountElement.classList.remove('highlight');
        }, 1000);
    }
    
    document.getElementById('lotteryResultAmount').innerHTML = prize > 0 ? `结果区: <span style="color: gold; font-weight: bold;">${prize}</span>` : `结果区: ${prize}`;
    return prize;
}


function getMatchDetails(winningNumbers, selectedNumbers) {
    const matchedNumbers = selectedNumbers.filter(num => winningNumbers.includes(num));
    const matchCount = matchedNumbers.length;
    let matchType = 'any';

    if (matchCount === 5 && arraysEqual(selectedNumbers, winningNumbers)) {
        matchType = 'exact';
    } else if (matchCount === 4 && arraysEqual(matchedNumbers, winningNumbers.slice(0, 4))) {
        matchType = 'exact';
    } else if (matchCount === 3 && arraysEqual(matchedNumbers, winningNumbers.slice(0, 3))) {
        matchType = 'exact';
    } else if (matchCount === 2 && arraysEqual(matchedNumbers, winningNumbers.slice(0, 2))) {
        matchType = 'exact';
    }

    return { count: matchCount, type: matchType };
}

function arraysEqual(arr1, arr2) {
    if (arr1.length !== arr2.length) return false;
    for (let i = 0; i < arr1.length; i++) {
        if (arr1[i] !== arr2[i]) return false;
    }
    return true;
}

function highlightMatchingNumbers(winningNumbers, winningBlueBall) {
    const lastSelectedElement = document.getElementById('lastSelectedNumbers');
    lastSelectedElement.innerHTML = '上次选号: ';
    lastSelectedNumbers.forEach((num, index) => {
        const span = document.createElement('span');
        span.textContent = num;
        if (index === 5) {
            span.style.color = 'blue'; // 固定蓝色字体
        }
        if (winningNumbers.includes(num) || (index === 5 && num === winningBlueBall)) {
            span.style.fontWeight = 'bold';
            span.style.color = (index === 5) ? 'blue' : 'red';
            if (index === 5 && num === winningBlueBall) {
                // 添加放大和闪烁效果
                span.classList.add('highlight');
                setTimeout(() => {
                    span.classList.remove('highlight');
                }, 1000);
            }
        }
        lastSelectedElement.appendChild(span);
        lastSelectedElement.appendChild(document.createTextNode(' '));
    });
}



document.getElementById('lotteryIncreaseBet').addEventListener('click', () => {
    if (!canBet) {
        alert('请等待本次开奖！');
        return;
    }
    lotteryBetCount++;
    lotteryBetAmount += 200;
    updateLotteryDisplay();
});

document.getElementById('lotteryIncreaseTenBet').addEventListener('click', () => {
    if (!canBet) {
        alert('请等待本次开奖！');
        return;
    }
    lotteryBetCount += 10; // 使用正确的语法增加10注
    lotteryBetAmount += 2000; // 对应增加2000
    updateLotteryDisplay();
});

document.getElementById('lotteryDecreaseBet').addEventListener('click', () => {
    if (!canBet) {
        alert('请等待本次开奖！');
        return;
    }
    if (lotteryBetCount > 1) {
        lotteryBetCount--;
        lotteryBetAmount -= 200;
        updateLotteryDisplay();
    }
});

document.getElementById('lotteryBetButton').addEventListener('click', () => {
    if (!canBet) {
        alert('请等待当前开奖结束');
        return;
    }
    if (lotterySelectedNumbers.length === 6) {
        if (lotteryBetCount === 0) {
            alert('请加注后点击投注按钮进行投注！');
            return;
        }
        if (goldAmount >= lotteryBetAmount) {
            goldAmount -= lotteryBetAmount;
            lastSelectedNumbers = [...lotterySelectedNumbers];
            document.getElementById("gold-amount").innerText = goldAmount;
            canBet = false; // Disable further bets until next draw

            // 修改这里使得第六个数字显示为蓝色
            document.getElementById('lastSelectedNumbers').innerHTML = `已选: ${lastSelectedNumbers.slice(0, 5).join(', ')} <span style="color: blue;">${lastSelectedNumbers[5]}</span>`;
            
            updateLotteryDisplay();
        } else {
            alert('余额不足');
        }
    } else {
        alert('请选择6个数字');
    }
});


document.getElementById('lotteryClaimPrize').addEventListener('click', () => {
    goldAmount += pendingPrize;
    document.getElementById("gold-amount").innerText = goldAmount;
    pendingPrize = 0;
    document.getElementById('lotteryResultAmount').innerHTML = '奖金区: 0';
    updateLotteryDisplay();
});

function updateLotteryDisplay() {
    document.getElementById('lotteryPrizePool').textContent = `奖金池: ${lotteryPrizePool}`;
    document.getElementById('lotteryBetCount').textContent = `投注数: ${lotteryBetCount}`;
    document.getElementById('lotteryBetAmount').textContent = `投注金: ${lotteryBetAmount}`;
    document.getElementById('lotteryResultAmount').innerHTML = pendingPrize > 0 ? `奖金区: <span style="color: gold; font-weight: bold;">${pendingPrize}</span>` : '奖金区: 0';
}

function clearSelections() {
    lotterySelectedNumbers = [];
    lotteryBetCount = 0;
    lotteryBetAmount = 0;
    document.getElementById('lotterySelectedNumbers').textContent = '已选: ';
    updateLotteryDisplay();
}

document.addEventListener('DOMContentLoaded', () => {
    const numberButtons = document.getElementById('lotteryNumberButtons');
    for (let i = 1; i <= 30; i++) {
        const button = document.createElement('button');
        button.textContent = String(i).padStart(2, '0');
        button.addEventListener('click', () => {
            if (lotterySelectedNumbers.length < 5 && !lotterySelectedNumbers.includes(button.textContent)) {
                lotterySelectedNumbers.push(button.textContent);
                document.getElementById('lotterySelectedNumbers').textContent = `已选: ${lotterySelectedNumbers.join(', ')}`;
            } else if (lotterySelectedNumbers.length === 5 && !lotterySelectedNumbers.includes(button.textContent)) {
                lotterySelectedNumbers.push(button.textContent);
                document.getElementById('lotterySelectedNumbers').innerHTML = `已选: ${lotterySelectedNumbers.slice(0, 5).join(', ')} <span style="color: blue;">${button.textContent}</span>`;
            }
        });
        numberButtons.appendChild(button);
    }
    
    document.getElementById('lotteryAutoSelect').addEventListener('click', () => {
        autoSelectNumbers();
    });
});

    
const autoSelectButton = document.createElement('button');
autoSelectButton.textContent = '系统选号';
autoSelectButton.addEventListener('click', () => {
    if (!canBet) {
        alert('本轮您已经选号，请等待开奖！');
        return;
    }
    lotterySelectedNumbers = [];
    while (lotterySelectedNumbers.length < 5) {
        const num = String(Math.floor(Math.random() * 30) + 1).padStart(2, '0');
        if (!lotterySelectedNumbers.includes(num)) {
            lotterySelectedNumbers.push(num);
        }
    }
    const blueBall = String(Math.floor(Math.random() * 30) + 1).padStart(2, '0');
    lotterySelectedNumbers.push(blueBall);
    document.getElementById('lotterySelectedNumbers').innerHTML = `已选: ${lotterySelectedNumbers.slice(0, 5).join(', ')} <span style="color: blue;">${blueBall}</span>`;
});
document.querySelector('.lottery-footer').appendChild(autoSelectButton);



function updateDescriptionBox(message) {
    const descriptionBox = document.getElementById("description-box");
    descriptionBox.innerText = message;
}

        
function showGuide() {
    const messageBox = document.createElement('div');
    messageBox.style = `
        width: 90%; 
        height: 65%; 
        padding: 10px; 
        background: white; 
        border: 1px solid black; 
        border-radius:10px;
        position: fixed; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%); 
        z-index: 1000;
        overflow: auto; 
        font-size: 14px;
    `;
    messageBox.innerHTML =  `<button onclick="document.body.removeChild(this.parentNode)">关闭引导</button>
                            <p>欢迎大侠试玩养宠模拟器！当前是V9.1</p>
                            <p>- 新增战斗精灵系统和相关道具，战斗精灵会给玩家提供战斗时的属性加成，觉醒后功能会完全开放；</p>
                            <p>- 新增战斗系统，目前处于初期框架测试阶段，功能尚不完全，请谨慎游玩；</p>
                            <p>- 新增彩券系统，拓展金子获取渠道；</p>
                            <p>- 新增加载页面；</p>
                            <p>- 优化部分函数逻辑；</p>
                            <p>- 优化部分显示效果；</p>
                            <p>如果大侠未接触过某网页游戏的宠物养成系统，您可能需要花费几分钟时间来阅读这些引导。</p>
                            <p>养宠模拟器可以让大侠通过各种操作，如还童、洗练、变异等，来让您的宠物变得更强。</p>
                            <p>❗️❗️❗️重要提示：大侠可以通过页面下拉栏选择不同宠物进行培养。但请注意，一旦切换其他宠物，系统将丢失此前宠物的所有信息。如果你没有想好优先培养哪只宠物，请先不要进行任何操作！</p>
                            <p>玩法按钮：点击引导按钮可弹出本提示框，供大侠查看各种功能。</p>
                            <p>资质按钮：点击后，会弹出当前宠物的资质界面。宠物的资质决定了当前宠物的总体品质。宠物资质由段位、成长率和资质值组成。资质也会影响宠物的评分，资质值越高，评分越高。</p>
                            <p>资质内部有多个功能</p>
                            <p>a.普通还童：消耗1颗还童丹重新生成当前宠物的资质和技能，并有极低的概率让宠物变异。</p>
                            <p>当宠物变异后，宠物的资质会有概率突破上限值，且段位必定为卓越或完美。一般而言，变异的宠物比未变异的宠物更强大。</p>
                            <p>当宠物变异后，继续使用还童丹将会使当前宠物失去变异状态。如果你对变异宠物的段位和成长率不满意，你可以在资质面板中的“使用还童金丹”按钮，消耗1颗还童金丹对当前宠物执行更新资质的操作，还童金丹不会改变宠物的变异状态。</p>
                            <p>b. 快速还童：如果你厌倦了手动还童，想交给系统一键提升，你可以按照弹窗指引进行输入。请注意，你也有可能消耗所有还童丹而未能达成预期结果。</p>
                            <p>c. 还童金丹：还童金丹可以在商店购买，当宠物变异后，使用还童金丹可以在不改变变异状态的情况下刷新宠物的成长率。</p>
                            <p>d. 冰魄还童：冰魄还童丹可以在不改变宠物资质的情况下更新宠物段位和成长率。</p>
                            <p>e. 刷新资质：消耗1颗资质丹，在不改变段位、成长率和变异状态的情况下，更新宠物的资质值。请注意，更新后的资质值未必比之前更好。</p>
                            <p>f. 变异宠物：消耗1颗稀有道具“灵异金丹”使当前宠物立即变异。</p>
                            <p>变异后的宠物，资质值有机会爆棚：变为未变异状态上限值的1.1倍。灵异金丹会直接在宠物当前未变异的资质值上乘以1.1倍。因此，未变异状态下，宠物资质值越高，使用灵异金丹的收益越大。</p>
                            <p>g. 进化宠物：宠物成功进化后，会随机增加各项资质的当前值。宠物可以最大进化30级，每次进化需要消耗进化之灵，宝箱可以开出不同的进化之灵。颤抖之灵用于1~6级进化，发光之灵用于7~12级进化，活跃之灵用于13~18级进化，跳动之灵用于19~24级进化，闪耀之灵用于25~30级进化。</p>
                            <p>h. 洗练技能：消耗1颗万化灵丹，为你的当前宠物随机生成技能。所生成的技能可以通过点击来查看技能说明。悟性越高，越有可能生成多个技能，稀有技能也越可能出现。</p>
                            <p>属性按钮：显示当前宠物的属性面板。宠物的资质越高，各项属性也会越高。属性是影响宠物评分的重要因素，请用心培养。属性界面中有很多按钮，功能分别如下：</p>
                            <p>a. 培养宠物：宠物在1级、60级、120级和180级时会分别获得一次培养机会，每次培养需要花费一定数量的金子，培养成功后宠物的各项属性值会按一定倍数增加。（请注意，在第一次培养后，后期培养只有当宠物刚好为规定等级时才可以执行！）</p>
                            <p>b. 普通修炼：消耗一本普通经验书（宝箱获得），让宠物提升一级。宠物等级提升时，属性会增加。</p>
                            <p>c. 高级修炼：消耗一本高级经验书（宝箱获得），让宠物提升三级。宠物等级提升时，属性会增加。</p>
                            <p>d. 提升悟性：玩家可以通过使用悟性丹来使宠物随机增加一点悟性，提升悟性失败时，会减少悟性值。</p>
                            <p>e. 一键提悟：玩家可以输入目标悟性值，由系统计算并使用道具，当悟性丹不够时，会自动停止。</p>
                            <p>f. 神级领悟：玩家可以通过宝箱获得稀有道具“举世无双悟性丹”，使用后立即让宠物悟性提升至20。</p>
                            <p>g. 飞升突破：当玩家的宠物到达160级，20悟性，且宝库中存在一颗飞升之石，可以让宠物飞升突破当前等级上限至180级。</p>
                            <p>h. 宠物传记：查看当前宠物的传记，每个宠物共有三个传记，需要评分达到各自规定值才能解锁查看。</p>
                            <p>商店按钮：弹出商店面板。商店每隔5分钟会随机刷新一次货物，大侠也可以花费50金子手动刷新。付费刷新有更大的概率出现稀有道具和更多货品。</p>
                            <p>商店所出售的道具根据其品质会随机定价，购买后会直接添加至道具栏中。</p>
                            <p>如果你购买的是宠物的天赋技能，你需要判断当前宠物的名称是否和天赋技能的宠物名称一致，其次保证你的当前宠物没有该技能，否则你将不能购买。一旦购买成功，这个技能会直接打在你的宠物技能位里。</p>
                            <p>在本游戏中，宠物的SS技能无法全部通过洗练生成，因此，如果你想要让宠物习得更多强力技能增加评分，你需要在商店里购买并使用天赋道具。</p>
                            <p>商店面板中，你可以进行宠物出售的操作，当宠物评分不足10000时，将无法出售。</p>
                            <p>当你点击出售按钮时，系统会根据你当前宠物评分的1/50进行出价，成功出售后，当前宠物各项属性会归零，同时得到等量金子。</p>
                            <p>宝箱按钮：玩家可以在宝箱界面花费金子打开各种宝箱，获得奇珍异宝和神秘道具！</p>
                            <p>宝库按钮：除页面顶部道具外，玩家通过宝箱获得的各种稀有道具会存放在此处。</p>
                            <p>💁请大侠尽情探索，本游戏还会继续更新功能，敬请期待！</p>
                            <button onclick="document.body.removeChild(this.parentNode)">关闭引导</button>`;
    document.body.appendChild(messageBox);
}

let highGradePill = 100;
let transmutationPill = 20;
let rebornPill = 20;
let bingpoRebornPill = 5;
let qualityPill = 20;
let currentWisdom = 0;
let trainCount = 0;
let skillScore = 0;
let petWisdom = 0; 
        
const descriptions = [
    "请特别注意，更换宠物会导致此前的分数复位，如果你没有想好先培养谁，请决定后再尝试！",
    "宠物的资质可以用“资质重生丹”洗练到更高的程度",
    "本游戏尽量还原养宠机制，但概率和具体玩法会有所不同，请勿视为参考",
    "二级属性会随着悟性的提高得到百分比的增长",
    "合理的分配金子培养机会可以让你的宠物评分得到最大化！",
    "5爆400？极品宠物需要更多的耐心和更专业的培养方式，当然，对金子的消耗也会更大",
    "宠物的S技能和SS技能属于稀缺技能，很难通过洗练得来，商店直接购买或许是更好的方式",
    "宠物的成长上限会因为是否觉醒和是否飞升出现较大差异",
    "为了避免双击页面放大，页面内对双击速度作出了限制",
    "品质越高、成长率越高的宠物，资质所折算的属性就会越高，总体能力就会更强",
    "宠物变异时，资质会得到明显的提升，甚至超出原有的资质上限！",
    "目前共有三种还童丹，每种还童丹的功能各不同，详情可见“玩法”说明",
    "稀有道具只能通过宝箱开启获得。开启宝箱时，有概率同时出现1~3个奖品",
    "宠物评分由多个维度组成，请你同时兼顾技能质量、资质水平和宠物等级！",
    "如果你需要删除某个技能，你可以长按该技能确认删除（如果是PC端，你需要右键确认）"
];        

function updateDescriptionBox() {
    const descriptionBox = document.getElementById("description-box");
    const randomIndex = Math.floor(Math.random() * descriptions.length);
    descriptionBox.innerText = descriptions[randomIndex];
}

let evolutionLevel = 0;

function evolvePet() {
    // 定义不同进化阶段所需的道具。
    const evolutionItems = {
        0: 'shakingSoul',
        7: 'glowingSoul',
        13: 'activeSoul',
        19: 'jumpingSoul',
        25: 'radiantSoul'
    };

    let requiredItem; // 存储当前进化所需的道具。
    let successRate;  // 存储当前进化的成功率。
    let increaseValue = 0; // 存储进化成功时资质提升的数值。

    // 根据当前的进化等级设置所需的道具、成功率和资质提升数值。
    if (evolutionLevel < 7) {
        requiredItem = evolutionItems[0];
        successRate = 0.8;
        increaseValue = 200;
    } else if (evolutionLevel < 13) {
        requiredItem = evolutionItems[7];
        successRate = 0.7;
        increaseValue = 300;
    } else if (evolutionLevel < 19) {
        requiredItem = evolutionItems[13];
        successRate = 0.6;
        increaseValue = 400;
    } else if (evolutionLevel < 25) {
        requiredItem = evolutionItems[19];
        successRate = 0.5;
        increaseValue = 200;
    } else if (evolutionLevel < 30) {
        requiredItem = evolutionItems[25];
        successRate = 0.8;
        increaseValue = 100;
    } else {
        // 如果进化等级达到上限，提示用户并退出函数。
        alert("您的宠物已达进化等级上限！");
        return;
    }

    // 检查用户是否有足够的所需道具，如果没有，提示用户并退出函数。
    const item = jinnangItems.find(i => i.name === requiredItem);
    if (item.quantity < 1) {
        alert(`您的${item.displayName}不足！`);
        return;
    }

    // 随机生成一个数，如果小于成功率，则进化成功。
    if (Math.random() < successRate) {
        // 如果进化等级小于31，提升随机资质。
        if (evolutionLevel < 31) {
            increaseRandomQuality(increaseValue);
        }

        // 减少用户的所需道具数量。
        item.quantity--;
        // 增加进化等级。
        evolutionLevel++;
        // 更新用户的道具数量显示。
        updateJinnangItems();
        // 更新进化等级的显示。
        document.getElementById("evolution-level").innerText = evolutionLevel;
        // 更新资质卡片和技能分数的显示。
        updateQualityCard();
        updateSkillScore();
    } else {
        // 如果进化失败，减少用户的所需道具数量，并提示用户进化失败。
        item.quantity--;
        alert("进化失败！");
        updateJinnangItems();
    }
}

function increaseRandomQuality(increaseValue) {
    // 获取当前宠物的资质
    const qualities = currentPet.qualities;
    // 定义需要提升的资质属性
    const attributes = ['endurance', 'intelligence', 'strength', 'agility', 'faith'];
    // 标记是否增加了资质值
    let addedValue = false;

    // 遍历每个资质属性
    for (let i = 0; i < attributes.length; i++) {
        const attribute = attributes[i];
        // 获取该属性的最大值
        const maxValue = qualities[attribute].max;

        // 如果当前资质值小于最大值
        if (qualities[attribute].current < maxValue) {
            // 增加当前资质值，但不超过最大值
            qualities[attribute].current = Math.min(qualities[attribute].current + increaseValue, maxValue);
            // 标记为已增加资质值
            addedValue = true;
            break;
        }
    }

    // 如果没有任何资质值被增加，说明所有资质都已达最大值
    if (!addedValue) {
        console.log("所有资质已达最大值，进化不会带来任何资质值的提升");
    }

    // 更新资质卡片
    updateQualityCard();
}

function useSupremeWisdomPill() {
    if (!currentPet || !currentPet.qualities) { // 添加检查
        console.warn("当前宠物未被正确初始化。");
        return;
    }

    if (currentWisdom >= 20) {
        alert("宠物的悟性已经达到20，无法再次提升！");
        return;
    }

    const item = jinnangItems.find(i => i.name === 'supremeWisdomPill');
    if (item.quantity > 0) {
        item.quantity--;
        currentWisdom = 20;
        updateJinnangItems();
        updateAttributePanel();
        document.getElementById("current-wisdom").innerText = currentWisdom;
        alert("您使用了举世无双悟性丹，宠物的悟性已提升至20！");
    } else {
        alert("您没有举世无双悟性丹，无法将宠物瞬间提升到20悟性！");
    }
}

function increasePetLevel(levels) {
    if (petLevel >= petMaxLevel) {
        alert("宠物等级已达上限，无法继续升级！");
        console.log("Level Up Error: Max level reached.");
        return;
    }

    const oldLevel = petLevel;
    petLevel += levels;
    if (petLevel > petMaxLevel) petLevel = petMaxLevel; // 确保等级不超过上限

    const actualLevelsIncreased = petLevel - oldLevel;
    remainingPoints += actualLevelsIncreased * 2; // 每提升1级增加2个可分配点数

    updatePetLevel();
    updateAttributePanel();
    updateRemainingPointsDisplay();

    console.log(`Pet Level Increased: Pet Level = ${petLevel}, Remaining Points = ${remainingPoints}`);
}
        
function absorbExperience() {
    const item = jinnangItems.find(i => i.name === 'normalExperienceBook');
    if (item.quantity <= 0) {
        alert("您的普通经验书不够，宠物无法升级！");
        return;
    }
    if (petLevel >= petMaxLevel) {
        alert("宠物等级已达上限，无法继续升级！");
        return;
    }
    item.quantity--;
    updateJinnangItems();
    increasePetLevel(1);
}

function absorbAdvancedExperience() {
    const item = jinnangItems.find(i => i.name === 'advancedExperienceBook');
    if (item.quantity <= 0) {
        alert("您的高级经验书不够，宠物无法升级！");
        return;
    }
    if (petLevel >= petMaxLevel) {
        alert("宠物等级已达上限，无法继续升级！");
        return;
    }
    item.quantity--;
    updateJinnangItems();
    increasePetLevel(3);
}


let petLevel = 1;
let petMaxLevel = 149;
let petAscended = false;
        
function ascend() {
    // Retrieve the current pet level and wisdom from the attribute panel
    let petLevel = parseInt(document.getElementById('pet-level').innerText);
    let petWisdom = parseInt(document.getElementById('current-wisdom').innerText);

    // Check if the pet has already ascended
    if (petAscended) {
        alert("您的宠物已经飞升！使用道具失败！");
        return;
    }

    // Check if the pet meets the level and wisdom requirements and if there is an ascension stone in the inventory
    const item = jinnangItems.find(i => i.name === 'ascensionStone');
    if (petLevel < 160 || petWisdom < 24 || item.quantity <= 0) {
        alert("您的飞升石不够，且宠物飞升必须满足160级和24悟两个条件！(20级悟性之后，需要使用商店所售道具“特级悟性丹”才能继续提升悟性。)");
        return;
    }

    // Deduct one ascension stone from the inventory
    item.quantity--;
    updateJinnangItems();

    // Update pet's max level and ascension status
    petMaxLevel = 180;
    petAscended = true;

    alert("恭喜大侠的爱宠飞升成功！");
}

function updatePetLevel() {
    document.getElementById('pet-level').innerText = petLevel;
}

let selectedTreasure = null;
let rewards = []; // 定义全局变量来存储奖品
let experienceTreasureOpenCount = 0; // 定义经验宝箱打开次数的全局变量

function toggleTreasureDrawer() {
    const drawer = document.getElementById('treasure-drawer');
    const info = document.getElementById('treasure-info');
    drawer.classList.toggle('open');
    info.classList.toggle('open');
}

function selectTreasure(type) {
    selectedTreasure = type;
    updateTreasureDescription(type);
}

function updateTreasureDescription(type) {
    let description;
    if (type === '经验宝箱') {
        const cost = getTreasureCost('经验宝箱');
        description = `充满智慧的宝箱，本次开启将花费${cost}金子。有概率获得宠物升级的经验书和飞升之石。`;
    } else {
        switch (type) {
            case '奇馈宝箱':
                description = "充满奇异道具的宝箱，每次开启花费150金子，您可能获得神兽还童丹、还童金丹和资质重生丹，甚至还能获得培养战斗精灵的稀有道具！";
                break;
            case '灵魂宝箱':
                description = "神秘莫测的宝箱，每次开启花费300金子，您可能获得宠物进化所需的各种灵魂！";
                break;
            case '至尊宝箱':
                description = "价值连城的宝箱，每次开启花费1000金子，您可能获得举世无双悟性丹，飞升之石等超稀有道具，甚至还有神秘进化法宝等你来拿！";
                break;
        }
    }
    document.getElementById('treasure-description').innerText = description;
}

function openTreasure() {
    if (!selectedTreasure) {
        alert("请先选择一个宝箱！");
        return;
    }

    const cost = getTreasureCost(selectedTreasure);
    if (goldAmount < cost) {
        alert("金子不足！");
        return;
    }

    // 自动收集上次未取出的奖品
    collectTreasure();

    if (selectedTreasure === '经验宝箱') {
        experienceTreasureOpenCount++; // 增加经验宝箱开启次数
    }

    goldAmount -= cost;
    document.getElementById("gold-amount").innerText = goldAmount;

    // 根据概率随机生成 1~3 个奖品
    let rewardCount;
    const random = Math.random() * 100;
    if (random < 95) {
        rewardCount = 1;
    } else if (random < 99) {
        rewardCount = 2;
    } else {
        rewardCount = 3;
    }

    rewards = [];
    for (let i = 0; i < rewardCount; i++) {
        rewards.push(getRandomReward(selectedTreasure));
    }

    // 更新页面显示多个奖品
    let rewardHTML = '';
    for (const reward of rewards) {
        rewardHTML += `<div><img src="${reward.url}" alt="${reward.name}"><div>${reward.name}</div></div>`;
    }
    document.getElementById('treasure-reward').innerHTML = rewardHTML;
}

function collectTreasure() {
    if (rewards.length === 0) {
        return;
    }

    for (const reward of rewards) {
        switch (reward.name) {
            case '普通经验书':
                addItemToJinnang('normalExperienceBook');
                break;
            case '高级经验书':
                addItemToJinnang('advancedExperienceBook');
                break;
            case '飞升之石':
                addItemToJinnang('ascensionStone');
                break;
            case '举世无双悟性丹':
                addItemToJinnang('supremeWisdomPill');
                break;
            case '闪耀之灵':
                addItemToJinnang('radiantSoul');
                break;
            case '颤抖之灵':
                addItemToJinnang('shakingSoul');
                break;
            case '发光之灵':
                addItemToJinnang('glowingSoul');
                break;
            case '活跃之灵':
                addItemToJinnang('activeSoul');
                break;
            case '跳动之灵':
                addItemToJinnang('jumpingSoul');
                break;
            case '醒悟丹':
                addItemToJinnang('awakenPill');
                break;
            case '离魂石':
                addItemToJinnang('seperateStone');
                break;
            case '凝魄石':
                addItemToJinnang('coagulateStone');
                break;
            case '精灵精炼石':
                addItemToJinnang('spiritRefreshStone');
                break;
            case '精灵觉醒石':
                addItemToJinnang('spiritAwakenStone');
                break;
            default:
                addItemToTopBar(reward);
                break;
        }
    }

    // 清空奖品
    rewards = [];
    document.getElementById('treasure-reward').innerHTML = "";
    // 更新经验宝箱描述
    if (selectedTreasure === '经验宝箱') {
        updateTreasureDescription('经验宝箱');
    }
}

function getTreasureCost(type) {
    if (type === '经验宝箱') {
        if (experienceTreasureOpenCount < 20) {
            return 100;
        } else if (experienceTreasureOpenCount < 40) {
            return 100 + (experienceTreasureOpenCount * 5);
        } else if (experienceTreasureOpenCount < 60) {
            return 200 + (experienceTreasureOpenCount * 10);
        } else if (experienceTreasureOpenCount < 80) {
            return 500 + (experienceTreasureOpenCount * 15);
        } else {
            return 2000;
        }
    }

    switch (type) {
        case '奇馈宝箱':
            return 150;
        case '灵魂宝箱':
            return 300;
        case '至尊宝箱':
            return 1000;
    }
}

function getRandomReward(type) {
    const rewards = {
        '经验宝箱': [
            { name: '普通经验书', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e9b.png', chance: 80 },
            { name: '高级经验书', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e7b.png', chance: 19.95 },
            { name: '飞升之石', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e6d.png', chance: 0.05 }
        ],
        '奇馈宝箱': [
            { name: '神兽还童丹', url: 'https://pic.imgdb.cn/item/6654a944d9c307b7e9ca6423.png', chance: 19 },
            { name: '还童金丹', url: 'https://pic.imgdb.cn/item/6655a92ad9c307b7e9c04265.png', chance: 19 },
            { name: '精灵精炼石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991c04a.png', chance: 19 },
            { name: '精灵觉醒石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991bf78.png', chance: 19 },
            { name: '资质重生丹', url: 'https://pic.imgdb.cn/item/6654a944d9c307b7e9ca63f5.png', chance: 19 },
            { name: '灵异金丹', url: 'https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png', chance: 5 }
        ],
        '灵魂宝箱': [
            { name: '颤抖之灵', url: 'https://pic.imgdb.cn/item/6656e821d9c307b7e90988b2.png', chance: 30 },
            { name: '发光之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e909844a.png', chance: 30 },
            { name: '活跃之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e90984b7.png', chance: 30 },
            { name: '跳动之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e909843e.png', chance: 10 }
        ],
        '至尊宝箱': [
            { name: '飞升之石', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e6d.png', chance: 10 },
            { name: '灵异金丹', url: 'https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png', chance: 20 },
            { name: '举世无双悟性丹', url: 'https://pic.imgdb.cn/item/665ef0845e6d1bfa055800c7.png', chance: 10 },
            { name: '醒悟丹', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa05609a45.png', chance: 10 },
            { name: '离魂石', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa056099a3.png', chance: 15 },
            { name: '凝魄石', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa05609a0f.png', chance: 15 },
            { name: '闪耀之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e9098478.png', chance: 20 }
        ]
    };
    return selectReward(rewards[type]);
}

function selectReward(rewardList) {
    const random = Math.random() * 100;
    let cumulativeChance = 0;
    for (const reward of rewardList) {
        cumulativeChance += reward.chance;
        if (random <= cumulativeChance) {
            return reward;
        }
    }
}

// 新增全局变量
let jinnangItems = [
    { name: 'normalExperienceBook', displayName: '普通经验书', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e9b.png', quantity: 0 },
    { name: 'tejiWisdomPill', displayName: '特级悟性丹', url: 'https://pic.imgdb.cn/item/665de3fd5e6d1bfa05564912.png', quantity: 0 },
    { name: 'advancedExperienceBook', displayName: '高级经验书', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e7b.png', quantity: 0 },
    { name: 'awakenPill', displayName: '醒悟丹', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa05609a45.png', quantity: 0 },
    { name: 'coagulateStone', displayName: '凝魄石', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa05609a0f.png', quantity: 0 },
    { name: 'seperateStone', displayName: '离魂石', url: 'https://pic.imgdb.cn/item/665ef5a15e6d1bfa056099a3.png', quantity: 0 },
    { name: 'ascensionStone', displayName: '飞升之石', url: 'https://pic.imgdb.cn/item/6656e734d9c307b7e9088e6d.png', quantity: 0 },
    { name: 'supremeWisdomPill', displayName: '举世无双悟性丹', url: 'https://pic.imgdb.cn/item/665ef0845e6d1bfa055800c7.png', quantity: 0 },
    { name: 'spiritRefreshStone', displayName: '精灵精炼石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991c04a.png', quantity: 0 },
    { name: 'spiritAwakenStone', displayName: '精灵觉醒石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991bf78.png', quantity: 0 },
    { name: 'radiantSoul', displayName: '闪耀之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e9098478.png', quantity: 0 },
    { name: 'shakingSoul', displayName: '颤抖之灵', url: 'https://pic.imgdb.cn/item/6656e821d9c307b7e90988b2.png', quantity: 0 },
    { name: 'glowingSoul', displayName: '发光之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e909844a.png', quantity: 0 },
    { name: 'activeSoul', displayName: '活跃之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e90984b7.png', quantity: 0 },
    { name: 'jumpingSoul', displayName: '跳动之灵', url: 'https://pic.imgdb.cn/item/6656e81dd9c307b7e909843e.png', quantity: 0 }
];

// 切换锦囊抽屉的显示状态
function toggleJinnangDrawer() {
    const drawer = document.getElementById('jinnang-drawer');
    const info = document.getElementById('jinnang-info');
    drawer.classList.toggle('open');
    info.classList.toggle('open');
    updateJinnangItems();
}

function addItemToJinnang(itemName) {
    const item = jinnangItems.find(i => i.name === itemName);
    if (item) {
        item.quantity++;
        updateJinnangItems(); // 更新锦囊内的道具数量显示
    }
}

// 更新锦囊内道具数量
function updateJinnangItems() {
    const jinnangReward = document.getElementById('jinnang-reward');
    jinnangReward.innerHTML = ''; // 清空现有内容

    jinnangItems.forEach(item => {
        if (item.quantity > 0) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'jinnang-item';
            itemDiv.innerHTML = `
                <img src="${item.url}" alt="${item.name}">
                <div>${item.displayName}</div>
                <div>${item.quantity}</div>
            `;
            jinnangReward.appendChild(itemDiv);
        }
    });
}

// 更新顶栏道具数量
function updateTopBarItems() {
    document.getElementById("high-grade-pill").innerText = highGradePill;
    document.getElementById("transmutation-pill").innerText = transmutationPill;
    document.getElementById("reborn-pill").innerText = rebornPill;
    document.getElementById("quality-pill").innerText = qualityPill;
    document.getElementById("miraculous-pill").innerText = miraculousPill;
    document.getElementById("bingpo-reborn-pill").innerText = bingpoRebornPill;
    document.getElementById("golden-reborn-pill").innerText = goldenRebornPill;
}

function addItemToTopBar(item) {
    switch (item.name) {
        case '神兽还童丹':
            rebornPill++;
            break;
        case '还童金丹':
            goldenRebornPill++;
            break;
        case '资质重生丹':
            qualityPill++;
            break;
        case '灵异金丹':
            miraculousPill++;
            break;
        case '高级悟性丹':
            highGradePill++;
            break;
        default:
            // 未知道具
            return;
    }
    updateTopBarItems();
}

function toggleAttributeDrawer() {
    const drawer = document.getElementById('attribute-drawer');
    const info = document.getElementById('attribute-info');
    drawer.classList.toggle('open');
    info.classList.toggle('open');
    updateAttributePanel();
    updatePetInfo(); // 确保更新属性后设置 attributesFetched
}
        
function calculateSecondaryAttributes(currentAttributes, currentWisdom) {
    // 基于当前悟性计算递增倍率
    let multiplier;
    if (currentWisdom <= 12) {
        multiplier = 1 + (currentWisdom * 0.005);
    } else if (currentWisdom <= 20) {
        multiplier = 1.06 + (currentWisdom - 12) * 0.01;
    } else {
        switch (currentWisdom) {
            case 21:
                multiplier = 1.20;
                break;
            case 22:
                multiplier = 1.21;
                break;
            case 23:
                multiplier = 1.22;
                break;
            case 24:
                multiplier = 1.23;
                break;
            case 25:
                multiplier = 1.25;
                break;
            default:
                multiplier = 1;
        }
    }

    const endurance = currentAttributes.endurance;
    const intelligence = currentAttributes.intelligence;
    const strength = currentAttributes.strength;
    const agility = currentAttributes.agility;
    const faith = currentAttributes.faith;

    return {
        health: Math.floor((endurance * 24 + intelligence * 1 + strength * 2 + agility * 3 + faith * 3) * multiplier),
        mana: Math.floor((endurance * 1 + intelligence * 10 + strength * 2 + agility * 2 + faith * 2) * multiplier),
        physicalAttack: Math.floor((endurance * 0.1 + intelligence * 0.1 + strength * 2.2 + agility * 0.2 + faith * 0.2) * multiplier),
        physicalDefense: Math.floor((endurance * 0.1 + intelligence * 0.1 + strength * 0.2 + agility * 0.2 + faith * 2.2) * multiplier),
        magicAttack: Math.floor((endurance * 0 + intelligence * 1.7 + strength * 0 + agility * 0 + faith * 0) * multiplier),
        magicDefense: Math.floor((endurance * 2.2 + intelligence * 0 + strength * 0 + agility * 0 + faith * 0) * multiplier),
        speed: Math.floor((endurance * 0.2 + intelligence * 0.1 + strength * 0.2 + agility * 2 + faith * 0.2) * multiplier),
    };
}

let trainingCosts = [200, 2000, 10000, 24000]; // 定义每次金子培养所需的金子数量
let trainingMultipliers = [1.1, 1.08, 1.06, 1.01]; // 定义每次金子培养的属性提升倍数
let trainingCount = 0; // 初始化已经使用的金子培养次数

function calculateAvailableTrainingCount(petLevel) {
    // 计算可用的金子培养次数
    let count = 0;
    if (petLevel >= 0) count++; // 宠物等级大于等于0时增加一次
    if (petLevel >= 60) count++; // 宠物等级大于等于60时增加一次
    if (petLevel >= 120) count++; // 宠物等级大于等于120时增加一次
    if (petLevel >= 180) count++; // 宠物等级大于等于180时增加一次
    return count;
}

function trainAttributes() {
    // 计算可用的金子培养次数
    const availableTrainingCount = calculateAvailableTrainingCount(petLevel);

    // 检查当前培养次数是否达到可用次数
    if (trainingCount >= availableTrainingCount) {
        alert("当前没有可用培养次数了。只有当宠物等级达到60、120和180时，才能各获得一次培养机会！每次培养会按比例增加宠物的属性值，请合理分配培养机会。");
        return; // 退出函数
    }

    // 获取当前培养所需的金子数量
    const cost = trainingCosts[trainingCount];

    // 提示玩家当前花费
    if (!confirm(`这次金子培养需要${cost}金子，是否继续？`)) {
        return; // 如果玩家取消，退出函数
    }

    // 检查金子数量是否足够
    if (goldAmount < cost) {
        alert("金子不足！"); // 如果金子不足，提示用户
        return; // 退出函数
    }

    // 扣除金子
    goldAmount -= cost;
    document.getElementById("gold-amount").innerText = goldAmount; // 更新显示的金子数量

    // 获取当前培养的属性提升倍数
    const multiplier = trainingMultipliers[trainingCount];

    // 获取当前属性值
    const currentAttributes = calculateCurrentAttributes();

    // 提升bonusAttributes中的值
    bonusAttributes.endurance += Math.floor(currentAttributes.endurance * (multiplier - 1));
    bonusAttributes.intelligence += Math.floor(currentAttributes.intelligence * (multiplier - 1));
    bonusAttributes.strength += Math.floor(currentAttributes.strength * (multiplier - 1));
    bonusAttributes.agility += Math.floor(currentAttributes.agility * (multiplier - 1));
    bonusAttributes.faith += Math.floor(currentAttributes.faith * (multiplier - 1));

    console.log("Updated Bonus Attributes:", bonusAttributes);

    // 增加金子培养次数
    trainingCount++;

    // 更新属性面板
    updateAttributePanel();
}


function updatePetLevel() {
    document.getElementById('pet-level').innerText = petLevel;
    updateAttributePanel();
    updateSkillScore();
}

function updatePetWisdom() {
    document.getElementById("current-wisdom").innerText = petWisdom;
    document.getElementById("attribute-wisdom").innerText = petWisdom; // 更新属性面板中的悟性
    updateAttributePanel();
}
        
function showBiography() {
    const currentPetName = document.getElementById("pet-select").value;
    const biography = biographies[currentPetName];
    const skillScore = parseInt(document.getElementById("skill-score").innerText, 10);

    let message;
    if (skillScore < 200000) {
        message = "您的宠物评分过低，请提升到200000后再试！（宠物传记共有3段，当评分到达200000、1000000、3000000时会各自解锁）";
    } else if (skillScore < 1000000) {
        message = biography[0];
    } else if (skillScore < 3000000) {
        message = biography[0] + "<br>" + biography[1];
    } else {
        message = biography[0] + "<br>" + biography[1] + "<br>" + biography[2];
    }

    const messageBox = document.createElement('div');
    messageBox.style = `
        width: 90%;
        height: 70%;
        padding: 5px;
        background: rgb(255 255 255 / 95%);
        border: 1px solid black;
        position: fixed;
        border-radius: 10px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        overflow: auto;
        font-size: 14px;
        line-height: 25px;
    `;
    messageBox.innerHTML = `<p>${message}</p>
                            <button onclick="document.body.removeChild(this.parentNode)">关闭</button>`;
    document.body.appendChild(messageBox);
}

let goldenRebornPill = 5;

function useGoldenRebornPill() {
    if (goldenRebornPill < 1) {
        alert("您的还童金丹已耗尽！");
        return;
    }
    if (awakened) {
        alert("您的宠物已经觉醒，无法还童！");
        return;
    }
    goldenRebornPill--;
    document.getElementById("golden-reborn-pill").innerText = goldenRebornPill;

    const qualities = currentPet.qualities;
    if (qualities.mutated) {
        qualities.tier = Math.random() < 0.5 ? '卓越' : '完美';
        qualities.growthRate = qualities.tier === '卓越' ? getWeightedRandom([300, 320], [0.5, 0.5]) : getWeightedRandom([340, 360, 380, 400], [0.3, 0.5, 0.15, 0.05]);
    } else {
        qualities.tier = '普通';
        qualities.growthRate = 100;
    }

    qualities.endurance.current = getRandomInt(qualities.endurance.min, qualities.endurance.max);
    qualities.strength.current = getRandomInt(qualities.strength.min, qualities.strength.max);
    qualities.faith.current = getRandomInt(qualities.faith.min, qualities.faith.max);
    qualities.agility.current = getRandomInt(qualities.agility.min, qualities.agility.max);
    qualities.intelligence.current = getRandomInt(qualities.intelligence.min, qualities.intelligence.max);

    // 更新技能
    const skillNum = getRandomInt(0, 3);
    const newSkills = [];
    const bSkills = currentPet.skills.filter(skill => skill.rarity === 'B');
    for (let i = 0; i < skillNum; i++) {
        const skill = bSkills[Math.floor(Math.random() * bSkills.length)];
        if (!newSkills.some(s => s.name === skill.name)) {
            newSkills.push(skill);
        }
    }
    updateSkillsArea(newSkills);
    updateSkillScore(newSkills);
    
    petLevel = 1;
    currentWisdom = 0;
    petWisdom = currentWisdom;
    petAscended = false; //新增宠物失去飞升的还童规则
    petMaxLevel = 149;
    
    updateQualityCard();
    updateSkillScore();
}
 
let goldAmount = 50000; // 初始金子数量
document.getElementById("gold-amount").innerText = goldAmount;

function toggleShop() {
    const drawer = document.getElementById('shop-drawer');
    const info = document.getElementById('shop-info');
    drawer.classList.toggle('open');
    info.classList.toggle('open');
}

function initShop() {
    refreshShop(true);  // 初始加载商品
    startShopTimer();   // 启动倒计时
}

function startShopTimer() {
    let timer = 300; // 5分钟倒计时，单位：秒
    const timerDisplay = document.getElementById('shop-timer');

    const interval = setInterval(() => {
        timer--;
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        timerDisplay.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timer <= 0) {
            clearInterval(interval);
            refreshShop(true);  // 自动刷新
        }
    }, 1000);
}

// 页面加载完成后初始化商店

function refreshShop(auto = false) {
    if (!auto && goldAmount < 100) {
        alert("您的金子不足，无法刷新！");
        return;
    }

    if (!auto) {
        goldAmount -= 100;
        document.getElementById("gold-amount").innerText = goldAmount;
    }

    const shopItems = document.getElementById('shop-items');
    shopItems.innerHTML = '';

    let numItems = auto ? getRandomInt(1, 5) : getRandomInt(2, 24);
    let probabilities = auto ? [0.8, 0.2] : [0.7, 0.3];
    let rareItemCount = 0;
    let commonBundleCount = 0;
    let rareBundleCount = 0;

    for (let i = 0; i < numItems; i++) {
        let isRare = Math.random() < probabilities[1];
        if (!auto && isRare && rareItemCount >= 3) {
            isRare = false;
        }
        if (isRare) rareItemCount++;

        let item;
        if (isRare) {
            item = getRandomRareItem();
            if (item.name.includes('包裹')) {
                if (rareBundleCount >= 1) {
                    i--; // 重试生成
                    continue;
                } else {
                    rareBundleCount++;
                }
            }
        } else {
            item = getRandomCommonItem();
            if (item.name.includes('包裹')) {
                if (commonBundleCount >= 2) {
                    i--; // 重试生成
                    continue;
                } else {
                    commonBundleCount++;
                }
            }
        }

        const itemDiv = document.createElement('div');
        itemDiv.classList.add('shop-item');
        itemDiv.dataset.name = item.name;
        itemDiv.dataset.price = item.price;
        itemDiv.innerHTML = `<img src="${item.url}" alt="${item.name}"><div>${item.name}</div><div>${item.price} 金子</div>`;
        itemDiv.addEventListener('click', () => {
            document.querySelectorAll('.shop-item').forEach(el => el.classList.remove('selected'));
            itemDiv.classList.add('selected');
        });
        shopItems.appendChild(itemDiv);
    }

    if (auto) startShopTimer();
}

function getRandomCommonItem() {
    const commonItems = [
        { name: '高级悟性丹', url: 'https://pic.imgdb.cn/item/66541c01d9c307b7e9208aea.png', price: getRandomInt(20, 100) },
        { name: '万化灵丹', url: 'https://pic.imgdb.cn/item/66541c01d9c307b7e9208add.png', price: getRandomInt(20, 130) },
        { name: '神兽还童丹', url: 'https://pic.imgdb.cn/item/6654a944d9c307b7e9ca6423.png', price: getRandomInt(20, 220) },
        { name: '还童金丹', url: 'https://pic.imgdb.cn/item/6655a92ad9c307b7e9c04265.png', price: getRandomInt(60, 220) },
        { name: '冰魄还童丹', url: 'https://pic.imgdb.cn/item/665ef0855e6d1bfa055800f4.png', price: getRandomInt(99, 299) },
        { name: '资质重生丹', url: 'https://pic.imgdb.cn/item/6654a944d9c307b7e9ca63f5.png', price: getRandomInt(88, 288) },
        { name: '精灵精炼石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991c04a.png', price: getRandomInt(188, 388) },
        { name: '精灵觉醒石', url: 'https://pic.imgdb.cn/item/6669666cd9c307b7e991bf78.png', price: getRandomInt(388, 688) },
        { name: '特级悟性丹', url: 'https://pic.imgdb.cn/item/665de3fd5e6d1bfa05564912.png', price: getRandomInt(388, 788) }
    ];

    // 包裹的生成逻辑
    if (Math.random() < 0.8) { // 80%概率生成包裹
        const item = commonItems[Math.floor(Math.random() * commonItems.length)];
        const quantity = getRandomInt(51, 100);
        item.name += ` 包裹 (${quantity})`;
        item.price *= quantity;
        item.url = 'https://pic.imgdb.cn/item/6656a1b6d9c307b7e9baa881.png';
        return item;
    }

    return commonItems[Math.floor(Math.random() * commonItems.length)];
}

function getRandomRareItem() {
    // 定义初始稀有物品数组
    const rareItems = [
        { name: '灵异金丹', url: 'https://pic.imgdb.cn/item/66556068d9c307b7e9681672.png', price: getRandomInt(1288, 2988) }
    ];

    // 定义空数组用于存储SS级技能和S级技能
    const ssSkills = [];
    const sSkills = [];

    // 遍历所有宠物，查找SS级技能
    for (let petKey in pets) {
        let pet = pets[petKey];
        pet.skills.forEach(skill => {
            if (skill.rarity === 'SS') {
                ssSkills.push({
                    name: `${pet.name}·${skill.name}`,
                    url: 'https://pic.imgdb.cn/item/665af22fd9c307b7e910c815.png',
                    price: getRandomInt(2688, 5988)
                });
            }
        });
    }

    // 遍历所有宠物，查找S级技能
    for (let petKey in pets) {
        let pet = pets[petKey];
        pet.skills.forEach(skill => {
            if (skill.rarity === 'S') {
                sSkills.push({
                    name: `${pet.name}·${skill.name}`,
                    url: 'https://pic.imgdb.cn/item/665566e5d9c307b7e971236e.png',
                    price: getRandomInt(1288, 2988)
                });
            }
        });
    }

    // 如果有SS级技能，将其添加到rareItems数组中
    if (ssSkills.length > 0) {
        rareItems.push(...ssSkills);
    }

    // 如果有S级技能，将其添加到rareItems数组中
    if (sSkills.length > 0) {
        rareItems.push(...sSkills);
    }

    // 包裹的生成逻辑，不生成天赋道具的包裹
    if (Math.random() < 0.2 && rareItems.length > 1) { // 20%概率生成包裹，且排除天赋道具
        const nonSkillItems = rareItems.filter(item => !item.name.includes('·')); // 过滤掉包含技能的物品
        if (nonSkillItems.length > 0) {
            const item = nonSkillItems[Math.floor(Math.random() * nonSkillItems.length)]; // 随机选择一个非技能物品
            const quantity = getRandomInt(2, 3); // 生成一个2到3之间的随机数量
            item.name += ` 包裹 (${quantity})`; // 更新物品名称
            item.price *= quantity; // 更新物品价格
            item.url = 'https://pic.imgdb.cn/item/6656a1b6d9c307b7e9baa85b.png'; // 更新物品图片URL
            return item; // 返回生成的包裹物品
        }
    }

    // 随机选择一个稀有物品并返回
    return rareItems[Math.floor(Math.random() * rareItems.length)];
}

function buyItem() {
    const selectedItem = document.querySelector('.shop-item.selected');
    if (!selectedItem) {
        alert("请选择一个商品进行购买！");
        return;
    }

    const price = parseInt(selectedItem.dataset.price, 10);
    const itemName = selectedItem.dataset.name;

    if (goldAmount < price) {
        alert("金子不够，购买失败！");
        return;
    }

    // 处理包裹类型物品
    if (itemName.includes('包裹')) {
        const [itemBaseName, quantityStr] = itemName.split(' 包裹 (');
        const itemQuantity = parseInt(quantityStr.replace(')', ''), 10);

        switch (itemBaseName) {
            case '高级悟性丹':
                highGradePill += itemQuantity;
                break;
            case '万化灵丹':
                transmutationPill += itemQuantity;
                break;
            case '冰魄还童丹':
                bingpoRebornPill += itemQuantity;
                break;
            case '神兽还童丹':
                rebornPill += itemQuantity;
                break;
            case '资质重生丹':
                qualityPill += itemQuantity;
                break;
            case '灵异金丹':
                miraculousPill += itemQuantity;
                break;
            case '特级悟性丹':
                for (let i = 0; i < itemQuantity; i++) {
                    addItemToJinnang('tejiWisdomPill');
                }
                break;
            case '精灵精炼石':
                for (let i = 0; i < itemQuantity; i++) {
                    addItemToJinnang('spiritRefreshStone');
                }
                break;
            case '精灵觉醒石':
                for (let i = 0; i < itemQuantity; i++) {
                    addItemToJinnang('spiritAwakenStone');
                }
                break;
            case '还童金丹':
                goldenRebornPill += itemQuantity;
                break;
            default:
                alert("未知包裹类型，购买失败！");
                return;
        }
        updateTopBarItems(); // 更新顶部bar道具数量
        updateJinnangItems(); // 更新锦囊内的道具数量显示
    } else {
        // 处理非包裹类型物品
        const [petName, skillName] = itemName.split('·');
        if (skillName) {
            // 检查技能数量上限
            const skillsArea = document.getElementById('skills-area');
            if (skillsArea.children.length >= 12) {
                alert("您的宠物已经达到技能上限，无法购买！");
                return;
            }

            if (petName !== currentPet.name) {
                alert("您的当前宠物不会此技能，购买失败！");
                return;
            }

            if (document.getElementById('skills-area').innerText.includes(skillName)) {
                alert("您的当前宠物已经拥有此技能，购买失败！");
                return;
            }

            const skill = currentPet.skills.find(skill => skill.name === skillName);
            if (skill) {
                const skillDiv = document.createElement("div");
                skillDiv.innerText = `${skill.name} (${skill.rarity})`;
                skillDiv.onclick = () => {
                    document.getElementById("description-box").innerText = skill.description;
                };
                skillDiv.classList.add(skill.rarity.toLowerCase() + '-skill');
                document.getElementById("skills-area").appendChild(skillDiv);

                const currentSkills = Array.from(document.querySelectorAll("#skills-area div"))
                    .map(div => {
                        const [name, rarity] = div.innerText.split(" (");
                        return { name, rarity: rarity.replace(")", "") };
                    });
                updateSkillScore(currentSkills);
            }
        } else {
            switch (itemName) {
                case '高级悟性丹':
                    highGradePill++;
                    break;
                case '万化灵丹':
                    transmutationPill++;
                    break;
                case '冰魄还童丹':
                    bingpoRebornPill++;
                    break;
                case '神兽还童丹':
                    rebornPill++;
                    break;
                case '资质重生丹':
                    qualityPill++;
                    break;
                case '灵异金丹':
                    miraculousPill++;
                    break;
                case '特级悟性丹':
                    addItemToJinnang('tejiWisdomPill'); // 更新锦囊
                    break;
                case '精灵精炼石':
                    addItemToJinnang('spiritRefreshStone'); // 更新锦囊
                    break;
                case '精灵觉醒石':
                    addItemToJinnang('spiritAwakenStone'); // 更新锦囊
                    break;
                case '还童金丹':
                    goldenRebornPill++;
                    break;
                default:
                    alert("未知道具类型，购买失败！");
                    return;
            }
            updateTopBarItems();
            updateJinnangItems(); // 更新锦囊内的道具数量显示
        }
    }

    // 扣除金子并更新显示
    goldAmount -= price;
    document.getElementById("gold-amount").innerText = goldAmount;
    selectedItem.remove();
}

// 初始化商店和倒计时
document.addEventListener('DOMContentLoaded', initShop);

function sellPet() {
    const skillScoreElement = document.getElementById("skill-score");
    const skillScore = parseInt(skillScoreElement.innerText, 10); // 获取宠物的技能分数并转换为整数
    
    // 检查宠物当前分数是否低于10000分
    if (skillScore < 10000) {
        alert("宠物当前分数低于10000分，无法出售！"); // 提示分数低于10000分，无法出售
        return; // 退出函数
    }

    // 计算出售价格
    const sellPrice = Math.floor(skillScore / 25); // 出售价格为技能分数除以25的整数部分

    // 确认出售
    if (confirm(`当您出售宠物后，您的宠物数值将复位。宠物价格与其评分有关，目前您的宠物价值${sellPrice}金子，请问是否出售？`)) {
        goldAmount += sellPrice; // 增加用户的金子数量
        document.getElementById("gold-amount").innerText = goldAmount; // 更新显示的金子数量
        updateQualityCard(); // 更新资质卡片
        updateAttributePanel(); // 更新属性面板
        updateTopBarItems(); // 确保顶栏道具数量更新
        resetPet(); // 重置宠物的数值
    }
}


let currentPetKey = pets.yanzhi;
let currentPet = currentPetKey;;

function changePet() {
    const selectedPetKey = document.getElementById("pet-select").value; // 获取选择的宠物键
    if (currentPetKey === selectedPetKey) return; // 如果选择的宠物是当前宠物，不进行切换

    currentPetKey = selectedPetKey;
    currentPet = pets[selectedPetKey]; // 将当前宠物设为选择的宠物

    document.getElementById("pet-name").innerText = currentPet.name; // 更新宠物名称显示
    document.getElementById("pet-image").src = currentPet.image; // 更新宠物图片显示
    document.getElementById("description-box").innerText = `您将当前宠物更换为：${currentPet.name} `;
    resetPet(); // 重置宠物的数值
}


function resetPet() {
    // 重置宠物资质和属性
    currentPet.qualities.tier = '普通';
    currentPet.qualities.growthRate = 100;
    currentPet.qualities.mutated = false;

    // 重置当前属性值为最小值
    currentPet.qualities.endurance.current = currentPet.qualities.endurance.min;
    currentPet.qualities.strength.current = currentPet.qualities.strength.min;
    currentPet.qualities.faith.current = currentPet.qualities.faith.min;
    currentPet.qualities.agility.current = currentPet.qualities.agility.min;
    currentPet.qualities.intelligence.current = currentPet.qualities.intelligence.min;

    // 初始化等级和其他基础属性
    petLevel = 1;
    evolutionLevel = 0;
    growthRate = 1;
    remainingPoints = 0;
    trainingCount = 0;
    currentWisdom = 0;
    petAscended = false;
    petMaxLevel = 149;
    petWisdom = currentWisdom;
    awakened = false;
    hallucinated = false;
    hallucinationLevel = 0;
    experienceTreasureOpenCount = 0;
    battleRounds = 0; // 记录玩家胜利的轮次
    currentExp = 0; // 当前经验值
    maxExp = 208; // 经验值上限
    spiritLevel = 1;
    spiritMultiplier = 1.00;
    bonusAttributes = {
    endurance: 0,
    intelligence: 0,
    strength: 0,
    agility: 0,
    faith: 0
    };
    document.body.style.backgroundImage = "";


    // 重置基础属性为初始值，调用calculateAttribute
    baseAttributes = {
        endurance: calculateAttribute(currentPet.qualities.endurance.min, currentPet.qualities.growthRate / 100, petLevel, 0, false),
        intelligence: calculateAttribute(currentPet.qualities.intelligence.min, currentPet.qualities.growthRate / 100, petLevel, 0, false),
        strength: calculateAttribute(currentPet.qualities.strength.min, currentPet.qualities.growthRate / 100, petLevel, 0, false),
        agility: calculateAttribute(currentPet.qualities.agility.min, currentPet.qualities.growthRate / 100, petLevel, 0, false),
        faith: calculateAttribute(currentPet.qualities.faith.min, currentPet.qualities.growthRate / 100, petLevel, 0, false)
    };

    // 更新显示的资质和属性值
    setInnerText("tier", currentPet.qualities.tier);
    setInnerText("growth-rate", currentPet.qualities.growthRate);
    setInnerText("mutated", currentPet.qualities.mutated ? "是" : "否");
    setInnerText("endurance-current", currentPet.qualities.endurance.current);
    setInnerText("strength-current", currentPet.qualities.strength.current);
    setInnerText("faith-current", currentPet.qualities.faith.current);
    setInnerText("agility-current", currentPet.qualities.agility.current);
    setInnerText("intelligence-current", currentPet.qualities.intelligence.current);

    // 初始化评分
    skillScore = 0;
    setInnerText("skill-score", skillScore);

    // 清空技能区域
    const skillsArea = document.getElementById("skills-area");
    if (skillsArea) {
        skillsArea.innerHTML = "";
    }

    // 更新显示的各项数值
    setInnerText("current-wisdom", 0);
    setInnerText("train-count", 0);
    setInnerText("attribute-endurance", baseAttributes.endurance);
    setInnerText("attribute-intelligence", baseAttributes.intelligence);
    setInnerText("attribute-strength", baseAttributes.strength);
    setInnerText("attribute-agility", baseAttributes.agility);
    setInnerText("attribute-faith", baseAttributes.faith);
    setInnerText("pet-level", petLevel);
    setInnerText("evolution-level", evolutionLevel);

    // 确保属性面板在所有属性重置和计算后更新
    updateQualityCard();
    updateAttributePanel();
    updateTopBarItems();
    initializeEnemyPet();
}

function setInnerText(id, value) {
    const element = document.getElementById(id);
    if (element) {
        element.innerText = value;
    } else {
        console.warn(`元素ID为 ${id} 的元素未找到。`);
    }
}

function toggleDrawer() {
    const drawer = document.getElementById('quality-drawer');
    const info = document.getElementById('quality-info');
    drawer.classList.toggle('open');
    info.classList.toggle('open');
}

function checkDrawerOpen() {
    const drawer = document.getElementById('quality-drawer');
    if (!drawer.classList.contains('open')) {
        const messageBox = document.createElement('div');
        messageBox.style = "padding: 20px; background: white; border: 1px solid black; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;";
        messageBox.innerHTML = `<p>请先打开资质面板！</p>
                                <button onclick="document.body.removeChild(this.parentNode)">关闭</button>`;
        document.body.appendChild(messageBox);
        return false;
    }
    return true;
}

function upgradeWisdom() {
    let successRate;

    if (currentWisdom < 20) {
        if (highGradePill < 1) {
            alert("您的高级悟性丹已耗尽！");
            return;
        }

        highGradePill--;
        document.getElementById("high-grade-pill").innerText = highGradePill;

        if (currentWisdom < 7) successRate = 0.9;
        else if (currentWisdom < 13) successRate = 0.75;
        else if (currentWisdom < 18) successRate = 0.45;
        else successRate = 0.15;

        if (Math.random() < successRate) {
            currentWisdom = Math.min(currentWisdom + 1, 20);
        } else {
            if (currentWisdom > 0) {
                if (currentWisdom < 8) currentWisdom = Math.max(0, currentWisdom - 2);
                else if (currentWisdom < 13) currentWisdom = Math.max(8, currentWisdom - 2);
                else if (currentWisdom < 18) currentWisdom = Math.max(13, currentWisdom - 2);
                else currentWisdom = Math.max(15, currentWisdom - 2);
            }
        }
    } else {
        if (!awakened) {
            alert("您的宠物悟性已到上限！");
            return;
        }

        const tejiWisdomPillItem = jinnangItems.find(i => i.name === 'tejiWisdomPill');

        if (!tejiWisdomPillItem || tejiWisdomPillItem.quantity < 1) {
            alert("您的特级悟性丹已耗尽！");
            return;
        }

        tejiWisdomPillItem.quantity--;
        updateJinnangItems();

        if (currentWisdom == 20) successRate = 0.85;
        else if (currentWisdom == 21) successRate = 0.65;
        else if (currentWisdom == 22) successRate = 0.45;
        else if (currentWisdom == 23) successRate = 0.25;
        else successRate = 0.05;

        if (Math.random() < successRate) {
            currentWisdom = Math.min(currentWisdom + 1, 25);
        } else {
            currentWisdom = Math.max(20, currentWisdom - 2);
        }
    }

    document.getElementById("current-wisdom").innerText = currentWisdom;
    document.getElementById("attribute-wisdom").value = currentWisdom; // 更新输入框的值

    updateAttributePanel(); // 更新属性面板
}


function trainSkills() {
    if (transmutationPill < 1) {
        alert("您的道具不够，请刷新后重试！");
        return;
    }

    transmutationPill--;
    document.getElementById("transmutation-pill").innerText = transmutationPill;
    trainCount++;
    document.getElementById("train-count").innerText = trainCount;

    let skillNum;
    if (currentWisdom < 13) {
        skillNum = Math.min(getRandomSkillNum([0.80, 0.05, 0.05, 0.02, 0.02, 0.02]), 5);
    } else if (currentWisdom < 17) {
        skillNum = Math.min(getRandomSkillNum([0.80, 0.05, 0.05, 0.02, 0.02, 0.02]), 6);
    } else if (currentWisdom < 19) {
        skillNum = Math.min(getRandomSkillNum([0.80, 0.05, 0.05, 0.02, 0.02, 0.02]), 7);
    } else if (currentWisdom < 20) {
        skillNum = Math.min(getRandomSkillNum([0.80, 0.05, 0.05, 0.02, 0.02, 0.02]), 8);
    } else {
        skillNum = Math.max(5, getRandomSkillNum([0.80, 0.05, 0.05, 0.02, 0.02, 0.02, 0.01, 0.01, 0.008, 0.002]));
    }

    const selectedSkills = [];
    for (let i = 0; i < skillNum; i++) {
        let skill;
        do {
            const rarityRoll = Math.random() * 100;
            if (currentWisdom < 7) {
                if (rarityRoll < 80) skill = currentPet.skills.filter(s => s.rarity === 'B')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'B').length)];
                else skill = currentPet.skills.filter(s => s.rarity === 'A')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'A').length)];
            } else if (currentWisdom < 13) {
                if (rarityRoll < 80) skill = currentPet.skills.filter(s => s.rarity === 'B')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'B').length)];
                else if (rarityRoll < 95) skill = currentPet.skills.filter(s => s.rarity === 'A')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'A').length)];
                else skill = currentPet.skills.filter(s => s.rarity === 'S')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'S').length)];
            } else if (currentWisdom < 17) {
                if (rarityRoll < 80) skill = currentPet.skills.filter(s => s.rarity === 'B')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'B').length)];
                else if (rarityRoll < 95) skill = currentPet.skills.filter(s => s.rarity === 'A')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'A').length)];
                else if (rarityRoll < 97.5) skill = currentPet.skills.filter(s => s.rarity === 'S')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'S').length)];
                else skill = currentPet.skills.filter(s => s.rarity === 'SS')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'SS').length)];
            } else if (currentWisdom < 20) {
                if (rarityRoll < 80) skill = currentPet.skills.filter(s => s.rarity === 'B')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'B').length)];
                else if (rarityRoll < 95) skill = currentPet.skills.filter(s => s.rarity === 'A')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'A').length)];
                else if (rarityRoll < 97.5) skill = currentPet.skills.filter(s => s.rarity === 'S')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'S').length)];
                else skill = currentPet.skills.filter(s => s.rarity === 'SS')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'SS').length)];
            } else {
                if (rarityRoll < 80) skill = currentPet.skills.filter(s => s.rarity === 'B')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'B').length)];
                else if (rarityRoll < 95) skill = currentPet.skills.filter(s => s.rarity === 'A')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'A').length)];
                else if (rarityRoll < 97.5) skill = currentPet.skills.filter(s => s.rarity === 'S')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'S').length)];
                else skill = currentPet.skills.filter(s => s.rarity === 'SS')[Math.floor(Math.random() * currentPet.skills.filter(s => s.rarity === 'SS').length)];
            }
        } while (!skill || selectedSkills.includes(skill));
        selectedSkills.push(skill);
    }

    if (selectedSkills.length >= 8) {
        if (!confirm("你把技能洗爆了，点击确定查看！")) {
            return;
        }
    }

    updateSkillsArea(selectedSkills);
    updateSkillScore(selectedSkills);
}

function getRandomSkillNum(probabilities) {
    const total = probabilities.reduce((sum, prob) => sum + prob, 0);
    let rand = Math.random() * total;
    for (let i = 0; i < probabilities.length; i++) {
        if (rand < probabilities[i]) {
            return i + 1;
        }
        rand -= probabilities[i];
    }
    return 1;
}

function updateSkillsArea(selectedSkills) {
    const skillsArea = document.getElementById("skills-area");
    const existingSkills = Array.from(skillsArea.children).map(skillDiv => skillDiv.innerText.split(' ')[0]);
    skillsArea.innerHTML = "";
    selectedSkills.forEach(skill => {
        if (!existingSkills.includes(skill.name)) {
            const skillDiv = document.createElement("div");
            skillDiv.innerText = `${skill.name} (${skill.rarity})`;
            skillDiv.onclick = () => {
                deleteSkill(skill, skillDiv, skillsArea);
            };
            if (skill.rarity === 'S') {
                skillDiv.classList.add('s-skill');
            } else if (skill.rarity === 'SS') {
                skillDiv.classList.add('ss-skill');
            }
            skillsArea.appendChild(skillDiv);
        }
    });
}

function deleteSkill(skill, skillDiv, skillsArea) {
    const messageBox = document.createElement('div');
    messageBox.style = "padding: 5px; font-size: 14px; border-radius: 10px; background: rgb(255 255 255 / 90%); border: 1px solid black; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;";
    messageBox.innerHTML = `
        <p>描述：${skill.description}</p>
        <p>是否删除？</p>
        <button id="confirm-delete">删除</button>
        <button onclick="document.body.removeChild(this.parentNode)">取消</button>
    `;

    document.body.appendChild(messageBox);

    document.getElementById("confirm-delete").onclick = () => {
        skillsArea.removeChild(skillDiv);
        document.body.removeChild(messageBox);

        // 获取当前技能列表并更新评分
        const remainingSkills = Array.from(skillsArea.children).map(div => {
            const [name, rarity] = div.innerText.split(' (');
            return { name, rarity: rarity.replace(')', '') };
        });
        updateSkillScore(remainingSkills);
    };

}

function updateSkillScore(selectedSkills = []) {
    // 计算资质评分
    const petQualities = currentPet.qualities;
    const growthRate = petQualities.growthRate;
    const endurance = petQualities.endurance.current;
    const strength = petQualities.strength.current;
    const faith = petQualities.faith.current;
    const agility = petQualities.agility.current;
    const intelligence = petQualities.intelligence.current;

    const qualityScore = Math.floor((endurance + strength + faith + agility + intelligence) * (growthRate / 100) / 100);

    // 计算属性评分
    const enduranceAttr = parseInt(document.getElementById("attribute-endurance").innerText);
    const intelligenceAttr = parseInt(document.getElementById("attribute-intelligence").innerText);
    const strengthAttr = parseInt(document.getElementById("attribute-strength").innerText);
    const agilityAttr = parseInt(document.getElementById("attribute-agility").innerText);
    const faithAttr = parseInt(document.getElementById("attribute-faith").innerText);

    const attributeScore = enduranceAttr * 28 + intelligenceAttr * 15 + strengthAttr * 8 + agilityAttr * 41 + faithAttr * 48;

    // 计算二级属性评分
    const health = parseInt(document.getElementById("secondary-health").innerText);
    const mana = parseInt(document.getElementById("secondary-mana").innerText);
    const physicalAttack = parseInt(document.getElementById("secondary-physical-attack").innerText);
    const physicalDefense = parseInt(document.getElementById("secondary-physical-defense").innerText);
    const magicAttack = parseInt(document.getElementById("secondary-magic-attack").innerText);
    const magicDefense = parseInt(document.getElementById("secondary-magic-defense").innerText);
    const speed = parseInt(document.getElementById("secondary-speed").innerText);

    const secondaryAttributeScore = (health + mana + physicalAttack + physicalDefense + magicAttack + magicDefense + speed) * 2;

    // 计算技能评分
    let skillScore = 0;
    let aSkillCount = 0;
    let sSkillCount = 0;
    let ssSkillCount = 0;

    selectedSkills.forEach(skill => {
        switch (skill.rarity) {
            case 'B':
                skillScore += 200;
                break;
            case 'A':
                skillScore += 1000;
                aSkillCount++;
                break;
            case 'S':
                skillScore += 6000;
                sSkillCount++;
                break;
            case 'SS':
                skillScore += 10000;
                ssSkillCount++;
                break;
        }
    });

    if (aSkillCount > 1) skillScore += 1000;
    if (sSkillCount > 1) skillScore += 10000;
    if (ssSkillCount > 1) skillScore += 50000;

    // 计算总评分
    const totalScore = qualityScore + attributeScore + skillScore + secondaryAttributeScore;
    // 获取具有 ID "skill-score" 的元素
    const skillScoreElement = document.getElementById("skill-score");
    // 设置该元素的文本内容为 totalScore
    skillScoreElement.innerText = totalScore;
    // 添加 .text 类以应用红色样式
    skillScoreElement.classList.add("gold-text");
}

function upgradeWisdomTo() {
    const target = prompt(`你期待将宠物悟性提升至__ (请输入1-${awakened ? 25 : 20}之间的整数。当宠物觉醒后，你可以使用该功能尝试将宠物悟性一键提升至最高25。):`);
    if (target === null) return;

    if (target === "11111") {
        transmutationPill += 999;
        rebornPill += 999;
        bingpoRebornPill += 999;
        goldenRebornPill += 999;
        miraculousPill += 999;
        qualityPill += 999;
        highGradePill += 9999;
        goldAmount += 999999;
        document.getElementById("gold-amount").innerText = goldAmount;
        document.getElementById("quality-pill").innerText = qualityPill;
        document.getElementById("high-grade-pill").innerText = highGradePill;
        document.getElementById("miraculous-pill").innerText = miraculousPill;
        document.getElementById("golden-reborn-pill").innerText = goldenRebornPill;
        document.getElementById("bingpo-reborn-pill").innerText = bingpoRebornPill;
        document.getElementById("transmutation-pill").innerText = transmutationPill;
        document.getElementById("reborn-pill").innerText = rebornPill;

        const itemsToIncrease = [
            'normalExperienceBook',
            'advancedExperienceBook',
            'ascensionStone',
            'supremeWisdomPill',
            'awakenPill', // 醒悟丹
            'coagulateStone', // 凝魄石
            'seperateStone', // 离魂石
            'tejiWisdomPill',
            'radiantSoul',
            'spiritRefreshStone',
            'spiritAwakenStone',
            'shakingSoul',
            'glowingSoul',
            'activeSoul',
            'jumpingSoul'
        ];
    
        for (const item of itemsToIncrease) {
            for (let i = 0; i < 999; i++) {
                addItemToJinnang(item);
            }
        }
    
        updateJinnangItems();
        document.getElementById("description-box").innerText = "您获得了超绝白金VIP礼包！";
        return;
    }

    if (target === "88888") {
        goldAmount += 999999;
        document.getElementById("gold-amount").innerText = goldAmount;
        document.getElementById("description-box").innerText = "您获得了一大袋金子！";
        return;
    }
    
    const targetValue = parseInt(target, 10);
    if (isNaN(targetValue) || targetValue < 1 || targetValue > (awakened ? 25 : 20)) {
        alert(`无效输入，请输入1到${awakened ? 25 : 20}之间的数字`);
        return;
    }

    // 若输入的为整数
    const targetInt = parseInt(target, 10);
    if (!isNaN(targetInt) && targetInt >= 1 && targetInt <= (awakened ? 25 : 20)) {
        const initialWisdom = currentWisdom;
        let usedPills = 0;

        while (currentWisdom < targetInt && (highGradePill > 0 || (awakened && currentWisdom >= 20 && tejiWisdomPillItem))) {
            let successRate;
            if (currentWisdom < 20) {
                if (highGradePill < 1) {
                    alert("您的悟性丹已耗尽！");
                    break;
                }
                highGradePill--;
                usedPills++;
                document.getElementById("high-grade-pill").innerText = highGradePill;

                if (currentWisdom < 7) successRate = 0.9;
                else if (currentWisdom < 13) successRate = 0.75;
                else if (currentWisdom < 18) successRate = 0.45;
                else successRate = 0.15;

                if (Math.random() < successRate) {
                    currentWisdom = Math.min(currentWisdom + 1, 20);
                } else {
                    if (currentWisdom > 0) {
                        if (currentWisdom < 8) currentWisdom = Math.max(0, currentWisdom - 2);
                        else if (currentWisdom < 13) currentWisdom = Math.max(8, currentWisdom - 2);
                        else if (currentWisdom < 18) currentWisdom = Math.max(13, currentWisdom - 2);
                        else currentWisdom = Math.max(15, currentWisdom - 2);
                    }
                }
            } else if (awakened && currentWisdom >= 20) {
                const tejiWisdomPillItem = jinnangItems.find(i => i.name === 'tejiWisdomPill');
                if (!tejiWisdomPillItem || tejiWisdomPillItem.quantity < 1) {
                    alert("您的悟性丹已耗尽！");
                    break;
                }

                tejiWisdomPillItem.quantity--;
                updateJinnangItems();

                if (currentWisdom == 20) successRate = 0.85;
                else if (currentWisdom == 21) successRate = 0.65;
                else if (currentWisdom == 22) successRate = 0.45;
                else if (currentWisdom == 23) successRate = 0.25;
                else successRate = 0.05;

                if (Math.random() < successRate) {
                    currentWisdom = Math.min(currentWisdom + 1, 25);
                } else {
                    currentWisdom = Math.max(20, currentWisdom - 2);
                }
            }

            document.getElementById("current-wisdom").innerText = currentWisdom;
        }

        document.getElementById("description-box").innerText = `您消耗了${usedPills}颗悟性丹，将悟性提升至${currentWisdom}`;
        updateAttributePanel(); // 更新属性面板
    } else {
        alert(`请输入1到${awakened ? 25 : 20}之间的整数！`);
    }
}

        
let awakened = false; // 复位觉醒状态

let bonusAttributes = {
    endurance: 0,
    intelligence: 0,
    strength: 0,
    agility: 0,
    faith: 0
};

let baseAttributes = {
    endurance: 5,
    intelligence: 6,
    strength: 2,
    agility: 3,
    faith: 2
};

function calculateAttribute(currentValue, growthRate, level) {
    return Math.floor((currentValue / 2000) * growthRate * 4 * level);
}

function calculateAwakenedAttributes(currentValue, growthRate, level, baseLevel) {
    const awakenedLevels = level - baseLevel;
    return calculateAttribute(currentValue, growthRate, awakenedLevels);
}

function calculatePreAwakenedAttributes(currentValue, growthRate, level) {
    return calculateAttribute(currentValue, growthRate, level);
}

function calculateBonusAttributes(attribute, bonus) {
    return attribute + Math.floor(attribute * bonus);
}

function calculateTotalAttributes(currentValue, growthRate, level, baseLevel, isAwakened) {
    const baseAttribute = isAwakened ?
        calculateAwakenedAttributes(currentValue, growthRate, level, baseLevel) :
        calculatePreAwakenedAttributes(currentValue, growthRate, level);

    return baseAttribute;
}

function updateAttributePanel() {
    const pet = currentPet;
    const qualities = pet.qualities;
    const { growthRateDisplay, growthRate } = calculateGrowthRateDisplayAndValue(qualities);

    const currentAttributes = calculateCurrentAttributes();

    const totalAttributes = {
        endurance: currentAttributes.endurance,
        intelligence: currentAttributes.intelligence,
        strength: currentAttributes.strength,
        agility: currentAttributes.agility,
        faith: currentAttributes.faith
    };

    console.log("Total Attributes:", totalAttributes);

    document.getElementById("attribute-tier").innerText = qualities.tier;
    document.getElementById("attribute-growth-rate").innerText = growthRateDisplay;
    document.getElementById("attribute-wisdom").innerText = currentWisdom;

    updatePrimaryAttributes(totalAttributes);
    updateSecondaryAttributes(totalAttributes, currentWisdom);
    updateSkillScore(Array.from(document.querySelectorAll("#skills-area div")).map(div => {
        const [name, rarity] = div.innerText.split(" (");
        return { name, rarity: rarity.replace(")", "") };
    }));

    // 更新总属性显示
    document.getElementById("attribute-endurance").innerText = totalAttributes.endurance;
    document.getElementById("attribute-intelligence").innerText = totalAttributes.intelligence;
    document.getElementById("attribute-strength").innerText = totalAttributes.strength;
    document.getElementById("attribute-agility").innerText = totalAttributes.agility;
    document.getElementById("attribute-faith").innerText = totalAttributes.faith;

    updateRemainingPointsDisplay();
}
    function updatePrimaryAttributes(totalAttributes) {
        document.getElementById("attribute-endurance").innerText = Math.round(totalAttributes.endurance);
        document.getElementById("attribute-intelligence").innerText = Math.round(totalAttributes.intelligence);
        document.getElementById("attribute-strength").innerText = Math.round(totalAttributes.strength);
        document.getElementById("attribute-agility").innerText = Math.round(totalAttributes.agility);
        document.getElementById("attribute-faith").innerText = Math.round(totalAttributes.faith);
    }
    
    function updateSecondaryAttributes(totalAttributes, currentWisdom) {
        const secondaryAttributes = calculateSecondaryAttributes(totalAttributes, currentWisdom);
        let wisdomBonus;
    
        if (currentWisdom <= 12) {
            wisdomBonus = currentWisdom * 0.5;
        } else if (currentWisdom <= 20) {
            wisdomBonus = 6 + (currentWisdom - 12) * 1;
        } else {
            switch (currentWisdom) {
                case 21:
                    wisdomBonus = 20;
                    break;
                case 22:
                    wisdomBonus = 21;
                    break;
                case 23:
                    wisdomBonus = 22;
                    break;
                case 24:
                    wisdomBonus = 23;
                    break;
                case 25:
                    wisdomBonus = 25;
                    break;
                default:
                    wisdomBonus = 0;
            }
        }
    
        document.getElementById("secondary-health").innerText = secondaryAttributes.health;
        const healthBonusElement = document.getElementById("secondary-health-bonus");
        healthBonusElement.innerText = `+${wisdomBonus}%`;
        healthBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-mana").innerText = secondaryAttributes.mana;
        const manaBonusElement = document.getElementById("secondary-mana-bonus");
        manaBonusElement.innerText = `+${wisdomBonus}%`;
        manaBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-physical-attack").innerText = secondaryAttributes.physicalAttack;
        const physicalAttackBonusElement = document.getElementById("secondary-physical-attack-bonus");
        physicalAttackBonusElement.innerText = `+${wisdomBonus}%`;
        physicalAttackBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-physical-defense").innerText = secondaryAttributes.physicalDefense;
        const physicalDefenseBonusElement = document.getElementById("secondary-physical-defense-bonus");
        physicalDefenseBonusElement.innerText = `+${wisdomBonus}%`;
        physicalDefenseBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-magic-attack").innerText = secondaryAttributes.magicAttack;
        const magicAttackBonusElement = document.getElementById("secondary-magic-attack-bonus");
        magicAttackBonusElement.innerText = `+${wisdomBonus}%`;
        magicAttackBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-magic-defense").innerText = secondaryAttributes.magicDefense;
        const magicDefenseBonusElement = document.getElementById("secondary-magic-defense-bonus");
        magicDefenseBonusElement.innerText = `+${wisdomBonus}%`;
        magicDefenseBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    
        document.getElementById("secondary-speed").innerText = secondaryAttributes.speed;
        const speedBonusElement = document.getElementById("secondary-speed-bonus");
        speedBonusElement.innerText = `+${wisdomBonus}%`;
        speedBonusElement.classList.toggle("red-text", wisdomBonus > 0);
    }
function calculateGrowthRateDisplayAndValue(qualities) {
    let growthRateDisplay;
    let growthRate;

    if (awakened) {
        growthRate = 400 + hallucinationLevel * 5;
        growthRateDisplay = `${growthRate}%`;
        growthRate = growthRate / 100;
    } else {
        growthRate = qualities.growthRate / 100;
        growthRateDisplay = `${Math.round(growthRate * 100)}%`;
    }

    console.log("Growth Rate:", growthRate);
    console.log("Growth Rate Display:", growthRateDisplay);

    return { growthRateDisplay, growthRate };
}
        
function calculateCurrentAttributes() {
    const qualities = currentPet.qualities;
    const { growthRate } = calculateGrowthRateDisplayAndValue(qualities);
    const baseLevel = awakened ? qualities.baseLevel : 0;

    const attributes = {
        endurance: calculateTotalAttributes(qualities.endurance.current, growthRate, petLevel, baseLevel, awakened) + bonusAttributes.endurance,
        intelligence: calculateTotalAttributes(qualities.intelligence.current, growthRate, petLevel, baseLevel, awakened) + bonusAttributes.intelligence,
        strength: calculateTotalAttributes(qualities.strength.current, growthRate, petLevel, baseLevel, awakened) + bonusAttributes.strength,
        agility: calculateTotalAttributes(qualities.agility.current, growthRate, petLevel, baseLevel, awakened) + bonusAttributes.agility,
        faith: calculateTotalAttributes(qualities.faith.current, growthRate, petLevel, baseLevel, awakened) + bonusAttributes.faith
    };

    console.log("Current Attributes:", attributes);
    console.log("Bonus Attributes:", bonusAttributes);

    return attributes;
}

let remainingPoints = 0;
const allocationHistory = [];
        
function updateRemainingPointsDisplay() {
    document.getElementById("remaining-points-display").innerText = `剩余点数: ${remainingPoints}`;
    console.log(`Remaining Points Display Updated: ${remainingPoints}`);
}    
        
function increaseBonusAttribute(attribute) {
    if (remainingPoints <= 0) {
        alert("您的宠物没有可分配点数了！");
        return;
    }

    bonusAttributes[attribute] += 1;
    remainingPoints -= 1;
    allocationHistory.push({ attribute, value: 1 });
    updateAttributePanel();
    updateRemainingPointsDisplay();

    console.log(`Increase Bonus Attribute: ${attribute} = ${bonusAttributes[attribute]}, Remaining Points = ${remainingPoints}`);
}

// 动态修改额外属性的函数
function addBonusAttribute(attribute, value) {
    if (bonusAttributes.hasOwnProperty(attribute)) {
        bonusAttributes[attribute] += value;
    }
}

function removeBonusAttribute(attribute, value) {
    if (bonusAttributes.hasOwnProperty(attribute)) {
        bonusAttributes[attribute] -= value;
        if (bonusAttributes[attribute] < 0) {
            bonusAttributes[attribute] = 0;
        }
    }
}
        
function awakenPet() {
    if (awakened) {
        alert("您的宠物已经觉醒，无法再次觉醒！");
        return;
    }

    const awakenPillItem = jinnangItems.find(i => i.name === 'awakenPill');
    if (!awakenPillItem || awakenPillItem.quantity < 1) {
        alert("必要道具：醒悟丹 数量不足！");
        return;
    }

    const confirmation = confirm("觉醒需要消耗一个珍贵道具“醒悟丹”。宠物觉醒后成长率、当前属性会得到极大提升，悟性上限开放至25，等级开放至160，同时开启幻化能力。觉醒后的宠物还能控制并培养战斗精灵，在战斗时得到更强悍的助力！");
    if (!confirmation) {
        return;
    }

    const qualities = currentPet.qualities;
    const { growthRate } = calculateGrowthRateDisplayAndValue(qualities);
    const baseLevel = petLevel;

    const newAttributes = {
        endurance: calculateTotalAttributes(qualities.endurance.current, growthRate, petLevel, baseLevel, false),
        intelligence: calculateTotalAttributes(qualities.intelligence.current, growthRate, petLevel, baseLevel, false),
        strength: calculateTotalAttributes(qualities.strength.current, growthRate, petLevel, baseLevel, false),
        agility: calculateTotalAttributes(qualities.agility.current, growthRate, petLevel, baseLevel, false),
        faith: calculateTotalAttributes(qualities.faith.current, growthRate, petLevel, baseLevel, false)
    };

    // 计算bonusAttributes
    bonusAttributes.endurance += calculateBonusAttributes(newAttributes.endurance, 0.2);
    bonusAttributes.intelligence += calculateBonusAttributes(newAttributes.intelligence, 0.2);
    bonusAttributes.strength += calculateBonusAttributes(newAttributes.strength, 0.2);
    bonusAttributes.agility += calculateBonusAttributes(newAttributes.agility, 0.2);
    bonusAttributes.faith += calculateBonusAttributes(newAttributes.faith, 0.2);

    currentPet.qualities.baseLevel = petLevel;
    currentPet.qualities.tier = '超凡';
    currentPet.qualities.growthRate = 400 + hallucinationLevel * 5;

    awakenPillItem.quantity--;
    updateJinnangItems();

    petMaxLevel = 160;
    awakened = true;

    alert("成功觉醒，宠物的当前属性大幅提升，成长率升为超凡；悟性上限提升至25，等级上限提高至160级！");
    updatePetLevel();
    updateAttributePanel();
    updateQualityCard();
}

let hallucinated = false;
let hallucinationLevel = 0;

function hallucinatePet() {
    if (!awakened) {
        alert("您的宠物尚未觉醒，无法进行幻化提升！");
        return;
    }

    if (!hallucinated) {
        const coagulateStoneItem = jinnangItems.find(i => i.name === 'coagulateStone');
        if (!coagulateStoneItem || coagulateStoneItem.quantity < 1) {
            alert("您的凝魄石不足！");
            return;
        }

        coagulateStoneItem.quantity--;
        updateJinnangItems();

        hallucinated = true;
        hallucinationLevel = 0;

        alert("恭喜大侠，您的宠物获得了幻化能力。幻化等级为1级！");
        updateQualityCard();
        updateAttributePanel(); // 确保更新属性面板
        return;
    }

    if (hallucinationLevel >= 12) {
        alert("您的宠物幻化等级已达上限！");
        return;
    }

    const confirmHallucination = confirm("您的爱宠已经幻化成功，您可以消耗1颗离魂石来提升幻化等级，获得更稳定的资质增长。是否继续？");
    if (!confirmHallucination) {
        return;
    }

    const seperateStoneItem = jinnangItems.find(i => i.name === 'seperateStone');
    if (!seperateStoneItem || seperateStoneItem.quantity < 1) {
        alert("您的离魂石不足！");
        return;
    }

    seperateStoneItem.quantity--;
    updateJinnangItems();

    let successRate;
    if (currentWisdom < 20) {
        successRate = 0.2;
    } else {
        successRate = 0.2 + (currentWisdom - 19) * 0.1;
    }

    if (Math.random() < successRate) {
        hallucinationLevel++;
        alert(`幻化提升成功！当前幻化等级为${hallucinationLevel}级！`);
    } else {
        alert("幻化提升失败！");
    }

    updateQualityCard();
    updateAttributePanel(); // 确保更新属性面板
}

// 更新显示函数
function updateQualityCard() {
    document.getElementById("evolution-level").innerText = evolutionLevel;

    const qualityInfo = document.getElementById("quality-info");
    const tierElement = document.getElementById("quality-tier");
    const growthRateElement = document.getElementById("quality-growth-rate");

    document.getElementById("quality-name").innerText = currentPet.name;
    tierElement.innerText = currentPet.qualities.tier;

    if (awakened) {
        if (hallucinated) {
            const minGrowthRate = 400 + (hallucinationLevel) * 5;
            if (hallucinationLevel >= 12) {
                growthRateElement.innerText = `460%`;
            } else {
                growthRateElement.innerText = `${minGrowthRate}% ~ 460%`;
            }
        } else {
            growthRateElement.innerText = `400% ~ 460%`;
        }
    } else {
        growthRateElement.innerText = `${currentPet.qualities.growthRate}%`;
    }
    document.getElementById("quality-mutated").innerText = currentPet.qualities.mutated ? "变异" : "未变异";

    let color;
    switch (currentPet.qualities.tier) {
        case '优秀':
            color = 'green';
            break;
        case '杰出':
            color = 'blue';
            break;
        case '卓越':
            color = 'purple';
            break;
        case '完美':
            color = 'orange';
            break;
        case '超凡':
            color = 'red';
            break;
        default:
            color = 'black';
    }
    tierElement.style.color = color;
    growthRateElement.style.color = color;

    // 更新各项属性的当前值和最大值，以及进度条
    const endurance = currentPet.qualities.endurance;
    const strength = currentPet.qualities.strength;
    const faith = currentPet.qualities.faith;
    const agility = currentPet.qualities.agility;
    const intelligence = currentPet.qualities.intelligence;

    document.getElementById("endurance-current").innerText = Math.round(endurance.current);
    document.getElementById("endurance-max").innerText = endurance.max;
    document.getElementById("endurance-bar").style.width = (endurance.current / endurance.max * 100) + "%";

    document.getElementById("strength-current").innerText = Math.round(strength.current);
    document.getElementById("strength-max").innerText = strength.max;
    document.getElementById("strength-bar").style.width = (strength.current / strength.max * 100) + "%";

    document.getElementById("faith-current").innerText = Math.round(faith.current);
    document.getElementById("faith-max").innerText = faith.max;
    document.getElementById("faith-bar").style.width = (faith.current / faith.max * 100) + "%";

    document.getElementById("agility-current").innerText = Math.round(agility.current);
    document.getElementById("agility-max").innerText = agility.max;
    document.getElementById("agility-bar").style.width = (agility.current / agility.max * 100) + "%";

    document.getElementById("intelligence-current").innerText = Math.round(intelligence.current);
    document.getElementById("intelligence-max").innerText = intelligence.max;
    document.getElementById("intelligence-bar").style.width = (intelligence.current / intelligence.max * 100) + "%";

    // 更新变异状态的外观效果
    const petImage = document.querySelector('.pet-image img');
    const petInfo = document.querySelector('.bottom-bar .info');
    const bottombar = document.querySelector('.bottom-bar');

    if (currentPet.qualities.mutated) {
        petImage.classList.add('mutated');
        petInfo.classList.add('mutated');
        bottombar.classList.add('mutated');
    } else {
        petImage.classList.remove('mutated');
        petInfo.classList.remove('mutated');
        bottombar.classList.remove('mutated');
    }
}


function useBingpoRebornPill() {
    if (!checkDrawerOpen()) return;
    if (!currentPet || !currentPet.qualities) { // 添加检查
        console.warn("当前宠物未被正确初始化。");
        return;
    }
    if (awakened) {
        alert("您的宠物已经觉醒，无法还童！");
        return;
    }
    if (bingpoRebornPill < 1) {
        alert("您的冰魄还童丹已耗尽！");
        return;
    }

    // 检查并处理变异状态
    if (currentPet.qualities.mutated) {
        if (!confirm("您的宠物已经变异，再次还童会改变其状态，请谨慎操作！")) {
            return;
        }
        // 当宠物失去变异状态时，资质会除以1.1
        const qualities = currentPet.qualities;
        qualities.endurance.current = Math.round(qualities.endurance.current / 1.1);
        qualities.strength.current = Math.round(qualities.strength.current / 1.1);
        qualities.faith.current = Math.round(qualities.faith.current / 1.1);
        qualities.agility.current = Math.round(qualities.agility.current / 1.1);
        qualities.intelligence.current = Math.round(qualities.intelligence.current / 1.1);

        currentPet.qualities.mutated = false;
        // 恢复原背景
        document.body.style.backgroundImage = "";
    }

    // 重置宠物的段位和成长率
    let tier, growthRate;
    const roll = Math.random() * 100;
    if (roll < 50) {
        tier = '普通';
        growthRate = 100;
    } else if (roll < 75) {
        tier = '优秀';
        growthRate = 220;
    } else if (roll < 90) {
        tier = '杰出';
        growthRate = 280;
    } else if (roll < 97.5) {
        tier = '卓越';
        growthRate = 340;
    } else if (roll < 99.95) {
        tier = '完美';
        growthRate = 400;
    } else {
        tier = Math.random() < 0.5 ? '卓越' : '完美';
        growthRate = tier === '卓越' ? getWeightedRandom([300, 320], [0.5, 0.5]) : getWeightedRandom([340, 360, 380, 400], [0.3, 0.5, 0.15, 0.05]);
        currentPet.qualities.mutated = true;
        const qualities = currentPet.qualities;
        qualities.endurance.current = Math.round(qualities.endurance.current * 1.1);
        qualities.strength.current = Math.round(qualities.strength.current * 1.1);
        qualities.faith.current = Math.round(qualities.faith.current * 1.1);
        qualities.agility.current = Math.round(qualities.agility.current * 1.1);
        qualities.intelligence.current = Math.round(qualities.intelligence.current * 1.1);
        // 设置背景为变异背景
        document.body.style.backgroundImage = "url('https://pic.imgdb.cn/item/665c7652d9c307b7e991a20d.png')";
        document.body.style.backgroundRepeat = "repeat";
    }

    bingpoRebornPill--;
    document.getElementById("bingpo-reborn-pill").innerText = bingpoRebornPill;
    
    currentPet.qualities.tier = tier;
    currentPet.qualities.growthRate = growthRate;

    updateQualityCard();
    updateSkillScore();

    // 更新技能
    const skillNum = getRandomInt(0, 3);
    const newSkills = [];
    const bSkills = currentPet.skills.filter(skill => skill.rarity === 'B');
    for (let i = 0; i < skillNum; i++) {
        const skill = bSkills[Math.floor(Math.random() * bSkills.length)];
        if (!newSkills.some(s => s.name === skill.name)) {
            newSkills.push(skill);
        }
    }
    updateSkillsArea(newSkills);
    updateSkillScore(newSkills);

    petLevel = 1;
    currentWisdom = 0;
    petWisdom = currentWisdom;

    document.getElementById("pet-level").innerText = petLevel;
    document.getElementById("current-wisdom").innerText = currentWisdom;

    updatePetLevel();
    updatePetWisdom();
    updateAttributePanel();
}
        
function rebornPet() {
    if (!checkDrawerOpen()) return;
    if (!currentPet || !currentPet.qualities) { // 添加检查
        console.warn("当前宠物未被正确初始化。");
        return;
    }
    if (awakened) {
        alert("您的宠物已经觉醒，无法还童！");
        return;
    }
    
    if (rebornPill < 1) {
        alert("您的神兽还童丹已耗尽！");
        return;
    }

    if (currentPet.qualities.mutated) {
        if (!confirm("您的宠物已经变异，再次还童会改变其状态，请谨慎操作！")) {
            return;
        }
        // 当宠物失去变异状态时，资质会除以1.1
        const qualities = currentPet.qualities;
        qualities.endurance.current = Math.round(qualities.endurance.current / 1.1);
        qualities.strength.current = Math.round(qualities.strength.current / 1.1);
        qualities.faith.current = Math.round(qualities.faith.current / 1.1);
        qualities.agility.current = Math.round(qualities.agility.current / 1.1);
        qualities.intelligence.current = Math.round(qualities.intelligence.current / 1.1);

        currentPet.qualities.mutated = false;
        // 恢复原背景
        document.body.style.backgroundImage = "";
    }

    rebornPill--;
    document.getElementById("reborn-pill").innerText = rebornPill;

    let tier, growthRate;
    const roll = Math.random() * 100;
    if (roll < 50) {
        tier = '普通';
        growthRate = 100;
    } else if (roll < 75) {
        tier = '优秀';
        growthRate = 220;
    } else if (roll < 90) {
        tier = '杰出';
        growthRate = 280;
    } else if (roll < 97.5) {
        tier = '卓越';
        growthRate = 340;
    } else if (roll < 99.95) {
        tier = '完美';
        growthRate = 400;
    } else {
        tier = Math.random() < 0.5 ? '卓越' : '完美';
        growthRate = tier === '卓越' ? getWeightedRandom([300, 320], [0.5, 0.5]) : getWeightedRandom([340, 360, 380, 400], [0.3, 0.5, 0.15, 0.05]);
        currentPet.qualities.mutated = true;
        // 设置背景为变异背景
        document.body.style.backgroundImage = "url('https://pic.imgdb.cn/item/665c7652d9c307b7e991a20d.png')";
        document.body.style.backgroundRepeat = "repeat";
    }
    
    currentPet.qualities.tier = tier;
    currentPet.qualities.growthRate = growthRate;

    const qualities = currentPet.qualities;
    qualities.endurance.current = getRandomInt(qualities.endurance.min, qualities.endurance.max * 0.85);
    qualities.strength.current = getRandomInt(qualities.strength.min, qualities.strength.max * 0.85);
    qualities.faith.current = getRandomInt(qualities.faith.min, qualities.faith.max * 0.85);
    qualities.agility.current = getRandomInt(qualities.agility.min, qualities.agility.max * 0.85);
    qualities.intelligence.current = getRandomInt(qualities.intelligence.min, qualities.intelligence.max * 0.85);

    updateQualityCard();
    updateSkillScore();

    // 更新技能
    const skillNum = getRandomInt(0, 3);
    const newSkills = [];
    const bSkills = currentPet.skills.filter(skill => skill.rarity === 'B');
    for (let i = 0; i < skillNum; i++) {
        const skill = bSkills[Math.floor(Math.random() * bSkills.length)];
        if (!newSkills.some(s => s.name === skill.name)) {
            newSkills.push(skill);
        }
    }
    updateSkillsArea(newSkills);
    updateSkillScore(newSkills);

    petLevel = 1;
    currentWisdom = 0;
    petWisdom = currentWisdom;
    petAscended = false; //新增宠物失去飞升的还童规则
    petMaxLevel = 149;

    document.getElementById("pet-level").innerText = petLevel;
    document.getElementById("current-wisdom").innerText = currentWisdom;

    updatePetLevel();
    updatePetWisdom();
    updateAttributePanel();
}

function trainQuality() {
    if (!checkDrawerOpen()) return;
    if (awakened) {
        alert("您的宠物已经觉醒，无法还童！");
        return;
    }
    const targetTier = prompt("请选择预期成长（普通，优秀，杰出，卓越，完美）:");
    if (targetTier === null) return;
    const stopOnMutation = confirm("宠物如果发生变异则停止还童？");

    const initialRebornPill = rebornPill; // 记录初始的还童丹数量
    let achieved = false;

    while (rebornPill > 0 && !achieved) {
        rebornPet();
        if (currentPet.qualities.tier === targetTier) {
            achieved = true;
        }
        if (stopOnMutation && currentPet.qualities.mutated) {
            achieved = true;
        }
    }

    const usedRebornPills = initialRebornPill - rebornPill; // 计算消耗的还童丹数量
    const message = `您消耗了${usedRebornPills}颗神兽还童丹，${achieved ? '达成了' : '未能达成'}预期段位。`;
    const messageBox = document.createElement('div');
    messageBox.style = "padding: 20px; background: white; border: 1px solid black; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;";
    messageBox.innerHTML = `<p>${message}</p>
                            <button onclick="document.body.removeChild(this.parentNode)">关闭</button>`;
    document.body.appendChild(messageBox);
}


function enhanceQuality() {
    if (!currentPet || !currentPet.qualities) { // 添加检查
        console.warn("当前宠物未被正确初始化。");
        return;
    }

    // 如果资质重生丹的数量小于1，提示用户并退出函数。
    if (qualityPill < 1) {
        alert("您的资质重生丹已耗尽！");
        return;
    }

    // 减少资质重生丹的数量并更新显示。
    qualityPill--;
    document.getElementById("quality-pill").innerText = qualityPill;

    // 获取当前宠物的资质。
    const qualities = currentPet.qualities;
    // 定义需要提升的资质维度。
    const dimensions = ['endurance', 'strength', 'faith', 'agility', 'intelligence'];
    // 用于存储达到最大值的维度。
    const maxedDimensions = [];
    // 用于存储新的资质值。
    let newQualities = {};

    // 遍历每个维度，生成一个在指定范围内的新资质值。
    dimensions.forEach(dim => {
        newQualities[dim] = getRandomInt(qualities[dim].min, qualities[dim].max * 0.92);
    });

    // 如果宠物的资质未发生变异，
    if (!currentPet.qualities.mutated) {
        // 遍历每个维度，如果随机数小于0.1，将该维度的资质值设为最大值，并添加到maxedDimensions数组。
        dimensions.forEach(dim => {
            if (Math.random() < 0.01) {
                newQualities[dim] = Math.max(newQualities[dim], Math.floor(qualities[dim].max) * 0.92);
                maxedDimensions.push(dim);
            }
        });

        // 如果有超过1个维度达到最大值，从maxedDimensions数组中弹出一个维度并重新生成该维度的资质值，直到只有2个或更少维度达到最大值。
        while (maxedDimensions.length > 1) {
            const dimToReset = maxedDimensions.pop();
            newQualities[dimToReset] = getRandomInt(qualities[dimToReset].min, qualities[dimToReset].max);
        }
    }

    // 遍历每个维度，将新生成的资质值应用到当前宠物的资质。
    dimensions.forEach(dim => {
        qualities[dim].current = newQualities[dim];
        // 如果宠物的资质发生了变异，将资质值提升10%。
        if (currentPet.qualities.mutated) {
            qualities[dim].current = Math.floor(qualities[dim].current * 1.1);
        }
    });

    // 更新资质卡片和技能分数。
    updateQualityCard();
    updateSkillScore();
}

let miraculousPill = 1; // 初始化灵异金丹数量

function mutatePet() {
    if (!checkDrawerOpen()) return;

    if (miraculousPill < 1) {
        alert("必要道具灵异金丹数量不足！");
        return;
    }
    if (awakened) {
        alert("您的宠物已经觉醒，无法使用灵异金丹！");
        return;
    }
    
    miraculousPill--;
    document.getElementById("miraculous-pill").innerText = miraculousPill;

    if (currentPet.qualities.mutated) {
        alert("您的宠物已经变异，无法再次使用灵异金丹！");
        return;
    }

    currentPet.qualities.tier = Math.random() < 0.5 ? '卓越' : '完美';
    currentPet.qualities.growthRate = currentPet.qualities.tier === '卓越' ? getWeightedRandom([300, 320], [0.5, 0.5]) : getWeightedRandom([340, 360, 380, 400], [0.3, 0.5, 0.15, 0.05]);
    currentPet.qualities.mutated = true;

    const qualities = currentPet.qualities;
    qualities.endurance.current = Math.round(qualities.endurance.current * 1.1);
    qualities.strength.current = Math.round(qualities.strength.current * 1.1);
    qualities.faith.current = Math.round(qualities.faith.current * 1.1);
    qualities.agility.current = Math.round(qualities.agility.current * 1.1);
    qualities.intelligence.current = Math.round(qualities.intelligence.current * 1.1);

    // 设置背景为变异背景
    document.body.style.backgroundImage = "url('https://pic.imgdb.cn/item/665c7652d9c307b7e991a20d.png')";
    document.body.style.backgroundRepeat = "repeat";

    updateQualityCard();
    updateSkillScore();
}

function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function getWeightedRandom(values, weights) {
    const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
    let rand = Math.random() * totalWeight;
    for (let i = 0; i < values.length; i++) {
        if (rand < weights[i]) {
            return values[i];
        }
        rand -= weights[i];
    }
    return values[0];
}

setInterval(updateDescriptionBox, 30000);
updateDescriptionBox(); // 初始化描述框
updateQualityCard(); // 初始化资质卡片

document.addEventListener('DOMContentLoaded', () => {
    initShop();
    updateTopBarItems();
    updateJinnangItems();
    updateAttributePanel();
    updateQualityCard();
    updatePetLevel();
});
    </script>
</body>
</html>
