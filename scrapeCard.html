<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ®åˆ®å¡æ¸¸æˆ</title>
    <style>
    /* scratchcard.css */
    .scrape-container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        font-family: Arial, sans-serif;
        border: 2px solid #8b4513;
        border-radius: 10px;
        background-color: #f5f5dc;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
        margin-top: 20px;
    }
    
    .scrape-drawer-toggle {
        background: linear-gradient(135deg, #ffcc00, #ff9900);
        padding: 10px;
        text-align: center;
        cursor: pointer;
        font-weight: bold;
        font-size: 18px;
        color: #8b4513;
        text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.6);
        border-bottom: 2px dashed #8b4513;
    }
    
    .scrape-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out;
    }
    
    .scrape-content.open {
        max-height: 1500px;
    }
    
    .scrape-drawer-inner {
        padding: 15px;
    }
    
    .scrape-section {
        margin-bottom: 20px;
    }
    
    .scrape-top {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid #d4a76a;
        padding-bottom: 10px;
    }
    
    .scrape-info-box {
        background-color: #fff8e1;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #d4a76a;
        font-size: 14px;
        text-align: center;
        flex-grow: 1;
        margin: 0 5px;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* å¡ç‰‡åŒºåŸŸæ ·å¼ */
    .scrape-middle {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 250px;
    }
    
    .scrape-card {
        width: 250px;
        height: 200px;
        perspective: 1000px;
    }
    
    .scrape-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
    }
    
    .scrape-card-cover {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff9900, #ffcc00, #ff9900);
        background-size: 200% 200%;
        animation: scrape-gradientShift 5s ease infinite;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
    }
    
    .scrape-card-instruction {
        font-size: 24px;
        font-weight: bold;
        color: #8b4513;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
    }
    
    .scrape-card-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    
    .scrape-prize-text {
        font-size: 20px;
        color: #8b4513;
        margin-bottom: 15px;
        font-weight: bold;
    }
    
    .scrape-prize-amount {
        font-size: 36px;
        font-weight: bold;
        color: #ff8c00;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    /* æ§åˆ¶åŒºåŸŸæ ·å¼ */
    .scrape-controls {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .scrape-card-selection {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .scrape-card-button {
        flex: 1;
        background: #fff8e1;
        border: 1px solid #d4a76a;
        border-radius: 5px;
        padding: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
    }
    
    .scrape-card-button:hover {
        background-color: #ffe0b2;
    }
    
    .scrape-card-button.active {
        background-color: #ffcc80;
        border-color: #ff9800;
        font-weight: bold;
        box-shadow: 0 0 5px rgba(255, 152, 0, 0.5);
    }
    
    .scrape-action-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
    }
    
    .scrape-button-buy {
        background: linear-gradient(to bottom, #4caf50, #2e7d32);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .scrape-button-buy:hover {
        background: linear-gradient(to bottom, #66bb6a, #388e3c);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .scrape-button-rules, .scrape-button-reset {
        background: #f5f5dc;
        border: 1px solid #d4a76a;
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .scrape-button-rules:hover, .scrape-button-reset:hover {
        background-color: #f0e9d2;
    }
    
    /* å†å²è®°å½•åŒºåŸŸ */
    .scrape-history {
        background-color: #fff8e1;
        border-radius: 5px;
        padding: 10px;
        border: 1px solid #d4a76a;
    }
    
    .scrape-history-title {
        font-weight: bold;
        color: #8b4513;
        margin-bottom: 10px;
        text-align: center;
        border-bottom: 1px solid #d4a76a;
        padding-bottom: 5px;
    }
    
    .scrape-history-list {
        max-height: 150px;
        overflow-y: auto;
    }
    
    .scrape-history-item {
        padding: 8px;
        border-bottom: 1px dashed #d4a76a;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
    }
    
    .scrape-history-item:last-child {
        border-bottom: none;
    }
    
    .scrape-history-amount {
        font-weight: bold;
        color: #ff8c00;
    }
    
    /* åŠ¨ç”» */
    @keyframes scrape-gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .scrape-win-animation {
        animation: scrape-winPulse 0.5s ease-in-out 3;
    }
    
    @keyframes scrape-winPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    /* åˆ®å¼€æ•ˆæœçš„æ ·å¼ */
    .scrape-being-scratched .scrape-card-cover {
        cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="black" stroke-width="2"/></svg>') 16 16, auto;
    }
    </style>
</head>
<body>
    <!-- ä¸»å®¹å™¨ï¼Œä½ æåˆ°çš„lotteryDrawerå°†æ”¾åœ¨è¿™é‡Œ -->
    <div class="lottery-drawer" id="lottery-drawer">
        <!-- scratchcard.html -->
        <div class="scrape-container" id="scrape-drawer">
            <div class="scrape-drawer-toggle" id="scrape-top-bar" onclick="toggleScrapeDrawer()">åˆ®åˆ®ä¹ğŸ²</div>
            <div class="scrape-content" id="scrape-content-container">
                <div class="scrape-drawer-inner" id="scrape-inpage-decorations">
                    <!-- é¡¶éƒ¨ä¿¡æ¯åŒº -->
                    <div class="scrape-section scrape-top" id="scrape-top">
                        <div class="scrape-info-box" id="scrape-balance">ä½™é¢: <span id="scrape-gold-amount">0</span></div>
                        <div class="scrape-info-box" id="scrape-win-count">ä¸­å¥–æ¬¡æ•°: 0</div>
                        <div class="scrape-info-box" id="scrape-total-spent">æ€»èŠ±è´¹: 0</div>
                    </div>
                    
                    <!-- å¡ç‰‡åŒºåŸŸ -->
                    <div class="scrape-section scrape-middle" id="scrape-card-area">
                        <div class="scrape-card" id="scrape-card">
                            <div class="scrape-card-inner">
                                <div class="scrape-card-cover" id="scrape-card-cover">
                                    <span class="scrape-card-instruction">åˆ®ä¸€åˆ®ï¼Œå¥½è¿æ¥ï¼</span>
                                </div>
                                <div class="scrape-card-content" id="scrape-card-content">
                                    <div class="scrape-prize-text" id="scrape-prize-text">è¯•è¯•æ‰‹æ°”ï¼</div>
                                    <div class="scrape-prize-amount" id="scrape-prize-amount">???</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ§åˆ¶åŒºåŸŸ -->
                    <div class="scrape-section scrape-controls" id="scrape-controls">
                        <div class="scrape-card-selection">
                            <button class="scrape-card-button active" data-price="500" id="scrape-card-normal">æ™®é€šå¡ (500é‡‘)</button>
                            <button class="scrape-card-button" data-price="2000" id="scrape-card-premium">é«˜çº§å¡ (2000é‡‘)</button>
                            <button class="scrape-card-button" data-price="10000" id="scrape-card-deluxe">è±ªåå¡ (10000é‡‘)</button>
                        </div>
                        
                        <div class="scrape-action-buttons">
                            <button class="scrape-button-buy" id="scrape-buy-card">è´­ä¹°åˆ®åˆ®å¡</button>
                            <button class="scrape-button-rules" id="scrape-show-rules">æ¸¸æˆè§„åˆ™</button>
                            <button class="scrape-button-reset" id="scrape-reset-game">é‡ç½®ç»Ÿè®¡</button>
                        </div>
                    </div>
                    
                    <!-- ä¸­å¥–è®°å½• -->
                    <div class="scrape-section scrape-history" id="scrape-history">
                        <div class="scrape-history-title">æœ€è¿‘ä¸­å¥–è®°å½•</div>
                        <div class="scrape-history-list" id="scrape-history-list">
                            <!-- åŠ¨æ€æ’å…¥ä¸­å¥–è®°å½• -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- åˆ®åˆ®å¡JavaScriptä»£ç å¼€å§‹ -->
    <script>
    // scratchcard.js
    (function() {
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let scrapeGameState = {
            selectedCardType: 'normal',
            cardPrices: {
                normal: 500,
                premium: 2000,
                deluxe: 10000
            },
            isScratching: false,
            canBuy: true,
            stats: {
                totalSpent: 0,
                winCount: 0
            },
            history: []
        };
        
        // åˆå§‹åŒ–å‡½æ•°
        function initScrapeGame() {
            // è·å–DOMå…ƒç´ 
            const buyCardButton = document.getElementById('scrape-buy-card');
            const cardNormalButton = document.getElementById('scrape-card-normal');
            const cardPremiumButton = document.getElementById('scrape-card-premium');
            const cardDeluxeButton = document.getElementById('scrape-card-deluxe');
            const rulesButton = document.getElementById('scrape-show-rules');
            const resetButton = document.getElementById('scrape-reset-game');
            
            // äº‹ä»¶ç»‘å®š
            buyCardButton.addEventListener('click', buyCard);
            cardNormalButton.addEventListener('click', () => selectCardType('normal'));
            cardPremiumButton.addEventListener('click', () => selectCardType('premium'));
            cardDeluxeButton.addEventListener('click', () => selectCardType('deluxe'));
            rulesButton.addEventListener('click', showRules);
            resetButton.addEventListener('click', resetStats);
            
            // åˆå§‹æ›´æ–°æ˜¾ç¤º
            updateLotteryGoldDisplay();
            updateStats();
            
            // åˆå§‹é€‰æ‹©æ™®é€šå¡
            selectCardType('normal');
        }
        
        // é€‰æ‹©å¡ç‰‡ç±»å‹
        function selectCardType(type) {
            scrapeGameState.selectedCardType = type;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const cardNormalButton = document.getElementById('scrape-card-normal');
            const cardPremiumButton = document.getElementById('scrape-card-premium');
            const cardDeluxeButton = document.getElementById('scrape-card-deluxe');
            
            cardNormalButton.classList.remove('active');
            cardPremiumButton.classList.remove('active');
            cardDeluxeButton.classList.remove('active');
            
            if (type === 'normal') {
                cardNormalButton.classList.add('active');
            } else if (type === 'premium') {
                cardPremiumButton.classList.add('active');
            } else if (type === 'deluxe') {
                cardDeluxeButton.classList.add('active');
            }
        }
        
        // è´­ä¹°å¡ç‰‡
        function buyCard() {
            if (!scrapeGameState.canBuy) return;
            
            const cardPrice = scrapeGameState.cardPrices[scrapeGameState.selectedCardType];
            
            // æ£€æŸ¥é‡‘å¸æ˜¯å¦è¶³å¤Ÿ
            if (window.goldAmount < cardPrice) {
                window.showInfoBox('é‡‘å¸ä¸è¶³ï¼Œæ— æ³•è´­ä¹°æ­¤åˆ®åˆ®å¡ï¼', null, null, 'red');
                return;
            }
            
            // æ‰£é™¤é‡‘å¸å¹¶æ›´æ–°ç»Ÿè®¡
            window.goldAmount -= cardPrice;
            scrapeGameState.stats.totalSpent += cardPrice;
            updateLotteryGoldDisplay();
            updateStats();
            
            // å‡†å¤‡åˆ®åˆ®å¡
            prepareScratchCard();
        }
        
        // å‡†å¤‡åˆ®åˆ®å¡
        function prepareScratchCard() {
            // è·å–å¡ç‰‡å…ƒç´ 
            const cardCover = document.getElementById('scrape-card-cover');
            const cardContent = document.getElementById('scrape-card-content');
            const prizeText = document.getElementById('scrape-prize-text');
            const prizeAmount = document.getElementById('scrape-prize-amount');
            const cardElement = document.getElementById('scrape-card');
            
            // é‡ç½®å¡ç‰‡çŠ¶æ€
            scrapeGameState.isScratching = true;
            scrapeGameState.canBuy = false;
            
            // è®¾ç½®å¡ç‰‡å†…å®¹ï¼ˆè¿˜æ²¡è¢«åˆ®ï¼‰
            prizeText.textContent = 'è¯•è¯•æ‰‹æ°”ï¼';
            prizeAmount.textContent = '???';
            prizeAmount.style.color = '#ff8c00';
            
            // é‡ç½®åˆ®åˆ®å¡è¦†ç›–å±‚
            cardCover.style.display = 'flex';
            cardCover.style.background = 'linear-gradient(135deg, #ff9900, #ffcc00, #ff9900)';
            cardCover.style.backgroundSize = '200% 200%';
            cardCover.innerHTML = '<span class="scrape-card-instruction">ç”¨é¼ æ ‡åˆ®å¼€ï¼</span>';
            
            // ç§»é™¤ä¹‹å‰å¯èƒ½çš„åŠ¨ç”»ç±»
            cardContent.classList.remove('scrape-win-animation');
            
            // ç”Ÿæˆå¥–å“
            generatePrize();
            
            // æ·»åŠ åˆ®å¡äº‹ä»¶ç›‘å¬
            setupScratchEvents();
        }
        
        // ç”Ÿæˆå¥–å“
        function generatePrize() {
            let prizeData = {};
            const random = Math.random() * 100;
            
            switch (scrapeGameState.selectedCardType) {
                case 'normal':
                    if (random < 45) { // å°å¥–
                        const prize = Math.floor(Math.random() * (900 - 450 + 1)) + 450;
                        prizeData = { text: 'æ­å–œå°å¥–ï¼', amount: prize, type: 'small' };
                    } else if (random < 55) { // ä¸­å¥–
                        const prize = Math.floor(Math.random() * (3000 - 1000 + 1)) + 1000;
                        prizeData = { text: 'æ­å–œä¸­å¥–ï¼', amount: prize, type: 'medium' };
                    } else if (random < 58) { // å¤§å¥–
                        const prize = Math.floor(Math.random() * (8000 - 5000 + 1)) + 5000;
                        prizeData = { text: 'æ­å–œå¤§å¥–ï¼', amount: prize, type: 'large' };
                    } else if (random < 59) { // é¡¶çº§å¤§å¥–
                        prizeData = { text: 'é¡¶çº§å¤§å¥–ï¼', amount: 10000, type: 'jackpot' };
                    } else { // æœªä¸­å¥–
                        prizeData = { text: 'å¾ˆé—æ†¾ï¼', amount: 0, type: 'none' };
                    }
                    break;
                    
                case 'premium':
                    if (random < 50) { // å°å¥–
                        const prize = Math.floor(Math.random() * (3000 - 1500 + 1)) + 1500;
                        prizeData = { text: 'æ­å–œå°å¥–ï¼', amount: prize, type: 'small' };
                    } else if (random < 65) { // ä¸­å¥–
                        const prize = Math.floor(Math.random() * (10000 - 4000 + 1)) + 4000;
                        prizeData = { text: 'æ­å–œä¸­å¥–ï¼', amount: prize, type: 'medium' };
                    } else if (random < 70) { // å¤§å¥–
                        const prize = Math.floor(Math.random() * (25000 - 15000 + 1)) + 15000;
                        prizeData = { text: 'æ­å–œå¤§å¥–ï¼', amount: prize, type: 'large' };
                    } else if (random < 72) { // é¡¶çº§å¤§å¥–
                        prizeData = { text: 'é¡¶çº§å¤§å¥–ï¼', amount: 50000, type: 'jackpot' };
                    } else { // æœªä¸­å¥–
                        prizeData = { text: 'å¾ˆé—æ†¾ï¼', amount: 0, type: 'none' };
                    }
                    break;
                    
                case 'deluxe':
                    if (random < 55) { // å°å¥–
                        const prize = Math.floor(Math.random() * (15000 - 8000 + 1)) + 8000;
                        prizeData = { text: 'æ­å–œå°å¥–ï¼', amount: prize, type: 'small' };
                    } else if (random < 75) { // ä¸­å¥–
                        const prize = Math.floor(Math.random() * (50000 - 20000 + 1)) + 20000;
                        prizeData = { text: 'æ­å–œä¸­å¥–ï¼', amount: prize, type: 'medium' };
                    } else if (random < 83) { // å¤§å¥–
                        const prize = Math.floor(Math.random() * (100000 - 60000 + 1)) + 60000;
                        prizeData = { text: 'æ­å–œå¤§å¥–ï¼', amount: prize, type: 'large' };
                    } else if (random < 86) { // é¡¶çº§å¤§å¥–
                        prizeData = { text: 'é¡¶çº§å¤§å¥–ï¼', amount: 200000, type: 'jackpot' };
                    } else { // æœªä¸­å¥–
                        prizeData = { text: 'å¾ˆé—æ†¾ï¼', amount: 0, type: 'none' };
                    }
                    break;
            }
            
            // ä¿å­˜åˆ°çŠ¶æ€
            scrapeGameState.currentPrize = prizeData;
        }
        
        // è®¾ç½®åˆ®å¡äº‹ä»¶
        function setupScratchEvents() {
            const cardCover = document.getElementById('scrape-card-cover');
            const cardContent = document.getElementById('scrape-card-content');
            const prizeText = document.getElementById('scrape-prize-text');
            const prizeAmount = document.getElementById('scrape-prize-amount');
            const cardElement = document.getElementById('scrape-card');
            
            let isScratching = false;
            let scratchProgress = 0;
            
            // æ·»åŠ åˆ®å¡æ ·å¼
            cardElement.classList.add('scrape-being-scratched');
            
            // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
            function handleMouseDown(e) {
                isScratching = true;
                scratchAt(e);
            }
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            function handleMouseMove(e) {
                if (isScratching) {
                    scratchAt(e);
                }
            }
            
            // é¼ æ ‡å¼¹èµ·äº‹ä»¶
            function handleMouseUp() {
                isScratching = false;
                
                // å¦‚æœåˆ®å¼€äº†è¶³å¤Ÿå¤šï¼Œæ˜¾ç¤ºæ•´ä¸ªç»“æœ
                if (scratchProgress > 50) {
                    revealFullCard();
                }
            }
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            cardCover.addEventListener('mousedown', handleMouseDown);
            cardCover.addEventListener('mousemove', handleMouseMove);
            window.addEventListener('mouseup', handleMouseUp);
            
            // åˆ®å¡åŠŸèƒ½
            function scratchAt(e) {
                const rect = cardCover.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // åˆ›å»ºå¾„å‘æ¸å˜æ•ˆæœçš„é€æ˜åŒºåŸŸ
                const existingBg = window.getComputedStyle(cardCover).backgroundImage;
                cardCover.style.backgroundImage = `${existingBg}, radial-gradient(circle at ${x}px ${y}px, transparent 20px, rgba(255, 255, 255, 0.7) 21px)`;
                
                // æ›´æ–°åˆ®å¡è¿›åº¦
                scratchProgress += 2;
                
                // å¦‚æœå®Œæˆè¶…è¿‡70%ï¼Œè‡ªåŠ¨æ­ç¤ºå®Œæ•´å¡ç‰‡
                if (scratchProgress >= 70) {
                    revealFullCard();
                }
            }
            
            // æ˜¾ç¤ºå®Œæ•´å¡ç‰‡
            function revealFullCard() {
                // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
                cardCover.removeEventListener('mousedown', handleMouseDown);
                cardCover.removeEventListener('mousemove', handleMouseMove);
                window.removeEventListener('mouseup', handleMouseUp);
                
                cardCover.style.display = 'none';
                cardElement.classList.remove('scrape-being-scratched');
                
                // æ˜¾ç¤ºå¥–å“
                const prize = scrapeGameState.currentPrize;
                prizeText.textContent = prize.text;
                prizeAmount.textContent = prize.amount > 0 ? `+${prize.amount} é‡‘å¸` : 'æœªä¸­å¥–';
                
                // è®¾ç½®å¥–å“æ ·å¼
                if (prize.type === 'none') {
                    prizeAmount.style.color = '#777';
                } else {
                    prizeAmount.style.color = getPrizeColor(prize.type);
                    cardContent.classList.add('scrape-win-animation');
                    
                    // æ·»åŠ åˆ°ä¸­å¥–è®°å½•
                    if (prize.amount > 0) {
                        addToHistory(prize);
                        scrapeGameState.stats.winCount++;
                        window.goldAmount += prize.amount;
                        updateLotteryGoldDisplay();
                        updateStats();
                    }
                }
                
                // é‡ç½®çŠ¶æ€
                setTimeout(() => {
                    cardContent.classList.remove('scrape-win-animation');
                    scrapeGameState.canBuy = true;
                }, 1500);
            }
        }
        
        // è·å–å¥–å“é¢œè‰²
        function getPrizeColor(type) {
            switch (type) {
                case 'small': return '#4caf50';
                case 'medium': return '#2196f3';
                case 'large': return '#ff9800';
                case 'jackpot': return '#f44336';
                default: return '#777';
            }
        }
        
        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(prize) {
            // è·å–å†å²è®°å½•å…ƒç´ 
            const historyListElement = document.getElementById('scrape-history-list');
            
            // åˆ›å»ºæ–°çš„å†å²è®°å½•é¡¹
            const newHistoryItem = {
                time: new Date(),
                cardType: scrapeGameState.selectedCardType,
                amount: prize.amount,
                type: prize.type
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•æ•°ç»„å‰ç«¯
            scrapeGameState.history.unshift(newHistoryItem);
            
            // æœ€å¤šä¿å­˜10æ¡è®°å½•
            if (scrapeGameState.history.length > 10) {
                scrapeGameState.history.pop();
            }
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            updateHistoryDisplay();
        }
        
        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            // è·å–å†å²è®°å½•å…ƒç´ 
            const historyListElement = document.getElementById('scrape-history-list');
            
            // æ¸…ç©ºç°æœ‰å†å²è®°å½•
            historyListElement.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰è®°å½•ï¼Œæ˜¾ç¤ºæç¤º
            if (scrapeGameState.history.length === 0) {
                historyListElement.innerHTML = '<div class="scrape-history-item">æš‚æ— ä¸­å¥–è®°å½•</div>';
                return;
            }
            
            // æ·»åŠ æ¯æ¡å†å²è®°å½•
            scrapeGameState.history.forEach((item) => {
                const timeStr = formatTime(item.time);
                const cardTypeStr = getCardTypeName(item.cardType);
                
                const historyItem = document.createElement('div');
                historyItem.className = 'scrape-history-item';
                historyItem.innerHTML = `
                    <span>${timeStr} - ${cardTypeStr}</span>
                    <span class="scrape-history-amount" style="color: ${getPrizeColor(item.type)}">+${item.amount}</span>
                `;
                
                historyListElement.appendChild(historyItem);
            });
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // è·å–å¡ç‰‡ç±»å‹åç§°
        function getCardTypeName(type) {
            switch (type) {
                case 'normal': return 'æ™®é€šå¡';
                case 'premium': return 'é«˜çº§å¡';
                case 'deluxe': return 'è±ªåå¡';
                default: return 'æœªçŸ¥å¡ç‰‡';
            }
        }
        
        // æ˜¾ç¤ºè§„åˆ™
        function showRules() {
            // æ¸¸æˆè§„åˆ™å†…å®¹
            const rulesContent = "...æ¸¸æˆè§„åˆ™å†…å®¹..."; // ä¸ºç®€æ´çœç•¥å…·ä½“å†…å®¹
            window.showInfoBox(rulesContent, null, null, 'black');
        }
        
    // é‡ç½®ç»Ÿè®¡æ•°æ®
        function resetStats() {
            window.showInfoBox(
                'ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿå†å²è®°å½•å°†è¢«æ¸…ç©ºã€‚', 
                function() {
                    scrapeGameState.stats = {
                        totalSpent: 0,
                        winCount: 0
                    };
                    scrapeGameState.history = [];
                    
                    updateStats();
                    updateHistoryDisplay();
                    
                    window.showInfoBox("ç»Ÿè®¡æ•°æ®å·²é‡ç½®ï¼", null, null, 'green');
                }, 
                function() {
                    // å–æ¶ˆæ“ä½œ
                }, 
                'black'
            );
        }
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            const winCountElement = document.getElementById('scrape-win-count');
            const totalSpentElement = document.getElementById('scrape-total-spent');
            
            winCountElement.textContent = `ä¸­å¥–æ¬¡æ•°: ${scrapeGameState.stats.winCount}`;
            totalSpentElement.textContent = `æ€»èŠ±è´¹: ${scrapeGameState.stats.totalSpent}`;
        }
        
        // æ›´æ–°é‡‘å¸æ˜¾ç¤º
        function updateLotteryGoldDisplay() {
            const goldAmountElement = document.getElementById('scrape-gold-amount');
            
            // ç¡®ä¿goldAmountæ˜¯å®šä¹‰çš„
            if (typeof window.goldAmount === 'undefined') {
                window.goldAmount = 0;
            }
            
            // æ›´æ–°æ˜¾ç¤º
            goldAmountElement.textContent = window.goldAmount;
            
            // å¦‚æœæœ‰å…¨å±€æ›´æ–°å‡½æ•°ï¼Œä¹Ÿè°ƒç”¨å®ƒ
            if (typeof window.updateLotteryGoldDisplay === 'function') {
                window.updateLotteryGoldDisplay(window.goldAmount);
            }
        }
        
        // æš´éœ²åˆ‡æ¢æŠ½å±‰çš„å‡½æ•°åˆ°å…¨å±€
        window.toggleScrapeDrawer = function() {
            const content = document.getElementById('scrape-content-container');
            content.classList.toggle('open');
        };
        
        // åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initScrapeGame);
        } else {
            initScrapeGame();
        }
        
        // æš´éœ²é‡ç½®å‡½æ•°åˆ°å…¨å±€ï¼Œæ–¹ä¾¿ä¸»æ¸¸æˆè°ƒç”¨
        window.resetScrapeGame = function() {
            scrapeGameState.stats = {
                totalSpent: 0,
                winCount: 0
            };
            scrapeGameState.history = [];
            
            updateStats();
            updateHistoryDisplay();
        };
    })();
    </script>
    <!-- åˆ®åˆ®å¡JavaScriptä»£ç ç»“æŸ -->
</body>
</html>
</div>
