<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>äººç”Ÿæ¨¡æ‹Ÿå™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary-grad-start: #6a82fb;
      --primary-grad-end: #fc5c7d;
      --accent-grad-start: #ffc3a0;
      --accent-grad-end: #ffafbd;
      --text-color: #333;
      --bg-light: #ffffff;
      --bg-grey: #f7f8fc;
      --border-color: #eef0f5;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, var(--primary-grad-start), var(--primary-grad-end));
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    .game-box {
      background: var(--bg-light);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      max-width: 450px;
      width: 100%;
      text-align: center;
      display: none; /* Initially hidden */
    }

    h1 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 26px;
      background: linear-gradient(120deg, var(--primary-grad-start), var(--primary-grad-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* çŠ¶æ€é¢æ¿ */
    .status-panel {
      background: var(--bg-grey);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    .total-reward-display {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 10px;
      transition: all 0.3s ease;
      letter-spacing: 1px;
    }
    .sub-stats {
      display: flex;
      justify-content: space-around;
      font-size: 15px;
      color: #555;
    }

    /* æŒ‰é’® */
    .action-buttons button, .upgrade-btn {
      padding: 12px 18px;
      margin: 8px 4px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    .action-buttons button {
      background: linear-gradient(120deg, var(--primary-grad-start), var(--primary-grad-end));
    }
    .action-buttons button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(106, 130, 251, 0.4);
    }
    .action-buttons button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* å‡çº§åŒºåŸŸ */
    .upgrades-section {
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }
    .upgrades-section h2 { font-size: 18px; margin: 0 0 10px; color: #555; }
    .upgrade-btn {
      width: 100%;
      background: linear-gradient(120deg, #84fab0, #8fd3f4);
      display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
    }
    .upgrade-btn:hover:not(:disabled) {
       transform: translateY(-2px);
       box-shadow: 0 4px 10px rgba(135, 221, 240, 0.6);
    }
    .upgrade-btn:disabled { background: #e0e0e0; cursor: not-allowed; color: #999; }
    
    /* æ—¥å¿— */
    #log {
      margin-top: 20px; padding: 10px; background: var(--bg-grey); border-radius: 10px;
      text-align: left; max-height: 150px; overflow-y: auto; font-size: 13px;
      border: 1px solid var(--border-color);
    }
    #log p { margin: 6px 0; padding: 0 5px; line-height: 1.5; }

    /* åŠ¨æ€å¥–åŠ±æ ·å¼ */
    .reward-normal { color: #333; }
    .reward-hundred { color: #007bff; font-weight: bold; }
    .reward-thousand { color: #ff9800; font-size: 1.1em; font-weight: bold; }
    .reward-big { color: #e53935; font-size: 1.2em; font-weight: bold; animation: pulse 0.8s infinite alternate; }
    @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }

    /* æ¨¡æ€æ¡†/å¼¹çª— */
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: flex; justify-content: center;
      align-items: center; z-index: 1000; padding: 20px; box-sizing: border-box;
    }
    .modal-content {
      background: white; padding: 30px; border-radius: 15px;
      max-width: 500px; width: 100%; text-align: center;
    }
    .modal-content h2 { margin-top: 0; }
    .modal-content p { color: #666; line-height: 1.6; }
    .age-options button { margin: 5px; }
    #evaluationText { text-align: left; white-space: pre-wrap; margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="game-box" id="gameBox">
    <h1>äººç”Ÿæ¨¡æ‹Ÿå™¨</h1>
    <div class="status-panel">
      <div id="totalRewardDisplay" class="total-reward-display">0 å…ƒ</div>
      <div class="sub-stats">
        <span>æœºä¼š: <span id="chances">0</span></span>
        <span>Tickets: <span id="ticketCount">0</span></span>
      </div>
    </div>
    <div class="action-buttons">
      <button onclick="pressButton()" id="pressBtn">åŠªåŠ›ä¸€æ¬¡</button>
      <button onclick="buyTicket()" id="ticketBtn">é£é™©æŠ•èµ„ (1 å…ƒ)</button>
      <button onclick="settle()" id="settleBtn">ç»“ç®—äººç”Ÿ</button>
    </div>
    <div class="upgrades-section">
      <h2>è‡ªæˆ‘å¢å€¼</h2>
      <button onclick="buyUpgrade('crit')" id="critUpgradeBtn" class="upgrade-btn">
        <span>æå‡æš´å‡»ç‡ (Lv. 1)</span><span>èŠ±è´¹ 10000</span>
      </button>
      <button onclick="buyUpgrade('reward')" id="rewardUpgradeBtn" class="upgrade-btn">
        <span>æå‡åŸºç¡€å›æŠ¥ (Lv. 1)</span><span>èŠ±è´¹ 8000</span>
      </button>
    </div>
    <div id="log"></div>
  </div>

  <!-- åˆå§‹å¹´é¾„é€‰æ‹©å¼¹çª— -->
  <div class="modal" id="ageModal">
    <div class="modal-content">
      <h2>äººç”Ÿå¼€å±€</h2>
      <p>åœ¨å¼€å§‹ä½ çš„â€œäººç”Ÿâ€ä¹‹å‰ï¼Œè¯·åšå‡ºç¬¬ä¸€ä¸ªé‡å¤§å†³å®šï¼š<br>ä½ å¸Œæœ›åœ¨å¤šå°‘å²æ—¶é€€ä¼‘ï¼Ÿ</p>
      <div class="age-options">
        <button onclick="startGame(20)">20å² (1æ¬¡æœºä¼š)</button>
        <button onclick="startGame(30)">30å² (2æ¬¡æœºä¼š)</button>
        <button onclick="startGame(40)">40å² (3æ¬¡æœºä¼š)</button>
        <button onclick="startGame(50)">50å² (4æ¬¡æœºä¼š)</button>
        <button onclick="startGame(60)">60å² (5æ¬¡æœºä¼š)</button>
        <button onclick="startGame(70)">70å² (6æ¬¡æœºä¼š)</button>
        <button onclick="startGame(80)">80å² (7æ¬¡æœºä¼š)</button>
      </div>
    </div>
  </div>

  <!-- ç»“ç®—è¯„è¯­å¼¹çª— -->
  <div class="modal" id="settlementModal" style="display: none;">
    <div class="modal-content">
      <h2>äººç”Ÿæ€»ç»“æŠ¥å‘Š</h2>
      <p id="evaluationText"></p>
      <button onclick="restartGame()">å¼€å¯æ–°çš„äººç”Ÿ</button>
    </div>
  </div>

  <div id="messageBox"></div> <!-- æ¶ˆæ¯æç¤ºæ¡†ï¼Œæ ·å¼åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­å·²å®šä¹‰ -->

  <script>
    let chances, totalReward, ticketPrice, ticketCount, retirementAge;
    let upgrades;
    
    const initialUpgrades = {
      crit: { level: 1, cost: 10000, baseChance: 0.01, chanceIncrement: 0.005, costMultiplier: 3.5 },
      reward: { level: 1, cost: 8000, baseMultiplier: 1.0, multiplierIncrement: 0.1, costMultiplier: 3 }
    };

    function startGame(age) {
      retirementAge = age;
      chances = (age - 20) / 10 + 1;
      
      totalReward = 0;
      ticketPrice = 1;
      ticketCount = 0;
      upgrades = JSON.parse(JSON.stringify(initialUpgrades));

      document.getElementById("log").innerHTML = "";
      document.getElementById("pressBtn").disabled = false;
      document.getElementById("settleBtn").disabled = false;
      
      document.getElementById("ageModal").style.display = "none";
      document.getElementById("gameBox").style.display = "block";
      
      addLog(`ä½ é€‰æ‹©äº† ${age} å²é€€ä¼‘ï¼Œè·å¾—äº† ${chances} æ¬¡åˆå§‹æœºä¼šã€‚äººç”Ÿå¼€å§‹äº†...`);
      updateUI();
    }

    function updateUI() {
      document.getElementById("chances").innerText = chances;
      document.getElementById("ticketCount").innerText = ticketCount;
      document.getElementById("ticketBtn").innerText = `é£é™©æŠ•èµ„ (${ticketPrice.toLocaleString()} å…ƒ)`;

      const rewardDisplay = document.getElementById("totalRewardDisplay");
      rewardDisplay.innerHTML = `${totalReward.toLocaleString()} å…ƒ`;
      let cls = "reward-normal";
      if (totalReward >= 1000000) cls = "reward-big";
      else if (totalReward >= 10000) cls = "reward-thousand";
      else if (totalReward >= 1000) cls = "reward-hundred";
      rewardDisplay.className = `total-reward-display ${cls}`;

      document.getElementById("ticketBtn").disabled = totalReward < ticketPrice;
      document.getElementById("critUpgradeBtn").disabled = totalReward < upgrades.crit.cost;
      document.getElementById("rewardUpgradeBtn").disabled = totalReward < upgrades.reward.cost;
      
      const critBtn = document.getElementById('critUpgradeBtn');
      critBtn.children[0].innerText = `æå‡æš´å‡»ç‡ (Lv. ${upgrades.crit.level})`;
      critBtn.children[1].innerText = `èŠ±è´¹ ${upgrades.crit.cost.toLocaleString()}`;

      const rewardBtn = document.getElementById('rewardUpgradeBtn');
      rewardBtn.children[0].innerText = `æå‡åŸºç¡€å›æŠ¥ (Lv. ${upgrades.reward.level})`;
      rewardBtn.children[1].innerText = `èŠ±è´¹ ${upgrades.reward.cost.toLocaleString()}`;
    }

    function addLog(html) {
      const logEl = document.getElementById("log");
      const p = document.createElement("p");
      p.innerHTML = html;
      logEl.prepend(p);
    }

    function formatReward(num) {
      let cls = "reward-normal";
      if (num >= 100000) cls = "reward-big";
      else if (num >= 1000) cls = "reward-thousand";
      else if (num >= 100) cls = "reward-hundred";
      return `<span class="${cls}">${num.toLocaleString()}</span>`;
    }

    function getRandomReward() {
      const rand = Math.random();
      let baseReward = (rand < 0.9) ? (Math.floor(Math.random() * 100) + 1) : (Math.floor(Math.random() * 9999) + 100);
      return Math.floor(baseReward * upgrades.reward.baseMultiplier);
    }

    function pressButton() {
      if (chances <= 0) {
        alert("æœºä¼šå·²ç”¨å®Œï¼Œè¯·è¿›è¡Œé£é™©æŠ•èµ„æˆ–ç›´æ¥ç»“ç®—ã€‚");
        return;
      }
      chances--;
      let reward = getRandomReward();
      let eventMsg = "";

      if (Math.random() < upgrades.crit.baseChance) {
        reward *= 10;
        eventMsg = "âš¡ å‘½è¿çš„æš´å‡»ï¼";
        alert(eventMsg);
      }
      
      totalReward += reward;
      addLog(`ç¬¬ ${ticketCount + ((retirementAge - 20) / 10 + 1) - chances} æ¬¡åŠªåŠ›: è·å¾— ${formatReward(reward)} å…ƒ ${eventMsg}`);
      updateUI();
    }

    function buyTicket() {
      if (totalReward < ticketPrice) return;
      totalReward -= ticketPrice;
      ticketCount++;
      chances++;
      
      addLog(`ğŸ§¾ è¿›è¡Œç¬¬ ${ticketCount} æ¬¡é£é™©æŠ•èµ„ï¼ŒèŠ±è´¹ ${ticketPrice.toLocaleString()} å…ƒï¼Œè·å¾—1æ¬¡é¢å¤–æœºä¼šã€‚`);
      
      ticketPrice *= 2;
      updateUI();
    }
    
    function buyUpgrade(type) {
        const upgrade = upgrades[type];
        if (totalReward < upgrade.cost) return;

        totalReward -= upgrade.cost;
        upgrade.level++;
        
        let logMsg = "";
        if (type === 'crit') {
            upgrade.baseChance += upgrade.chanceIncrement;
            logMsg = `ğŸ”§ ä½ æŠ•èµ„äº†è‡ªå·±ï¼Œæš´å‡»ç‡æå‡è‡³ ${(upgrade.baseChance * 100).toFixed(2)}%ï¼èŠ±è´¹ ${upgrade.cost.toLocaleString()}ã€‚`;
        } else if (type === 'reward') {
            upgrade.baseMultiplier += upgrade.multiplierIncrement;
            logMsg = `ğŸ”§ ä½ å‚åŠ äº†åŸ¹è®­ï¼ŒåŸºç¡€å›æŠ¥æå‡è‡³ ${upgrade.baseMultiplier.toFixed(1)}xï¼èŠ±è´¹ ${upgrade.cost.toLocaleString()}ã€‚`;
        }
        
        upgrade.cost = Math.floor(upgrade.cost * upgrade.costMultiplier);
        addLog(logMsg);
        updateUI();
    }

    function settle() {
      document.getElementById("pressBtn").disabled = true;
      document.getElementById("ticketBtn").disabled = true;
      document.getElementById("settleBtn").disabled = true;
      document.getElementById("critUpgradeBtn").disabled = true;
      document.getElementById("rewardUpgradeBtn").disabled = true;

      const evaluationText = generateEvaluation();
      document.getElementById("evaluationText").innerText = evaluationText;
      document.getElementById("settlementModal").style.display = "flex";
    }

    function generateEvaluation() {
        // 1. å®šä¹‰è¯„ä»·ç»´åº¦
        let ageTier, rewardTier, ticketTier, upgradeTier;

        if (retirementAge <= 30) ageTier = { name: "è‹±å¹´æ—©é€€", text: `ä½ é€‰æ‹©äº†åœ¨ ${retirementAge} å²å°±æ—©æ—©ç¦»åœºï¼Œæ¢¦æƒ³ç€ä»¥æœ€çŸ­çš„æ—¶é—´æ¢å–æœ€å¤§çš„å›æŠ¥ã€‚` };
        else if (retirementAge <= 60) ageTier = { name: "æ ‡å‡†äººç”Ÿ", text: `ä½ è§„åˆ’äº† ${retirementAge} å²çš„æ ‡å‡†é€€ä¼‘è·¯çº¿ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ã€‚` };
        else ageTier = { name: "å¤§å™¨æ™šæˆ", text: `ä½ å†³å®šå¥‹æ–—åˆ° ${retirementAge} å²ï¼Œç›¸ä¿¡æ—¶é—´ä¼šç»™äºˆå›æŠ¥ï¼Œå±äºå…¸å‹çš„å¤§å™¨æ™šæˆå‹é€‰æ‰‹ã€‚` };

        if (totalReward < 10000) rewardTier = { name: "å‹‰å¼ºç³Šå£", text: `ç„¶è€Œï¼Œä½ æœ€ç»ˆçš„ç§¯è“„ä»…æœ‰ ${totalReward.toLocaleString()} å…ƒï¼Œåœ¨è¿™ä¸ªæ—¶ä»£ï¼Œè¿™ç¬”é’±å¯èƒ½åªå¤Ÿå‹‰å¼ºç³Šå£ã€‚` };
        else if (totalReward < 500000) rewardTier = { name: "å°æœ‰æˆå°±", text: `æœ€ç»ˆï¼Œä½ å¸¦ç€ ${totalReward.toLocaleString()} å…ƒå…‰è£é€€ä¼‘ï¼Œç®—å¾—ä¸Šå°æœ‰æˆå°±ï¼Œç”Ÿæ´»æ— å¿§ã€‚` };
        else if (totalReward < 10000000) rewardTier = { name: "äººç”Ÿèµ¢å®¶", text: `æ­å–œï¼ä½ ä»¥ ${totalReward.toLocaleString()} å…ƒçš„å·¨æ¬¾ç»“æŸäº†å¥‹æ–—ï¼Œæˆä¸ºäº†ä¸æŠ˜ä¸æ‰£çš„äººç”Ÿèµ¢å®¶ã€‚` };
        else rewardTier = { name: "å¯Œå¯æ•Œå›½", text: `ä½ çš„åå­—è¶³ä»¥è½½å…¥å²å†Œï¼${totalReward.toLocaleString()} å…ƒçš„è´¢å¯Œï¼Œè®©ä½ è¾¾åˆ°äº†å¯Œå¯æ•Œå›½çš„å¢ƒç•Œã€‚` };

        const totalUpgradeLevel = upgrades.crit.level + upgrades.reward.level - 2;
        if (totalUpgradeLevel === 0) upgradeTier = { name: "åŸåœ°è¸æ­¥", text: "åœ¨ä¸ªäººæˆé•¿æ–¹é¢ï¼Œä½ ä¼¼ä¹ä¿¡å¥‰â€œæ— ä¸ºè€Œæ²»â€ï¼Œä»æœªè¿›è¡Œä»»ä½•æŠ•èµ„ã€‚" };
        else if (totalUpgradeLevel <= 5) upgradeTier = { name: "å¶å°”å……ç”µ", text: `ä½ è¿›è¡Œäº† ${totalUpgradeLevel} æ¬¡è‡ªæˆ‘æå‡ï¼Œå¶å°”ä¼šæƒ³èµ·æ¥è¦ç»™è‡ªå·±å……å……ç”µã€‚` };
        else upgradeTier = { name: "ç»ˆèº«å­¦ä¹ è€…", text: `ä½ ç‹‚çƒ­åœ°è¿›è¡Œäº† ${totalUpgradeLevel} æ¬¡è‡ªæˆ‘å¢å€¼ï¼Œæ˜¯ä¸ªä¸æŠ˜ä¸æ‰£çš„ç»ˆèº«å­¦ä¹ è€…ã€‚` };

        if (ticketCount === 0) ticketTier = { name: "ç»å¯¹ä¿å®ˆ", text: "é¢å¯¹é£é™©ï¼Œä½ é€‰æ‹©äº†ç»å¯¹çš„ä¿å®ˆï¼Œä»æœªè¿›è¡Œè¿‡ä¸€æ¬¡â€œé£é™©æŠ•èµ„â€ã€‚" };
        else if (ticketCount <= 5) ticketTier = { name: "è°¨æ…æŠ•æœº", text: `ä½ å°è¯•äº† ${ticketCount} æ¬¡é£é™©æŠ•èµ„ï¼Œè¡Œäº‹ç›¸å½“è°¨æ…ã€‚` };
        else ticketTier = { name: "æ¿€è¿›èµŒå¾’", text: `ä½ ç–¯ç‹‚åŠ ç äº† ${ticketCount} æ¬¡ï¼Œåƒä¸€ä¸ªçº¢äº†çœ¼çš„èµŒå¾’ï¼Œåšä¿¡é£é™©èƒŒåæ˜¯æ— å°½çš„è´¢å¯Œã€‚` };

        // 2. ç»„åˆç”Ÿæˆæœ€ç»ˆè¯„è¯­
        let finalVerdict = "";
        if (rewardTier.name === "å¯Œå¯æ•Œå›½" || (rewardTier.name === "äººç”Ÿèµ¢å®¶" && ageTier.name === "è‹±å¹´æ—©é€€")) {
            finalVerdict = "å¤©é€‰ä¹‹å­ï¼šä½ çš„äººç”Ÿå ªç§°ä¼ å¥‡ï¼æ— è®ºæ˜¯è¿æ°”ã€èƒ†è¯†è¿˜æ˜¯è¿œè§ï¼Œä½ éƒ½è¿œè¶…å¸¸äººã€‚";
        } else if (rewardTier.name === "å‹‰å¼ºç³Šå£" && ageTier.name === "å¤§å™¨æ™šæˆ") {
            finalVerdict = "æ²‰å¯‚çš„ä¸€ç”Ÿï¼šä½ ä»˜å‡ºäº†æ¼«é•¿çš„æ—¶é—´ï¼Œå´æ”¶è·ç”šå¾®ã€‚æˆ–è®¸æ˜¯æ—¶è¿ä¸æµï¼Œæˆ–è®¸æ˜¯åŠªåŠ›é”™äº†æ–¹å‘ï¼Œè¿™ç»“æœä»¤äººå”å˜˜ã€‚";
        } else if (ticketTier.name === "æ¿€è¿›èµŒå¾’" && rewardTier.name === "å‹‰å¼ºç³Šå£") {
            finalVerdict = "è±ªèµŒçš„ä»£ä»·ï¼šä½ å°†èº«å®¶æ€§å‘½éƒ½æŠ¼åœ¨äº†é£é™©æŠ•èµ„ä¸Šï¼Œä½†å‘½è¿å¹¶æœªçœ·é¡¾ä½ ã€‚é«˜é£é™©å¹¶æœªå¸¦æ¥é«˜å›æŠ¥ï¼Œåè€Œè®©ä½ ä¸€è´«å¦‚æ´—ã€‚";
        } else if (upgradeTier.name === "ç»ˆèº«å­¦ä¹ è€…" && rewardTier.name !== "å‹‰å¼ºç³Šå£") {
            finalVerdict = "çŸ¥è¯†æ”¹å˜å‘½è¿ï¼šä½ åšå®šåœ°ç›¸ä¿¡æŠ•èµ„è‡ªå·±æ‰æ˜¯æœ€å¥½çš„æŠ•èµ„ã€‚äº‹å®è¯æ˜ï¼Œä½ çš„è¿œè§å“è¯†ä¸ºä½ å¸¦æ¥äº†ä¸°åšçš„å›æŠ¥ã€‚";
        } else {
            finalVerdict = "ä¸€ä¸ªæ™®é€šäººï¼šåƒå¤§å¤šæ•°äººä¸€æ ·ï¼Œä½ çš„äººç”Ÿåœ¨å¹³å‡¡ä¸­å¼€å§‹ï¼Œåœ¨å¹³å‡¡ä¸­è½å¹•ã€‚ä¸å¥½ä¸åï¼Œä½†çœŸå®ã€‚";
        }

        return `${ageTier.text}\n${rewardTier.text}\n\n${upgradeTier.text}\n${ticketTier.text}\n\nã€æœ€ç»ˆè¯„å®šã€‘\n${finalVerdict}`;
    }

    function restartGame() {
      document.getElementById("settlementModal").style.display = "none";
      document.getElementById("gameBox").style.display = "none";
      document.getElementById("ageModal").style.display = "flex";
    }

    // åˆå§‹è°ƒç”¨
    window.onload = () => {
        document.getElementById("ageModal").style.display = "flex";
    };
  </script>
</body>
</html>
